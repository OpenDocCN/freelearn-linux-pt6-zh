<html><head></head><body>
<div id="_idContainer032">
<h1 class="chapter-number" id="_idParaDest-111"><a id="_idTextAnchor557"/><span class="koboSpan" id="kobo.1.1">5</span></h1>
<h1 id="_idParaDest-112"><a id="_idTextAnchor558"/><span class="koboSpan" id="kobo.2.1">PHP and Python with NGINX</span></h1>
<p><span class="koboSpan" id="kobo.3.1">The 2000s have been the decade of server-side technologies. </span><span class="koboSpan" id="kobo.3.2">Over the past 15 years or so, an overwhelming majority of websites have migrated from simple static HTML content to highly and fully dynamic pages, taking the web to an entirely new level in terms of interaction with visitors. </span><span class="koboSpan" id="kobo.3.3">Software solutions emerged quickly, including open source ones, and some became mature enough to process high-traffic websites. </span><span class="koboSpan" id="kobo.3.4">In this chapter, we will study the ability of NGINX to interact with these applications. </span><span class="koboSpan" id="kobo.3.5">We have selected two for different reasons. </span><span class="koboSpan" id="kobo.3.6">The first one is obviously PHP. </span><span class="koboSpan" id="kobo.3.7">As of June 2015, </span><em class="italic"><span class="koboSpan" id="kobo.4.1">W3Techs</span></em><span class="koboSpan" id="kobo.5.1"> (a website specializing in web technology surveys) reveals that PHP empowers over 80% of websites designed with a server-side language. </span><span class="koboSpan" id="kobo.5.2">The second language in our selection is Python, due to the way it is installed and configured to work with NGINX. </span><span class="koboSpan" id="kobo.5.3">The mechanism we will discover effortlessly applies to other applications, such as Perl or </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">Ruby on </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.7.1">Rails</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.8.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.9.1">RoR</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">This chapter covers the </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.13.1">Introduction to </span><strong class="bold"><span class="koboSpan" id="kobo.14.1">Fast Common Gateway Interface</span></strong><span class="koboSpan" id="kobo.15.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.16.1">FastCGI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">) technologies</span></span></li>
<li><span class="koboSpan" id="kobo.18.1">Setting up NGINX with PHP and </span><strong class="bold"><span class="koboSpan" id="kobo.19.1">PHP FastCGI Process </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.20.1">Manager</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.21.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.22.1">PHP-FPM</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">Setting up NGINX with Python </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">and Django</span></span></li>
</ul>
<h1 id="_idParaDest-113"><a id="_idTextAnchor559"/><a id="_idTextAnchor560"/><span class="koboSpan" id="kobo.26.1">Introduction to FastCGI technologies</span></h1>
<p><span class="koboSpan" id="kobo.27.1">Before we begin, you</span><a id="_idIndexMarker356"/><span class="koboSpan" id="kobo.28.1"> should know that (as the name suggests) </span><strong class="bold"><span class="koboSpan" id="kobo.29.1">FastCGI</span></strong><span class="koboSpan" id="kobo.30.1"> is actually a variation</span><a id="_idIndexMarker357"/><span class="koboSpan" id="kobo.31.1"> of </span><strong class="bold"><span class="koboSpan" id="kobo.32.1">Common Gateway Interface</span></strong><span class="koboSpan" id="kobo.33.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.34.1">CGI</span></strong><span class="koboSpan" id="kobo.35.1">). </span><span class="koboSpan" id="kobo.35.2">Therefore, explaining CGI first is in order. </span><span class="koboSpan" id="kobo.35.3">The improvements introduced by FastCGI are detailed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">following section</span><a id="_idTextAnchor561"/><span class="koboSpan" id="kobo.37.1">s</span><a id="_idTextAnchor562"/><span class="koboSpan" id="kobo.38.1">.</span></span></p>
<h2 id="_idParaDest-114"><a id="_idTextAnchor563"/><span class="koboSpan" id="kobo.39.1">Understanding the CGI mechanism</span></h2>
<p><span class="koboSpan" id="kobo.40.1">The original </span><a id="_idIndexMarker358"/><span class="koboSpan" id="kobo.41.1">purpose of a web server was merely to respond to requests from clients by serving files located on a storage device. </span><span class="koboSpan" id="kobo.41.2">The client sends a request to download a file, and the server processes the request and sends the appropriate response: </span><strong class="bold"><span class="koboSpan" id="kobo.42.1">200 OK</span></strong><span class="koboSpan" id="kobo.43.1"> if the file can be served normally, 404 if the</span><a id="_idIndexMarker359"/><span class="koboSpan" id="kobo.44.1"> file was not found, and other variants, as illustrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">following diagram:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer028">
<span class="koboSpan" id="kobo.46.1"><img alt="Figure 5.1: A diagram depicting standard HTTP requests" src="image/B21787_05_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.47.1">Figure 5.1: A diagram depicting standard HTTP requests</span></p>
<p><span class="koboSpan" id="kobo.48.1">This mechanism has been in use since the beginning of the World Wide Web, and it still is. </span><span class="koboSpan" id="kobo.48.2">However, as stated before, static websites are being progressively abandoned at the expense of dynamic ones that contain scripts processed by applications such as PHP and Python, among others. </span><span class="koboSpan" id="kobo.48.3">The web-serving mechanism thus evolved into </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer029">
<span class="koboSpan" id="kobo.50.1"><img alt="Figure 5.2: A diagram depicting standard HTTP requests with Nginx and CGI processing" src="image/B21787_05_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.51.1">Figure 5.2: A diagram depicting standard HTTP requests with Nginx and CGI processing</span></p>
<p><span class="koboSpan" id="kobo.52.1">When a client</span><a id="_idIndexMarker360"/><span class="koboSpan" id="kobo.53.1"> attempts to visit a dynamic page, the web server receives the request and forwards it to a third-party application. </span><span class="koboSpan" id="kobo.53.2">The application processes the script independently and returns the produced response to the web server, which then forwards the response back to </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">the client.</span></span></p>
<p><span class="koboSpan" id="kobo.55.1">In order for the web server to communicate with that application, the CGI protocol was invented in the </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">early 199</span><a id="_idTextAnchor564"/><span class="koboSpan" id="kobo.57.1">0</span><a id="_idTextAnchor565"/><span class="koboSpan" id="kobo.58.1">s.</span></span></p>
<h2 id="_idParaDest-115"><a id="_idTextAnchor566"/><span class="koboSpan" id="kobo.59.1">CGI</span></h2>
<p><span class="koboSpan" id="kobo.60.1">The </span><a id="_idIndexMarker361"/><span class="koboSpan" id="kobo.61.1">following is stated in </span><em class="italic"><span class="koboSpan" id="kobo.62.1">RFC 3875 (CGI protocol v1.1)</span></em><span class="koboSpan" id="kobo.63.1">, designed</span><a id="_idIndexMarker362"/><span class="koboSpan" id="kobo.64.1"> by the </span><strong class="bold"><span class="koboSpan" id="kobo.65.1">Internet </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.66.1">Society</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.67.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.68.1">ISOC</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">):</span></span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.70.1">The CGI allows an HTTP server and a CGI script to share responsibility for responding to client requests. </span><span class="koboSpan" id="kobo.70.2">[...]. </span><span class="koboSpan" id="kobo.70.3">The server is responsible for managing connection, data transfer, transport, and network issues related to the client request, whereas the CGI script handles the application issues such as data access and </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.71.1">document processing.</span></em></span></p>
<p><span class="koboSpan" id="kobo.72.1">CGI is the protocol</span><a id="_idIndexMarker363"/><span class="koboSpan" id="kobo.73.1"> that describes the way information is exchanged between the web server (NGINX) and the gateway application (PHP, Python, and so on). </span><span class="koboSpan" id="kobo.73.2">In practice, when the web server receives a request that should be forwarded to the gateway application, it simply executes the command corresponding to the desired application; for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.74.1">/usr/bin/php</span></strong><span class="koboSpan" id="kobo.75.1">. </span><span class="koboSpan" id="kobo.75.2">Details about the client request (such as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">User-Agent</span></strong><span class="koboSpan" id="kobo.77.1"> header and other request information) are passed either as command-line arguments or in environment variables, while actual data from </span><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">POST</span></strong><span class="koboSpan" id="kobo.79.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">PUT</span></strong><span class="koboSpan" id="kobo.81.1"> requests is transmitted through the standard input. </span><span class="koboSpan" id="kobo.81.2">The invoked application then writes the processed document contents to the standard output, which is recaptured by the </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">web server.</span></span></p>
<p><span class="koboSpan" id="kobo.83.1">While this technology seems simple and efficient enough at first sight, it comes with a few major drawbacks, which </span><a id="_idIndexMarker364"/><span class="koboSpan" id="kobo.84.1">are discussed </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.86.1">A unique process is spawned for each request. </span><span class="koboSpan" id="kobo.86.2">Memory and other context information are lost from one request </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">to another.</span></span></li>
<li><span class="koboSpan" id="kobo.88.1">Starting up a process can be resource-consuming for the system. </span><span class="koboSpan" id="kobo.88.2">Massive numbers of simultaneous requests (each spawning a process) could quickly clutter </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">a server.</span></span></li>
<li><span class="koboSpan" id="kobo.90.1">Designing an architecture where the web server and the gateway application are located on different computers seems difficult, if </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">not impo</span><a id="_idTextAnchor567"/><span class="koboSpan" id="kobo.92.1">s</span><a id="_idTextAnchor568"/><span class="koboSpan" id="kobo.93.1">sible.</span></span></li>
</ul>
<h2 id="_idParaDest-116"><a id="_idTextAnchor569"/><span class="koboSpan" id="kobo.94.1">FastCGI</span></h2>
<p><span class="koboSpan" id="kobo.95.1">The </span><a id="_idIndexMarker365"/><span class="koboSpan" id="kobo.96.1">issues mentioned in the </span><em class="italic"><span class="koboSpan" id="kobo.97.1">CGI</span></em><span class="koboSpan" id="kobo.98.1"> section render the CGI protocol relatively inefficient for servers that are subject to heavy load. </span><span class="koboSpan" id="kobo.98.2">The will to find solutions led the open market in the mid-90s to develop an evolution of CGI: FastCGI. </span><span class="koboSpan" id="kobo.98.3">It has become a major standard over the past 15 years, and most web servers now offer the functionality, even </span><a id="_idIndexMarker366"/><span class="koboSpan" id="kobo.99.1">proprietary server software such as Microsoft </span><strong class="bold"><span class="koboSpan" id="kobo.100.1">Internet Information </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.101.1">Services</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.102.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.103.1">IIS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.105.1">Although the purpose remains the same, FastCGI offers significant improvements over CGI with the </span><a id="_idIndexMarker367"/><span class="koboSpan" id="kobo.106.1">establishment of the </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">following principles:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.108.1">Instead of spawning a new process for each request, FastCGI employs persistent processes that come with the ability to handle </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">multiple requests.</span></span></li>
<li><span class="koboSpan" id="kobo.110.1">The web server and the gateway application communicate with the use of sockets such as TCP or Unix local IPC sockets. </span><span class="koboSpan" id="kobo.110.2">Consequently, the web server and backend processes may be located on two different computers on </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">a network.</span></span></li>
<li><span class="koboSpan" id="kobo.112.1">The web server forwards the client request to the gateway and receives a response within a single connection. </span><span class="koboSpan" id="kobo.112.2">Additional requests may also follow without needing to create additional connections. </span><span class="koboSpan" id="kobo.112.3">Note that on most web servers, including NGINX and Apache, the implementation of FastCGI does not (or at least not fully) </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">support </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.114.1">multiplexing</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.116.1">Since FastCGI is a socket-based protocol, it can be implemented on any platform with any </span><span class="No-Break"><span class="koboSpan" id="kobo.117.1">programming language.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.118.1">Throughout this chapter, we will be setting up PHP and Python via FastCGI. </span><span class="koboSpan" id="kobo.118.2">Additionally, you will find the mechanism to be relatively similar in the case of other applications, such as Perl </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">or RoR.</span></span></p>
<p><span class="koboSpan" id="kobo.120.1">Designing a FastCGI-powered architecture is actually not as complex as one might imagine. </span><span class="koboSpan" id="kobo.120.2">As long as you have the web server and the backend application running, the only difficulty that remains is to establish a connection between both parties. </span><span class="koboSpan" id="kobo.120.3">The first step in that perspective is to configure the way NGINX will communicate with the FastCGI application. </span><span class="koboSpan" id="kobo.120.4">FastCGI compatibility with NGINX is introduced by the FastCGI module, which is included in default NGINX builds (including those that are installed via software repositories). </span><span class="koboSpan" id="kobo.120.5">This section details the directives that are made available by </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">t</span><a id="_idTextAnchor570"/><span class="koboSpan" id="kobo.122.1">h</span><a id="_idTextAnchor571"/><span class="koboSpan" id="kobo.123.1">e module.</span></span></p>
<h2 id="_idParaDest-117"><a id="_idTextAnchor572"/><span class="koboSpan" id="kobo.124.1">uWSGI and SCGI</span></h2>
<p><span class="koboSpan" id="kobo.125.1">Before reading the rest of the chapter, you should know that NGINX offers two other CGI-derived </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">module implementations:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.127.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">uWSGI</span></strong><span class="koboSpan" id="kobo.129.1"> module </span><a id="_idIndexMarker368"/><span class="koboSpan" id="kobo.130.1">allows NGINX to communicate with applications through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">uwsgi</span></strong><span class="koboSpan" id="kobo.132.1"> protocol, itself</span><a id="_idIndexMarker369"/><span class="koboSpan" id="kobo.133.1"> derived from the </span><strong class="bold"><span class="koboSpan" id="kobo.134.1">Web Server Gateway Interface</span></strong><span class="koboSpan" id="kobo.135.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.136.1">WSGI</span></strong><span class="koboSpan" id="kobo.137.1">). </span><span class="koboSpan" id="kobo.137.2">The most commonly used (the unique) server implementing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">uwsgi</span></strong><span class="koboSpan" id="kobo.139.1"> protocol is the unoriginally named uWSGI server. </span><span class="koboSpan" id="kobo.139.2">Its latest documentation </span><a id="_idIndexMarker370"/><span class="koboSpan" id="kobo.140.1">can be found at </span><a href="http://uwsgi-docs.readthedocs.io/en/latest/"><span class="koboSpan" id="kobo.141.1">http://uwsgi-docs.readthedocs.io/en/latest/</span></a><span class="koboSpan" id="kobo.142.1">. </span><span class="koboSpan" id="kobo.142.2">This module will prove useful to Python adepts, seeing as the uWSGI project was designed mainly for </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">Python applications.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.144.1">SCGI</span></strong><span class="koboSpan" id="kobo.145.1">, which stands for </span><strong class="bold"><span class="koboSpan" id="kobo.146.1">Simple Common Gateway Interface</span></strong><span class="koboSpan" id="kobo.147.1">, is a variant of the CGI </span><a id="_idIndexMarker371"/><span class="koboSpan" id="kobo.148.1">protocol, much like FastCGI. </span><span class="koboSpan" id="kobo.148.2">Younger than FastCGI since its specification was first published in 2006, SCGI was designed to be easier to implement and as its name suggests: simple. </span><span class="koboSpan" id="kobo.148.3">It is not related to a particular programming language. </span><span class="koboSpan" id="kobo.148.4">SCGI interfaces and modules can be found in a variety of software projects such as Apache, IIS, Java, Cherokee, and a </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">lot more.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.150.1">There are no major differences in the way NGINX handles the FastCGI, uWSGI, and SCGI protocols: each of these has its respective module, containing similarly named directives. </span><span class="koboSpan" id="kobo.150.2">The following table lists a couple of directives from the FastCGI module, which are detailed in the following sections, and their uWSGI and </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">SCGI equivalents:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-5">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.152.1">FastCGI module</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.153.1">uWSGI equivalent</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.154.1">SCGI equivalent</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">fastcgi_pass</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">uwsgi_pass</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">scgi_pass</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">fastcgi_cache</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">uwsgi_cache</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">scgi_cache</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">fastcgi_temp_path</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">uwsgi_temp_path</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">scgi_temp_path</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.164.1"> Table 5.1: FastCGI, uWSGI, and SCGI equivalent directives</span></p>
<p><span class="koboSpan" id="kobo.165.1">Directive names and syntaxes are identical. </span><span class="koboSpan" id="kobo.165.2">In addition, the NGINX development team has been maintaining all three modules in parallel. </span><span class="koboSpan" id="kobo.165.3">New directives or directive updates are always applied to all of them. </span><span class="koboSpan" id="kobo.165.4">As such, the following sections will document NGINX’s implementation of the FastCGI protocol (since it is the most widely used), but they also apply to uWSGI </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">and SCGI.</span></span><a id="_idTextAnchor573"/></p>
<h2 id="_idParaDest-118"><a id="_idTextAnchor574"/><span class="koboSpan" id="kobo.167.1">Main directives</span></h2>
<p><span class="koboSpan" id="kobo.168.1">The FastCGI, uWSGI, and SCGI modules are included in the default NGINX build. </span><span class="koboSpan" id="kobo.168.2">You do not need to enable </span><a id="_idIndexMarker372"/><span class="koboSpan" id="kobo.169.1">them manually at compile time. </span><span class="koboSpan" id="kobo.169.2">The directives listed in the following table allow you to configure the way NGINX </span><em class="italic"><span class="koboSpan" id="kobo.170.1">passes</span></em><span class="koboSpan" id="kobo.171.1"> requests to the FastCGI/uWSGI/SCGI application. </span><span class="koboSpan" id="kobo.171.2">Note that you will find </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">fastcgi_params</span></strong><span class="koboSpan" id="kobo.173.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">uwsgi_params</span></strong><span class="koboSpan" id="kobo.175.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">scgi_params</span></strong><span class="koboSpan" id="kobo.177.1"> files in the NGINX configuration folder; these define directive values that are valid for </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">most situations:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002-3">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.179.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.180.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">fastcgi_pass</span></strong></span></p>
<p><span class="koboSpan" id="kobo.182.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.186.1">This directive specifies that the request should be passed to the FastCGI server, by indicating </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">its location:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.188.1">For TCP sockets, the syntax is </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">fastcgi_pass hostname:port;</span></strong></span></li>
<li><span class="koboSpan" id="kobo.190.1">For Unix domain sockets, the syntax is </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">fastcgi_pass unix:/path/to/fastcgi.socket;</span></strong></span></li>
<li><span class="koboSpan" id="kobo.192.1">You may also refer to upstream blocks (read the following sections for more information): </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">fastcgi_pass myblock;</span></strong></span></li>
</ul>
<p><span class="No-Break"><span class="koboSpan" id="kobo.194.1">Examples:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">fastcgi_pass   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">localhost:9000;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">fastcgi_pass   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">127.0.0.1:9000;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">fastcgi_pass   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">unix:/tmp/fastcgi.socket;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.201.1"># Using an   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">upstream block</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">upstream fastcgi   {</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.204.1"> server   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">127.0.0.1:9000;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.206.1"> server   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">127.0.0.1:9001;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">}</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.209.1">location ~*   \.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">php$ {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">    fastcgi_pass   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">fastcgi;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">}</span></strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">fastcgi_param</span></strong></span></p>
<p><span class="koboSpan" id="kobo.215.1">Context: http, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.219.1">This directive allows you to configure the request passed to FastCGI. </span><span class="koboSpan" id="kobo.219.2">Two parameters are strictly required for all FastCGI requests: </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">SCRIPT_FILENAME</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.221.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.222.1">QUERY_STRING</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.224.1">Examples:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">fastcgi_param   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">SCRIPT_FILENAME /home/website.com/www$fastcgi_script_name;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">fastcgi_param   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">QUERY_STRING $query_string;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.229.1">As for </span><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">POST</span></strong><span class="koboSpan" id="kobo.231.1"> requests, additional parameters are required: </span><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">REQUEST_METHOD</span></strong><span class="koboSpan" id="kobo.233.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">CONTENT_TYPE</span></strong><span class="koboSpan" id="kobo.235.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">CONTENT_LENGTH</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.239.1">Examples:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.240.1">fastcgi_param   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">REQUEST_METHOD $request_method;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">fastcgi_param   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">CONTENT_TYPE $content_type;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">fastcgi_param   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">CONTENT_LENGTH $content_length;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.246.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">fastcgi_params</span></strong><span class="koboSpan" id="kobo.248.1"> file that you will find in the NGINX configuration folder already includes all of the necessary parameter definitions, except for </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">SCRIPT_FILENAME</span></strong><span class="koboSpan" id="kobo.250.1">, which you need to specify for each of your </span><span class="No-Break"><span class="koboSpan" id="kobo.251.1">FastCGI configurations.</span></span></p>
<p><span class="koboSpan" id="kobo.252.1">If the parameter name begins with </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">HTTP_</span></strong><span class="koboSpan" id="kobo.254.1">, it will override potentially existing HTTP headers of the </span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">client request.</span></span></p>
<p><span class="koboSpan" id="kobo.256.1">You may optionally specify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">if_not_empty</span></strong><span class="koboSpan" id="kobo.258.1"> keyword, forcing NGINX to transmit the parameter only if the specified value is </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">not empty.</span></span></p>
<p><span class="koboSpan" id="kobo.260.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">fastcgi_param PARAM </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">value [if_not_empty];</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.263.1">fastcgi_bind</span></strong></span></p>
<p><span class="koboSpan" id="kobo.264.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.265.1">http</span></strong><span class="koboSpan" id="kobo.266.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.270.1">This directive binds the socket to a local IP address, allowing you to specify the network interface you want to use for </span><span class="No-Break"><span class="koboSpan" id="kobo.271.1">FastCGI communications.</span></span></p>
<p><span class="koboSpan" id="kobo.272.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">fastcgi_bind IP_address[:port] [transparent] | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">off;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">fastcgi_pass_header</span></strong></span></p>
<p><span class="koboSpan" id="kobo.276.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">http</span></strong><span class="koboSpan" id="kobo.278.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.282.1">This directive specifies additional headers that should be passed to the </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">FastCGI server.</span></span></p>
<p><span class="koboSpan" id="kobo.284.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">fastcgi_pass_header headername;</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.286.1">Example:</span></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">fastcgi_pass_header Authorization;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">fastcgi_hide_header</span></strong></span></p>
<p><span class="koboSpan" id="kobo.289.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">http</span></strong><span class="koboSpan" id="kobo.291.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.295.1">This directive specifies headers that should be hidden from the FastCGI server (headers that NGINX does </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">not forward).</span></span></p>
<p><span class="koboSpan" id="kobo.297.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">fastcgi_hide_header headername;</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.299.1">Example:</span></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">fastcgi_hide_header X-Forwarded-For;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">fastcgi_index</span></strong></span></p>
<p><span class="koboSpan" id="kobo.302.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">http</span></strong><span class="koboSpan" id="kobo.304.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.308.1">The FastCGI server does not support automatic directory indexes. </span><span class="koboSpan" id="kobo.308.2">If the requested URI ends with </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">/</span></strong><span class="koboSpan" id="kobo.310.1">, NGINX appends the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">fastcgi_index</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.312.1"> value.</span></span></p>
<p><span class="koboSpan" id="kobo.313.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">fastcgi_index filename;</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.315.1">Example:</span></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">fastcgi_index index.php;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">fastcgi_ignore_client_abort</span></strong></span></p>
<p><span class="koboSpan" id="kobo.318.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">http</span></strong><span class="koboSpan" id="kobo.320.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.322.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.324.1">This directive lets you define what happens if the client aborts their request to the web server. </span><span class="koboSpan" id="kobo.324.2">If the directive is turned on, NGINX ignores the abort request and finishes processing the request. </span><span class="koboSpan" id="kobo.324.3">If it’s turned off, NGINX does not ignore the abort request. </span><span class="koboSpan" id="kobo.324.4">It interrupts the request treatment and aborts related communication with the </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">FastCGI server.</span></span></p>
<p><span class="koboSpan" id="kobo.326.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.328.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.330.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">fastcgi_intercept_errors</span></strong></span></p>
<p><span class="koboSpan" id="kobo.333.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.334.1">http</span></strong><span class="koboSpan" id="kobo.335.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.339.1">This directive defines whether or not NGINX should process errors returned by the gateway or directly return error pages to the client. </span><span class="koboSpan" id="kobo.339.2">Error processing is done via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">error_page</span></strong><span class="koboSpan" id="kobo.341.1"> directive </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">of NGINX.</span></span></p>
<p><span class="koboSpan" id="kobo.343.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.344.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.345.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.347.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.348.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">fastcgi_read_timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.350.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">http</span></strong><span class="koboSpan" id="kobo.352.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.355.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.356.1">This directive defines the timeout for the response from the FastCGI application. </span><span class="koboSpan" id="kobo.356.2">If NGINX does not receive the response after this period, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">504 Gateway Timeout</span></strong><span class="koboSpan" id="kobo.358.1"> HTTP error </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">is returned.</span></span></p>
<p><span class="koboSpan" id="kobo.360.1">Syntax: Numeric value (</span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">in seconds)</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.362.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">60</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">fastcgi_connect_timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.365.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">http</span></strong><span class="koboSpan" id="kobo.367.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.371.1">This directive defines the backend server connection timeout. </span><span class="koboSpan" id="kobo.371.2">This is different than the read/send timeout. </span><span class="koboSpan" id="kobo.371.3">If NGINX is already connected to the backend server, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">fastcgi_connect_timeout</span></strong><span class="koboSpan" id="kobo.373.1"> directive is </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">not applicable.</span></span></p>
<p><span class="koboSpan" id="kobo.375.1">Syntax: Time value (</span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">in seconds)</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.377.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">60</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">fastcgi_send_timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.380.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">http</span></strong><span class="koboSpan" id="kobo.382.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.386.1">This is the timeout for sending data to the backend server. </span><span class="koboSpan" id="kobo.386.2">The timeout isn’t applied to the entire response delay but rather between two </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">write operations.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">Syntax: Time value (</span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">in seconds)</span></span></p>
<p><span class="koboSpan" id="kobo.390.1">Default </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">value: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">60</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">fastcgi_split_path_info</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.394.1">Context: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.396.1">A directive particularly useful for URLs of the following </span><span class="No-Break"><span class="koboSpan" id="kobo.397.1">form: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">http://website.com/page.php/param1/param2/</span></strong></span></p>
<p><span class="koboSpan" id="kobo.399.1">The directive splits the path information according to the specified </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">regular expression:</span></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">fastcgi_split_path_info ^(.+\.php)(.*)$;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.402.1">This affects </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">two variables:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">$fastcgi_script_name</span></strong><span class="koboSpan" id="kobo.405.1">: The filename of the actual script to be executed; for </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">example; </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.407.1">page.php</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.408.1">$fastcgi_path_info</span></strong><span class="koboSpan" id="kobo.409.1">: The part of the URL that is after the script name; for  </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">/param1/param2/</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.412.1">These can be employed in further </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">parameter definitions:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">fastcgi_param   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">SCRIPT_FILENAME /home/website.com/www$fastcgi_script_name;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">fastcgi_param   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">PATH_INFO $fastcgi_path_info;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.418.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">Regular expression</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">fastcgi_store</span></strong></span></p>
<p><span class="koboSpan" id="kobo.421.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">http</span></strong><span class="koboSpan" id="kobo.423.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.424.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.427.1">This directive enables a simple </span><em class="italic"><span class="koboSpan" id="kobo.428.1">cache store</span></em><span class="koboSpan" id="kobo.429.1"> where responses from the FastCGI application are stored as files on the storage device. </span><span class="koboSpan" id="kobo.429.2">When the same URI is requested again, the document is directly served from the cache store instead of forwarding the request to the </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">FastCGI application.</span></span></p>
<p><span class="koboSpan" id="kobo.431.1">This directive enables or disables the </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">cache store.</span></span></p>
<p><span class="koboSpan" id="kobo.433.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.435.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.436.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">fastcgi_store_access</span></strong></span></p>
<p><span class="koboSpan" id="kobo.438.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">http</span></strong><span class="koboSpan" id="kobo.440.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.444.1">This directive defines access permissions applied to the files created in the context of the </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">cache store.</span></span></p>
<p><span class="koboSpan" id="kobo.446.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.447.1">fastcgi_store_access [user:r|w|rw][group:r|w|rw][all:r|w|rw];</span></strong></span></p>
<p><span class="koboSpan" id="kobo.448.1">Default: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.449.1">fastcgi_store_access user:rw;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">fastcgi_temp_path</span></strong></span></p>
<p><span class="koboSpan" id="kobo.451.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">http</span></strong><span class="koboSpan" id="kobo.453.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.457.1">This directive sets the path of temporary and cache </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">store files.</span></span></p>
<p><span class="koboSpan" id="kobo.459.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">File path</span></span></p>
<p><span class="koboSpan" id="kobo.461.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">fastcgi_temp_path /tmp/nginx_fastcgi;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">fastcgi_max_temp_file_size</span></strong></span></p>
<p><span class="koboSpan" id="kobo.464.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">http</span></strong><span class="koboSpan" id="kobo.466.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.468.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.469.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.470.1">Set this directive to </span><strong class="source-inline"><span class="koboSpan" id="kobo.471.1">0</span></strong><span class="koboSpan" id="kobo.472.1"> to disable the use of temporary files for FastCGI requests or to specify a maximum </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">file size.</span></span></p>
<p><span class="koboSpan" id="kobo.474.1">Default value: </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">1 GB</span></span></p>
<p><span class="koboSpan" id="kobo.476.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.477.1">Size value</span></span></p>
<p><span class="koboSpan" id="kobo.478.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">fastcgi_max_temp_file_size 5m;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">fastcgi_temp_file_write_size</span></strong></span></p>
<p><span class="koboSpan" id="kobo.481.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">http</span></strong><span class="koboSpan" id="kobo.483.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.487.1">This directive sets the write buffer size when saving temporary files to the </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">storage device.</span></span></p>
<p><span class="koboSpan" id="kobo.489.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.490.1">Size value</span></span></p>
<p><span class="koboSpan" id="kobo.491.1">Default value: </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">2 * </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">proxy_buffer_size</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.494.1">fastcgi_send_lowat</span></strong></span></p>
<p><span class="koboSpan" id="kobo.495.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">http</span></strong><span class="koboSpan" id="kobo.497.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.501.1">This option allows you to make use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">SO_SNDLOWAT</span></strong><span class="koboSpan" id="kobo.503.1"> flag for TCP sockets under FreeBSD only. </span><span class="koboSpan" id="kobo.503.2">This value defines the minimum number of bytes in the buffer for </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">output operations.</span></span></p>
<p><span class="koboSpan" id="kobo.505.1">Syntax: Numeric </span><span class="No-Break"><span class="koboSpan" id="kobo.506.1">value (size)</span></span></p>
<p><span class="koboSpan" id="kobo.507.1">Default </span><span class="No-Break"><span class="koboSpan" id="kobo.508.1">value: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.509.1">0</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">fastcgi_pass_request_body</span></strong></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">fastcgi_pass_request_headers</span></strong></span></p>
<p><span class="koboSpan" id="kobo.512.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">http</span></strong><span class="koboSpan" id="kobo.514.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.516.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.517.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.518.1">These directives define whether or not, respectively, the request body and extra request headers should be passed on to the </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.519.1">backend</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.520.1"> server.</span></span></p>
<p><span class="koboSpan" id="kobo.521.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.523.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.525.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">on</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">fastcgi_ignore_headers</span></strong></span></p>
<p><span class="koboSpan" id="kobo.528.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">http</span></strong><span class="koboSpan" id="kobo.530.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.534.1">This directive prevents NGINX from processing one or more of the following headers from the backend </span><span class="No-Break"><span class="koboSpan" id="kobo.535.1">server response:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">X-Accel-Redirect</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">X-Accel-Expires</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">Expires</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">Cache-Control</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.540.1">X-Accel-Limit-Rate</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">X-Accel-Buffering</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">X-Accel-Charset</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.543.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">fastcgi_ignore_headers </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">header1 [header2...];</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">fastcgi_next_upstream</span></strong></span></p>
<p><span class="koboSpan" id="kobo.547.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">http</span></strong><span class="koboSpan" id="kobo.549.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.551.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.553.1">When </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">fastcgi_pass</span></strong><span class="koboSpan" id="kobo.555.1"> is connected to an upstream block, this directive defines cases where requests should be abandoned and resent to the next upstream server of the block. </span><span class="koboSpan" id="kobo.555.2">The directive accepts a combination of values among </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">the following:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">error</span></strong><span class="koboSpan" id="kobo.558.1">: An error occurred while communicating or attempting to communicate with </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">the server</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.560.1">timeout</span></strong><span class="koboSpan" id="kobo.561.1">: A timeout occurred during transfers or </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">connection attempts</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">invalid_header</span></strong><span class="koboSpan" id="kobo.564.1">: The backend server returned an empty or </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">invalid response</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.566.1">http_500</span></strong><span class="koboSpan" id="kobo.567.1">,  </span><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">http_503</span></strong><span class="koboSpan" id="kobo.569.1">,  </span><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">http_403</span></strong><span class="koboSpan" id="kobo.571.1">,  </span><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">http_404</span></strong><span class="koboSpan" id="kobo.573.1">,  </span><strong class="source-inline"><span class="koboSpan" id="kobo.574.1">http_429</span></strong><span class="koboSpan" id="kobo.575.1">: If such HTTP errors occur, NGINX switches to the next </span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">upstream server</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">non-idempotent</span></strong><span class="koboSpan" id="kobo.578.1">: Allows retrying non-idempotent requests (</span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">LOCK</span></strong><span class="koboSpan" id="kobo.580.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">POST</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.583.1">PATCH</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">off</span></strong><span class="koboSpan" id="kobo.586.1">: Forbids using the next </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">upstream server</span></span></li>
</ul>
<p><span class="No-Break"><span class="koboSpan" id="kobo.588.1">Examples:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.589.1">fastcgi_next_upstream   error </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.590.1">timeout http_504;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">fastcgi_next_upstream   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">timeout invalid_header;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">fastcgi_next_upstream_timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.594.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">http</span></strong><span class="koboSpan" id="kobo.596.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.600.1">Defines the timeout to be used in conjunction with </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">fastcgi_next_upstream</span></strong><span class="koboSpan" id="kobo.602.1">. </span><span class="koboSpan" id="kobo.602.2">Setting this directive to </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1">0</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.604.1">disables it.</span></span></p>
<p><span class="koboSpan" id="kobo.605.1">Syntax: Time value (</span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">in seconds)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">fastcgi_next_upstream_tries</span></strong></span></p>
<p><span class="koboSpan" id="kobo.608.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">http</span></strong><span class="koboSpan" id="kobo.610.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.611.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.614.1">Defines the maximum number of upstream servers tried before returning an error message, to be used in conjunction </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">fastcgi_next_upstream</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.618.1">Syntax: Numeric value (</span><span class="No-Break"><span class="koboSpan" id="kobo.619.1">default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">fastcgi_catch_stderr</span></strong></span></p>
<p><span class="koboSpan" id="kobo.623.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">http</span></strong><span class="koboSpan" id="kobo.625.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.629.1">This directive allows you to intercept some of the error messages sent to </span><strong class="source-inline"><span class="koboSpan" id="kobo.630.1">stderr</span></strong><span class="koboSpan" id="kobo.631.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.632.1">standard error</span></strong><span class="koboSpan" id="kobo.633.1"> stream) and store them in the NGINX </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">error log.</span></span></p>
<p><span class="koboSpan" id="kobo.635.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">fastcgi_catch_stderr filter;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.637.1">Example: </span><strong class="source-inline"><span class="koboSpan" id="kobo.638.1">fastcgi_catch_stderr "PHP </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">Fatal error:";</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">fastcgi_keep_conn</span></strong></span></p>
<p><span class="koboSpan" id="kobo.641.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.642.1">http</span></strong><span class="koboSpan" id="kobo.643.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.644.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.646.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.647.1">When set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.648.1">on</span></strong><span class="koboSpan" id="kobo.649.1">, NGINX will conserve the connection to the FastCGI server, thus </span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">reducing overhead.</span></span></p>
<p><span class="koboSpan" id="kobo.651.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">on</span></strong><span class="koboSpan" id="kobo.653.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.654.1">off</span></strong><span class="koboSpan" id="kobo.655.1"> (</span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.658.1">)</span></span></p>
<p><span class="koboSpan" id="kobo.659.1">Note that there is no equivalent directive in the uWSGI and </span><span class="No-Break"><span class="koboSpan" id="kobo.660.1">SCGI modules.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">fastcgi_force_ranges</span></strong></span></p>
<p><span class="koboSpan" id="kobo.662.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">http</span></strong><span class="koboSpan" id="kobo.664.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.665.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.666.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.667.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.668.1">When set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">on</span></strong><span class="koboSpan" id="kobo.670.1">, NGINX will enable byte-range support on responses from the </span><span class="No-Break"><span class="koboSpan" id="kobo.671.1">FastCGI backend.</span></span></p>
<p><span class="koboSpan" id="kobo.672.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">on</span></strong><span class="koboSpan" id="kobo.674.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">off</span></strong><span class="koboSpan" id="kobo.676.1"> (</span><span class="No-Break"><span class="koboSpan" id="kobo.677.1">default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">fastcgi_limit_rate</span></strong></span></p>
<p><span class="koboSpan" id="kobo.681.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.682.1">http</span></strong><span class="koboSpan" id="kobo.683.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.684.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.685.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.686.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.687.1">Allows you to limit the rate at which NGINX downloads the response from the </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">FastCGI backend.</span></span></p>
<p><span class="koboSpan" id="kobo.689.1">Syntax: Numeric value (bytes </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">per second)</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor575"/><span class="koboSpan" id="kobo.691.1">Table 5.2: A list of the main FastCGI directives</span></p>
<p><span class="koboSpan" id="kobo.692.1">We’ve had a glance at </span><a id="_idIndexMarker373"/><span class="koboSpan" id="kobo.693.1">the main FastCGI directives. </span><span class="koboSpan" id="kobo.693.2">Let’s dig deeper into FastCGI cache and </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">buffer directives.</span></span><a id="_idTextAnchor576"/></p>
<h2 id="_idParaDest-119"><a id="_idTextAnchor577"/><span class="koboSpan" id="kobo.695.1">FastCGI caching and buffering</span></h2>
<p><span class="koboSpan" id="kobo.696.1">Once you </span><a id="_idIndexMarker374"/><span class="koboSpan" id="kobo.697.1">have correctly configured NGINX to work with your FastCGI application, you may optionally make use of </span><strong class="source-inline"><span class="koboSpan" id="kobo.698.1">fastcgi_cache</span></strong><span class="koboSpan" id="kobo.699.1"> directives, which will help you improve the overall server performance by setting up a cache system. </span><span class="koboSpan" id="kobo.699.2">Additionally, FastCGI buffering allows you to buffer responses from the FastCGI backend instead of synchronously forwarding them to the client. </span><span class="koboSpan" id="kobo.699.3">You can get a full list of NGINX FastCGI cache modules on the official </span><a href="https://nginx.org"><span class="No-Break"><span class="koboSpan" id="kobo.700.1">https://nginx.org</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.701.1"> website.</span></span></p>
<p><span class="koboSpan" id="kobo.702.1">Here is a full </span><a id="_idIndexMarker375"/><span class="koboSpan" id="kobo.703.1">NGINX FastCGI cache configuration example, making use of most of the cache-related directives described in the </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">preceding table:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.705.1">
fastcgi_cache phpcache;
fastcgi_cache_key "$scheme$host$request_uri"; # $request_uri includes the request arguments (such as /page.php?arg=value)
fastcgi_cache_min_uses 2; # after 2 hits, a request receives a cached response
fastcgi_cache_path /tmp/cache levels=1:2 keys_zone=phpcache:10m
inactive=30m max_size=500M;
fastcgi_cache_use_stale updating timeout;
fastcgi_cache_valid 404 1m;
fastcgi_cache_valid 500 502 504 5m;</span></pre> <p><span class="koboSpan" id="kobo.706.1">Since these directives are valid for pretty much any virtual host configuration, you may want to save these in a separate file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">fastcgi_cache</span></strong><span class="koboSpan" id="kobo.708.1">) that you include in the </span><span class="No-Break"><span class="koboSpan" id="kobo.709.1">appropriate place:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.710.1">
server {
    server_name website.com;
    location ~* \.php$ {
         fastcgi_pass 127.0.0.1:9000;
         fastcgi_param SCRIPT_FILENAME /home/website.com/www$fastcgi_script_name;
         fastcgi_param PATH_INFO $fastcgi_script_name;
         include fastcgi_params;
         include fastcgi_cache;
    }
</span><a id="_idTextAnchor578"/><span class="koboSpan" id="kobo.711.1">}</span></pre> <p><span class="koboSpan" id="kobo.712.1">We’ve covered</span><a id="_idIndexMarker376"/><span class="koboSpan" id="kobo.713.1"> most</span><a id="_idIndexMarker377"/><span class="koboSpan" id="kobo.714.1"> of the directives in the FastCGI module that you might find useful. </span><span class="koboSpan" id="kobo.714.2">Now, we are going to apply this knowledge to a real-life use case involving NGINX </span><span class="No-Break"><span class="koboSpan" id="kobo.715.1">with </span><a id="_idTextAnchor579"/><span class="koboSpan" id="kobo.716.1">PHP.</span></span></p>
<h1 id="_idParaDest-120"><a id="_idTextAnchor580"/><span class="koboSpan" id="kobo.717.1">PHP with NGINX</span></h1>
<p><span class="koboSpan" id="kobo.718.1">We are</span><a id="_idIndexMarker378"/><span class="koboSpan" id="kobo.719.1"> now going to configure PHP to work together with NGINX via FastCGI. </span><span class="koboSpan" id="kobo.719.2">Why FastCGI in particular, as opposed to the other two alternatives, SCGI and uWSGI? </span><span class="koboSpan" id="kobo.719.3">The answer came with the release of PHP version </span><strong class="source-inline"><span class="koboSpan" id="kobo.720.1">5.3.3</span></strong><span class="koboSpan" id="kobo.721.1">. </span><span class="koboSpan" id="kobo.721.2">As of this version, all releases come with an integrated FastCGI process manager, allowing you to easily connect applications implementing the FastCGI protocol. </span><span class="koboSpan" id="kobo.721.3">The only requirement is for your PHP build to have been configured with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">--enable-fpm</span></strong><span class="koboSpan" id="kobo.723.1"> argument. </span><span class="koboSpan" id="kobo.723.2">If you are unsure whether your current setup includes the necessary components, worry not: a section of this chapter is dedicated to building PHP with everything we need. </span><span class="koboSpan" id="kobo.723.3">Alternatively, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">php-fpm</span></strong><span class="koboSpan" id="kobo.725.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.726.1">php8-fpm</span></strong><span class="koboSpan" id="kobo.727.1"> packages can be found in </span><span class="No-Break"><span class="koboSpan" id="kobo.728.1">most reposit</span><a id="_idTextAnchor581"/><span class="koboSpan" id="kobo.729.1">o</span><a id="_idTextAnchor582"/><span class="koboSpan" id="kobo.730.1">ries.</span></span></p>
<h2 id="_idParaDest-121"><a id="_idTextAnchor583"/><span class="koboSpan" id="kobo.731.1">Architecture</span></h2>
<p><span class="koboSpan" id="kobo.732.1">Before</span><a id="_idIndexMarker379"/><span class="koboSpan" id="kobo.733.1"> starting the setup process, it’s important to understand the way PHP will interact with NGINX. </span><span class="koboSpan" id="kobo.733.2">We have established that FastCGI is a communication protocol running through sockets, which implies that there is a client and a server. </span><span class="koboSpan" id="kobo.733.3">The client is obviously NGINX. </span><span class="koboSpan" id="kobo.733.4">As for the server, well, the answer is actually more complicated than </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">just “PHP.”</span></span></p>
<p><span class="koboSpan" id="kobo.735.1">By default, PHP supports the FastCGI protocol. </span><span class="koboSpan" id="kobo.735.2">The PHP binary processes scripts and is able to interact with NGINX via sockets. </span><span class="koboSpan" id="kobo.735.3">However, we are going to use an additional component to improve the overall </span><span class="No-Break"><span class="koboSpan" id="kobo.736.1">process management—PHP-FPM:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer030">
<span class="koboSpan" id="kobo.737.1"><img alt="Figure 5.3: A diagram showing PHP-FPM running PHP in a sandbox" src="image/B21787_05_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.738.1">Figure 5.3: A diagram showing PHP-FPM running PHP in a sandbox</span></p>
<p><span class="koboSpan" id="kobo.739.1">PHP-FPM </span><a id="_idIndexMarker380"/><span class="koboSpan" id="kobo.740.1">takes FastCGI support to an entirely new level. </span><span class="koboSpan" id="kobo.740.2">Its numerous features are detailed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.741.1">next s</span><a id="_idTextAnchor584"/><span class="koboSpan" id="kobo.742.1">e</span><a id="_idTextAnchor585"/><span class="koboSpan" id="kobo.743.1">ction.</span></span></p>
<h2 id="_idParaDest-122"><a id="_idTextAnchor586"/><span class="koboSpan" id="kobo.744.1">PHP-FPM</span></h2>
<p><span class="koboSpan" id="kobo.745.1">The process</span><a id="_idIndexMarker381"/><span class="koboSpan" id="kobo.746.1"> manager, as its name suggests, is a script that manages PHP processes. </span><span class="koboSpan" id="kobo.746.2">It awaits and receives instructions from NGINX and runs the requested PHP scripts under the environment that you configure. </span><span class="koboSpan" id="kobo.746.3">In practice, PHP-FPM introduces a number of possibilities, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.748.1">Automatically </span><em class="italic"><span class="koboSpan" id="kobo.749.1">daemonizing</span></em><span class="koboSpan" id="kobo.750.1"> PHP (turning it into a </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1">background process)</span></span></li>
<li><span class="koboSpan" id="kobo.752.1">Executing scripts in a </span><em class="italic"><span class="koboSpan" id="kobo.753.1">chrooted</span></em><span class="koboSpan" id="kobo.754.1"> (or </span><span class="No-Break"><span class="koboSpan" id="kobo.755.1">sandboxed) environment</span></span></li>
<li><span class="koboSpan" id="kobo.756.1">Improved logging, IP address restrictions, pool separation, and </span><span class="No-Break"><span class="koboSpan" id="kobo.757.1">m</span><a id="_idTextAnchor587"/><span class="koboSpan" id="kobo.758.1">u</span><a id="_idTextAnchor588"/><span class="koboSpan" id="kobo.759.1">ch more</span></span></li>
</ul>
<h2 id="_idParaDest-123"><a id="_idTextAnchor589"/><span class="koboSpan" id="kobo.760.1">Setting up PHP and PHP-FPM</span></h2>
<p><span class="koboSpan" id="kobo.761.1">In this </span><a id="_idIndexMarker382"/><span class="koboSpan" id="kobo.762.1">section, we </span><a id="_idIndexMarker383"/><span class="koboSpan" id="kobo.763.1">will detail the process of downloading and </span><span class="No-Break"><span class="koboSpan" id="kobo.764.1">insta</span><a id="_idTextAnchor590"/><span class="koboSpan" id="kobo.765.1">l</span><a id="_idTextAnchor591"/><span class="koboSpan" id="kobo.766.1">ling PHP.</span></span></p>
<h3><span class="koboSpan" id="kobo.767.1">Installing using a package manager</span></h3>
<p><span class="koboSpan" id="kobo.768.1">At the </span><a id="_idIndexMarker384"/><span class="koboSpan" id="kobo.769.1">time of writing these lines, the latest stable version of PHP is 8.3, but versions may differ depending on your distribution and the version of PHP included in </span><span class="No-Break"><span class="koboSpan" id="kobo.770.1">the dis</span><a id="_idTextAnchor592"/><span class="koboSpan" id="kobo.771.1">tribution.</span></span></p>
<p><span class="koboSpan" id="kobo.772.1">For Red Hat-based systems and other systems using </span><strong class="source-inline"><span class="koboSpan" id="kobo.773.1">dnf</span></strong><span class="koboSpan" id="kobo.774.1"> as the package manager, execute the </span><span class="No-Break"><span class="koboSpan" id="kobo.775.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.776.1">
[root@local ~]# dnf install php-fpm</span></pre> <p><span class="koboSpan" id="kobo.777.1">For Ubuntu, Debian, and </span><a id="_idIndexMarker385"/><span class="koboSpan" id="kobo.778.1">other systems that use </span><strong class="source-inline"><span class="koboSpan" id="kobo.779.1">apt</span></strong><span class="koboSpan" id="kobo.780.1">, execute the </span><span class="No-Break"><span class="koboSpan" id="kobo.781.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.782.1">
[root@local ~]# apt ins</span><a id="_idTextAnchor593"/><a id="_idTextAnchor594"/><span class="koboSpan" id="kobo.783.1">t</span><a id="_idTextAnchor595"/><span class="koboSpan" id="kobo.784.1">all php-fpm</span></pre> <h3><span class="koboSpan" id="kobo.785.1">Post-installation configuration</span></h3>
<p><span class="koboSpan" id="kobo.786.1">Begin by </span><a id="_idIndexMarker386"/><span class="koboSpan" id="kobo.787.1">configuring your newly installed PHP; for example, by copying the </span><strong class="source-inline"><span class="koboSpan" id="kobo.788.1">php.ini</span></strong><span class="koboSpan" id="kobo.789.1"> file of your previous setup over the </span><span class="No-Break"><span class="koboSpan" id="kobo.790.1">new one.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.791.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.792.1">Due to the way NGINX forwards script files and request information to PHP, a security breach might be caused by the use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.793.1">cgi.fix_pathinfo=1</span></strong><span class="koboSpan" id="kobo.794.1"> configuration option. </span><span class="koboSpan" id="kobo.794.2">It is highly recommended that you set this option to </span><strong class="source-inline"><span class="koboSpan" id="kobo.795.1">0</span></strong><span class="koboSpan" id="kobo.796.1"> in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.797.1">php.ini</span></strong><span class="koboSpan" id="kobo.798.1"> file (it should be </span><strong class="source-inline"><span class="koboSpan" id="kobo.799.1">0</span></strong><span class="koboSpan" id="kobo.800.1"> by default on most distributions). </span><span class="koboSpan" id="kobo.800.2">For more information about this particular security issue, please consult the </span><span class="No-Break"><span class="koboSpan" id="kobo.801.1">following article:</span></span></p>
<p class="callout"><a href="http://cnedelcu.blogspot.in/2010/05/nginx-php-via-fastcgi-important.html"><span class="No-Break"><span class="koboSpan" id="kobo.802.1">http://cnedelcu.blogspot.in/2010/05/nginx-php-via-fastcgi-important.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.803.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.804.1">The next step is to configure PHP-FPM. </span><span class="koboSpan" id="kobo.804.2">Open up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.805.1">php-fpm.conf</span></strong><span class="koboSpan" id="kobo.806.1"> file. </span><span class="koboSpan" id="kobo.806.2">We cannot detail all aspects of the PHP-FPM configuration here (they are largely documented in the configuration file itself anyway), but there are important configuration directives that you </span><span class="No-Break"><span class="koboSpan" id="kobo.807.1">shouldn’t miss:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.808.1">Edit the user(s) and group(s) used by worker processes and, optionally, </span><span class="No-Break"><span class="koboSpan" id="kobo.809.1">Unix sockets</span></span></li>
<li><span class="koboSpan" id="kobo.810.1">Address(es) and port(s) on which PHP-FPM will </span><span class="No-Break"><span class="koboSpan" id="kobo.811.1">be listening</span></span></li>
<li><span class="koboSpan" id="kobo.812.1">Number of simultaneous requests that will </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">be served</span></span></li>
<li><span class="koboSpan" id="kobo.814.1">IP address(es) allowed to connec</span><a id="_idTextAnchor596"/><a id="_idTextAnchor597"/><span class="koboSpan" id="kobo.815.1">t </span><span class="No-Break"><span class="koboSpan" id="kobo.816.1">to PHP-FPM</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.817.1">Running and controlling</span></h3>
<p><span class="koboSpan" id="kobo.818.1">Once</span><a id="_idIndexMarker387"/><span class="koboSpan" id="kobo.819.1"> you have made the appropriate changes to the PHP-FPM</span><a id="_idIndexMarker388"/><span class="koboSpan" id="kobo.820.1"> configuration file, you may start or restart it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.821.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.822.1">
[root@local ~]# systemctl restart php-fpm</span></pre> <p><span class="koboSpan" id="kobo.823.1">The preceding command will restart your </span><strong class="source-inline"><span class="koboSpan" id="kobo.824.1">php-fpm</span></strong><span class="koboSpan" id="kobo.825.1"> daemon; you can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.826.1">start</span></strong><span class="koboSpan" id="kobo.827.1"> if your daemon hasn’t been </span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">running yet.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.829.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.830.1">You can see the current </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">php-fpm</span></strong><span class="koboSpan" id="kobo.832.1"> load and requests live by typing </span><strong class="source-inline"><span class="koboSpan" id="kobo.833.1">systemctl status php-fpm</span></strong><span class="koboSpan" id="kobo.834.1">. </span><span class="koboSpan" id="kobo.834.2">This command can be very helpful as it will let you know whether your server is saturated or </span><span class="No-Break"><span class="koboSpan" id="kobo.835.1">wo</span><a id="_idTextAnchor598"/><span class="koboSpan" id="kobo.836.1">r</span><a id="_idTextAnchor599"/><span class="koboSpan" id="kobo.837.1">king properly.</span></span></p>
<h2 id="_idParaDest-124"><a id="_idTextAnchor600"/><span class="koboSpan" id="kobo.838.1">NGINX configuration</span></h2>
<p><span class="koboSpan" id="kobo.839.1">If you have </span><a id="_idIndexMarker389"/><span class="koboSpan" id="kobo.840.1">managed to configure and start PHP-FPM correctly, you are ready to tweak your NGINX configuration file to establish a connection between both parties. </span><span class="koboSpan" id="kobo.840.2">The following server block is a simple, valid template on which you can base your own </span><span class="No-Break"><span class="koboSpan" id="kobo.841.1">website configuration:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.842.1">
server {
    server_name .website.com; # server name, accepting www
    listen 80; # listen on port 80
    root /home/website/www; # our root document path
    index index.php; # default request filename: index.php
    location ~* \.php$ { # for requests ending with .php
        # specify the listening address and port that you configured previously
        fastcgi_pass 127.0.0.1:9000;
        # the document path to be passed to PHP-FPM
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        # the script filename to be passed to PHP-FPM
        fastcgi_param PATH_INFO $fastcgi_script_name;
        # include other FastCGI related configuration settings
        include fastcgi_params;
    }
}</span></pre> <p><span class="koboSpan" id="kobo.843.1">After </span><a id="_idIndexMarker390"/><span class="koboSpan" id="kobo.844.1">saving the configuration file, </span><span class="No-Break"><span class="koboSpan" id="kobo.845.1">reload NGINX:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.846.1">
[root@local ~]# systemctl reload nginx</span></pre> <p><span class="koboSpan" id="kobo.847.1">Create a simple script at the root of your website to make sure PHP is being </span><span class="No-Break"><span class="koboSpan" id="kobo.848.1">correctly interpreted:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.849.1">
[user@local ~]# echo "&lt;?php phpinfo(); ?&gt;" &gt;/home/website/www/index.php</span></pre> <p><span class="koboSpan" id="kobo.850.1">Fire up your favorite web browser and load </span><strong class="source-inline"><span class="koboSpan" id="kobo.851.1">http://localhost/</span></strong><span class="koboSpan" id="kobo.852.1"> (or your website URL). </span><span class="koboSpan" id="kobo.852.2">You should see something similar to the following screenshot, which is the PHP server </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">information page:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer031">
<span class="koboSpan" id="kobo.854.1"><img alt="Figure 5.4: A screenshot of the PHP server information page" src="image/B21787_05_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.855.1">Figure 5.4: A screenshot of the PHP server information page</span></p>
<p><span class="koboSpan" id="kobo.856.1">Note that you may run into the occasional </span><strong class="source-inline"><span class="koboSpan" id="kobo.857.1">403 Forbidden</span></strong><span class="koboSpan" id="kobo.858.1"> HTTP error if the file and directory access permissions are not properly configured. </span><span class="koboSpan" id="kobo.858.2">If that is the case, make sure that you specify </span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.859.1">the correct user and group in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">php-fpm.conf</span></strong><span class="koboSpan" id="kobo.861.1"> file and that the directory and files are </span><a id="_idTextAnchor601"/><span class="koboSpan" id="kobo.862.1">readable </span><span class="No-Break"><span class="koboSpan" id="kobo.863.1">by PHP.</span></span></p>
<p><span class="koboSpan" id="kobo.864.1">We’ve learned how to set up NGINX with PHP using the PHP-FPM server. </span><span class="koboSpan" id="kobo.864.2">In the next section, we’ll learn how to do the same thing, this time with </span><a id="_idTextAnchor602"/><span class="koboSpan" id="kobo.865.1">a </span><span class="No-Break"><span class="koboSpan" id="kobo.866.1">Python server.</span></span></p>
<h1 id="_idParaDest-125"><a id="_idTextAnchor603"/><span class="koboSpan" id="kobo.867.1">Python and NGINX</span></h1>
<p><span class="koboSpan" id="kobo.868.1">Python is </span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.869.1">a popular </span><strong class="bold"><span class="koboSpan" id="kobo.870.1">object-oriented programming</span></strong><span class="koboSpan" id="kobo.871.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.872.1">OOP</span></strong><span class="koboSpan" id="kobo.873.1">) language available on many</span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.874.1"> platforms, from Unix-based </span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.875.1">systems to Windows. </span><span class="koboSpan" id="kobo.875.2">It is also available for Java and the Microsoft .NET platform. </span><span class="koboSpan" id="kobo.875.3">If you are interested in configuring Python to work with NGINX, it’s likely that you already have a clear idea of what Python does. </span><span class="koboSpan" id="kobo.875.4">We are going to use Python as a server-side web programming language, with the help of t</span><a id="_idTextAnchor604"/><span class="koboSpan" id="kobo.876.1">h</span><a id="_idTextAnchor605"/><span class="koboSpan" id="kobo.877.1">e </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">Django framework.</span></span></p>
<h2 id="_idParaDest-126"><a id="_idTextAnchor606"/><span class="koboSpan" id="kobo.879.1">Django</span></h2>
<p><span class="koboSpan" id="kobo.880.1">Django is </span><a id="_idIndexMarker395"/><span class="koboSpan" id="kobo.881.1">an open source web development framework for Python that aims at making web development simple and easy, as its </span><span class="No-Break"><span class="koboSpan" id="kobo.882.1">slogan states:</span></span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.883.1">The web framework for perfectionists </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.884.1">with deadlines.</span></em></span></p>
<p><span class="koboSpan" id="kobo.885.1">More information is available on </span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.886.1">the project website </span><span class="No-Break"><span class="koboSpan" id="kobo.887.1">at </span></span><a href="https://www.djangoproject.com/"><span class="No-Break"><span class="koboSpan" id="kobo.888.1">https://www.djangoproject.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.889.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.890.1">Among other interesting features, such as a dynamic administrative interface, a caching framework, and unit tests, Django comes with a FastCGI manager. </span><span class="koboSpan" id="kobo.890.2">Although the usual way to deploy Django is through WSGI, we’re going to use Django’s FastCGI manager as it’s going to make things much simpler for us from the perspective of running Python </span><a id="_idTextAnchor607"/><span class="koboSpan" id="kobo.891.1">s</span><a id="_idTextAnchor608"/><span class="koboSpan" id="kobo.892.1">cripts </span><span class="No-Break"><span class="koboSpan" id="kobo.893.1">through NGINX.</span></span></p>
<h2 id="_idParaDest-127"><a id="_idTextAnchor609"/><span class="koboSpan" id="kobo.894.1">Setting up Python and Django</span></h2>
<p><span class="koboSpan" id="kobo.895.1">We will </span><a id="_idIndexMarker397"/><span class="koboSpan" id="kobo.896.1">now install Python and Django on your Linux operating system, along </span><a id="_idIndexMarker398"/><span class="koboSpan" id="kobo.897.1">with its prerequisites. </span><span class="koboSpan" id="kobo.897.2">The process is relatively smooth and mostly consists of running a couple of commands th</span><a id="_idTextAnchor610"/><span class="koboSpan" id="kobo.898.1">a</span><a id="_idTextAnchor611"/><span class="koboSpan" id="kobo.899.1">t rarely </span><span class="No-Break"><span class="koboSpan" id="kobo.900.1">cause trouble.</span></span></p>
<h3><span class="koboSpan" id="kobo.901.1">Python</span></h3>
<p><span class="koboSpan" id="kobo.902.1">Python </span><a id="_idIndexMarker399"/><span class="koboSpan" id="kobo.903.1">should be available on your package manager repositories. </span><span class="koboSpan" id="kobo.903.2">To install it, run the following commands. </span><span class="koboSpan" id="kobo.903.3">For Red Hat-based systems and other systems using </span><strong class="source-inline"><span class="koboSpan" id="kobo.904.1">dnf</span></strong><span class="koboSpan" id="kobo.905.1"> as the package manager, use </span><span class="No-Break"><span class="koboSpan" id="kobo.906.1">this command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.907.1">
[root@local ~]# dnf install python python-devel</span></pre> <p><span class="koboSpan" id="kobo.908.1">For Ubuntu, Debian, and other systems that use </span><strong class="source-inline"><span class="koboSpan" id="kobo.909.1">apt</span></strong><span class="koboSpan" id="kobo.910.1">, use </span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">this command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.912.1">
[root@local ~]# apt install python python-dev</span></pre> <p><span class="koboSpan" id="kobo.913.1">The package manager will resolv</span><a id="_idTextAnchor612"/><span class="koboSpan" id="kobo.914.1">e</span><a id="_idTextAnchor613"/><span class="koboSpan" id="kobo.915.1"> dependencies </span><span class="No-Break"><span class="koboSpan" id="kobo.916.1">by itself.</span></span></p>
<h3><span class="koboSpan" id="kobo.917.1">Django</span></h3>
<p><span class="koboSpan" id="kobo.918.1">In order to </span><a id="_idIndexMarker400"/><span class="koboSpan" id="kobo.919.1">install Django, we will use a different approach (although you could skip this entirely and just install it from your usual repositories). </span><span class="koboSpan" id="kobo.919.2">We will be downloading the framework with </span><strong class="source-inline"><span class="koboSpan" id="kobo.920.1">pip</span></strong><span class="koboSpan" id="kobo.921.1">, a tool that simplifies the installation of Python packages. </span><span class="koboSpan" id="kobo.921.2">Therefore, the first step is to install </span><strong class="source-inline"><span class="koboSpan" id="kobo.922.1">pip</span></strong><span class="koboSpan" id="kobo.923.1">; for Red Hat-based systems and other systems using </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1">dnf</span></strong><span class="koboSpan" id="kobo.925.1"> as the package manager, execute the </span><span class="No-Break"><span class="koboSpan" id="kobo.926.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.927.1">
[root@local ~]# dnf install python-pip</span></pre> <p><span class="koboSpan" id="kobo.928.1">For Ubuntu, Debian, and other systems that use </span><strong class="source-inline"><span class="koboSpan" id="kobo.929.1">apt</span></strong><span class="koboSpan" id="kobo.930.1">, use </span><span class="No-Break"><span class="koboSpan" id="kobo.931.1">this command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.932.1">
[root@local ~]# apt install python-pip</span></pre> <p><span class="koboSpan" id="kobo.933.1">The package manager will resolve dependencies by itself. </span><span class="koboSpan" id="kobo.933.2">Once </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1">pip</span></strong><span class="koboSpan" id="kobo.935.1"> is installed, run the following command to download and install Django 1.8.2, the latest stable version </span><span class="No-Break"><span class="koboSpan" id="kobo.936.1">to date:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.937.1">
[root@website.com ~]# pip install Django==5.0.3
[...]
[root@website.com ~]# pip install -e django-trunk/</span></pre> <p><span class="koboSpan" id="kobo.938.1">Finally, there is one last component required to run the Python FastCGI manager: the </span><strong class="source-inline"><span class="koboSpan" id="kobo.939.1">flup</span></strong><span class="koboSpan" id="kobo.940.1"> library. </span><span class="koboSpan" id="kobo.940.2">This provides the actual FastCGI protocol implementation. </span><span class="koboSpan" id="kobo.940.3">For Red Hat-based systems and other systems using </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1">dnf</span></strong><span class="koboSpan" id="kobo.942.1"> as the package manager (</span><strong class="bold"><span class="koboSpan" id="kobo.943.1">Extra Packages for Enterprise Linux</span></strong><span class="koboSpan" id="kobo.944.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.945.1">EPEL</span></strong><span class="koboSpan" id="kobo.946.1">) repositories </span><a id="_idIndexMarker401"/><span class="koboSpan" id="kobo.947.1">must be enabled; otherwise, you will need to build from source), use the </span><span class="No-Break"><span class="koboSpan" id="kobo.948.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.949.1">
[root@local ~]# dnf install python-flup</span></pre> <p><span class="koboSpan" id="kobo.950.1">For Ubuntu, Debian, and other systems that use </span><strong class="source-inline"><span class="koboSpan" id="kobo.951.1">apt</span></strong><span class="koboSpan" id="kobo.952.1">, use </span><span class="No-Break"><span class="koboSpan" id="kobo.953.1">this command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.954.1">
[root@local </span><a id="_idTextAnchor614"/><span class="koboSpan" id="kobo.955.1">~</span><a id="_idTextAnchor615"/><span class="koboSpan" id="kobo.956.1">]# apt install python-flup</span></pre> <h3><span class="koboSpan" id="kobo.957.1">Starting the FastCGI process manager</span></h3>
<p><span class="koboSpan" id="kobo.958.1">The </span><a id="_idIndexMarker402"/><span class="koboSpan" id="kobo.959.1">process of beginning to build a website with the Django framework is as simple as running the </span><span class="No-Break"><span class="koboSpan" id="kobo.960.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.961.1">
[root@website.com ~]# django-admin startproject mysite</span></pre> <p><span class="koboSpan" id="kobo.962.1">Once that part is done, you will find a </span><strong class="source-inline"><span class="koboSpan" id="kobo.963.1">manage.py</span></strong><span class="koboSpan" id="kobo.964.1"> Python script that comes with the default project template. </span><span class="koboSpan" id="kobo.964.2">Open the newly created </span><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">mysite</span></strong><span class="koboSpan" id="kobo.966.1"> directory containing </span><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">manage.py</span></strong><span class="koboSpan" id="kobo.968.1">, and run the </span><span class="No-Break"><span class="koboSpan" id="kobo.969.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.970.1">
[root@website.com mysite]# python manage.py runfcgi method=prefork host=127.0.0.1 port=9000 pidfile=/var/run/django.pid</span></pre> <p><span class="koboSpan" id="kobo.971.1">If everything is correctly configured and the dependencies are properly installed, running this command should produce no output, which is often a good sign. </span><span class="koboSpan" id="kobo.971.2">The FastCGI process manager is now running in the background, waiting for connections. </span><span class="koboSpan" id="kobo.971.3">You can verify that the application is running with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.972.1">ps</span></strong><span class="koboSpan" id="kobo.973.1"> command (for example, by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.974.1">ps aux | grep python</span></strong><span class="koboSpan" id="kobo.975.1">). </span><span class="koboSpan" id="kobo.975.2">If you don’t see any running process, try changing the previous command slightly by selecting a different port. </span><span class="koboSpan" id="kobo.975.3">All we need to do now is to set up the virtual host in t</span><a id="_idTextAnchor616"/><span class="koboSpan" id="kobo.976.1">h</span><a id="_idTextAnchor617"/><span class="koboSpan" id="kobo.977.1">e NGINX </span><span class="No-Break"><span class="koboSpan" id="kobo.978.1">configuration file.</span></span></p>
<h2 id="_idParaDest-128"><a id="_idTextAnchor618"/><span class="koboSpan" id="kobo.979.1">NGINX configuration</span></h2>
<p><span class="koboSpan" id="kobo.980.1">The </span><a id="_idIndexMarker403"/><span class="koboSpan" id="kobo.981.1">NGINX configuration is similar to the </span><span class="No-Break"><span class="koboSpan" id="kobo.982.1">PHP one:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.983.1">
server {
    server_name .website.com;
listen 80;
# Insert the path of your Python project public files below
    root /home/website/www;
    index index.html;
    location / {
       fastcgi_pass 127.0.0.1:9000;
        fastcgi_param SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_script_name;
        includ</span><a id="_idTextAnchor619"/><span class="koboSpan" id="kobo.984.1">e fastcgi_params;
    }
}</span></pre> <p><span class="koboSpan" id="kobo.985.1">We’ve now </span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.986.1">completed covering running NGINX with Python </span><span class="No-Break"><span class="koboSpan" id="kobo.987.1">via FastCGI.</span></span></p>
<h1 id="_idParaDest-129"><a id="_idTextAnchor620"/><span class="koboSpan" id="kobo.988.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.989.1">Whether you use PHP, Python, or any other CGI application, you should now have a clear idea of how to get your scripts processed behind NGINX. </span><span class="koboSpan" id="kobo.989.2">There are all sorts of implementations on the web for mainstream programming languages and the FastCGI protocol. </span><span class="koboSpan" id="kobo.989.3">Due to its efficiency, it is starting to replace server-integrated solutions such as Apache’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">mod_php</span></strong><span class="koboSpan" id="kobo.991.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.992.1">mod_wsgi</span></strong><span class="koboSpan" id="kobo.993.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.994.1">among others.</span></span></p>
<p><span class="koboSpan" id="kobo.995.1">In the next chapter, we will learn how to use NGINX as a frontend for microservices, enabling us to improve the security and speed of web applications by running NGINX in front </span><span class="No-Break"><span class="koboSpan" id="kobo.996.1">of them.</span></span></p>
</div>
</body></html>