<html><head></head><body>
<div id="_idContainer027">
<h1 class="chapter-number" id="_idParaDest-95"><a id="_idTextAnchor412"/><span class="koboSpan" id="kobo.1.1">4</span></h1>
<h1 id="_idParaDest-96"><a id="_idTextAnchor413"/><span class="koboSpan" id="kobo.2.1">Exploring Module Configuration in NGINX</span></h1>
<p><span class="koboSpan" id="kobo.3.1">The true power of NGINX lies within its modules. </span><span class="koboSpan" id="kobo.3.2">The entire application is built on a modular system, and each module can be enabled or disabled at compile time. </span><span class="koboSpan" id="kobo.3.3">Some bring up simple functionalities, such as the autoindex module, which generates a listing of the files in a directory. </span><span class="koboSpan" id="kobo.3.4">Some will transform your perception of a web server (such as the Rewrite module). </span><span class="koboSpan" id="kobo.3.5">Apart from the NGINX modules that already exist, developers can also create their own modules to suit </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">their needs.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">A quick overview of the third-party module system can be found at the end of this chapter. </span><span class="koboSpan" id="kobo.5.2">Please note that third-party modules are maintained by the community, and there is no guarantee that these modules will be compatible with your version </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">of NGINX.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">This chapter covers the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">The Rewrite module, which does more than just </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">rewrite URIs</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Additional modules enabled in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">NGINX build</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Optional modules that must be enabled at </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">compile time</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">A quick note on </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">third-party modules</span></span><a id="_idTextAnchor414"/></li>
</ul>
<h1 id="_idParaDest-97"><a id="_idTextAnchor415"/><span class="koboSpan" id="kobo.17.1">Exploring the Rewrite module</span></h1>
<p><span class="koboSpan" id="kobo.18.1">This module, in particular, brings</span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.19.1"> much more functionality to NGINX than a simple set of directives. </span><span class="koboSpan" id="kobo.19.2">It defines a whole new level of request processing that will be explained throughout </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">this section.</span></span></p>
<p><span class="koboSpan" id="kobo.21.1">Initially, the purpose of this module (as the name suggests) is to perform URL rewriting. </span><span class="koboSpan" id="kobo.21.2">This mechanism allows you to get rid of ugly URLs containing multiple parameters—for instance, </span><a href="http://example.com/article.php?id=1234&amp;comment=32-such"><span class="koboSpan" id="kobo.22.1">http://example.com/article.php?id=1234&amp;comment=32—such</span></a><span class="koboSpan" id="kobo.23.1"> URLs being particularly uninformative and meaningless for a </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">regular visitor.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">Instead, links to your website will contain useful information that indicates the nature of the page you are about to visit. </span><span class="koboSpan" id="kobo.25.2">The URL given in the example becomes </span><a href="http://website.com/article-1234-32-US-economy-strengthens.html"><span class="koboSpan" id="kobo.26.1">http://website.com/article-1234-32-US-economy-strengthens.html</span></a><span class="koboSpan" id="kobo.27.1">. </span><span class="koboSpan" id="kobo.27.2">This solution is not only more interesting for your visitors but also for search engines. </span><span class="koboSpan" id="kobo.27.3">URL </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.28.1">rewriting is a key element of </span><strong class="bold"><span class="koboSpan" id="kobo.29.1">search engine </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.30.1">optimization</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.31.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.32.1">SEO</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.34.1">The principle behind this mechanism</span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.35.1"> is simple: it consists of rewriting the URI of the client request after it is received, before serving the file. </span><span class="koboSpan" id="kobo.35.2">Once rewritten, the URI is matched against </span><strong class="source-inline"><span class="koboSpan" id="kobo.36.1">location</span></strong><span class="koboSpan" id="kobo.37.1"> blocks in order to find the configuration that should be applied to the request. </span><span class="koboSpan" id="kobo.37.2">The technique is further detailed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">coming sectio</span><a id="_idTextAnchor416"/><span class="koboSpan" id="kobo.39.1">n</span><a id="_idTextAnchor417"/><span class="koboSpan" id="kobo.40.1">s.</span></span></p>
<h2 id="_idParaDest-98"><a id="_idTextAnchor418"/><span class="koboSpan" id="kobo.41.1">Reminder of regular expressions</span></h2>
<p><span class="koboSpan" id="kobo.42.1">First and foremost, this module</span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.43.1"> requires a certain understanding of regular expressions, also known as </span><strong class="bold"><span class="koboSpan" id="kobo.44.1">regexes</span></strong><span class="koboSpan" id="kobo.45.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.46.1">regexps</span></strong><span class="koboSpan" id="kobo.47.1">. </span><span class="koboSpan" id="kobo.47.2">Indeed, URL rewriting is performed by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1">rewrite</span></strong><span class="koboSpan" id="kobo.49.1"> directive, which accepts a pattern followed by the </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">replacement URI.</span></span></p>
<p><span class="koboSpan" id="kobo.51.1">It is a vast topic; entire books are dedicated to explaining the ins and outs. </span><span class="koboSpan" id="kobo.51.2">However, the simplified approach that we are about to examine should be more than sufficient to make the most of </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">the mechan</span><a id="_idTextAnchor419"/><span class="koboSpan" id="kobo.53.1">i</span><a id="_idTextAnchor420"/><span class="koboSpan" id="kobo.54.1">sm.</span></span></p>
<h3><span class="koboSpan" id="kobo.55.1">Purpose</span></h3>
<p><span class="koboSpan" id="kobo.56.1">The first question</span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.57.1"> we must answer is: What is the purpose of regular expressions? </span><span class="koboSpan" id="kobo.57.2">To put it simply, the main purpose is to verify that a string of characters matches a given pattern. </span><span class="koboSpan" id="kobo.57.3">The pattern is written in a particular language that allows for defining extremely complex and </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">accurate rules:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-4">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.59.1">String</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.60.1">Pattern</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.61.1">Does </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.62.1">it match?</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.63.1">Explanation</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">hello</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.65.1">^</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">hello$</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.67.1">Yes</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.68.1">The string begins with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.69.1">h</span></strong><span class="koboSpan" id="kobo.70.1"> character (</span><strong class="source-inline"><span class="koboSpan" id="kobo.71.1">^h</span></strong><span class="koboSpan" id="kobo.72.1">), followed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">e</span></strong><span class="koboSpan" id="kobo.74.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.75.1">l</span></strong><span class="koboSpan" id="kobo.76.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.77.1">l</span></strong><span class="koboSpan" id="kobo.78.1">, and then finishes with </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">o</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.80.1"> (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">o$</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">).</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">hell</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">^</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.85.1">hello$</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.86.1">No</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.87.1">The string begins with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">h</span></strong><span class="koboSpan" id="kobo.89.1"> character (</span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">^h</span></strong><span class="koboSpan" id="kobo.91.1">), followed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">e</span></strong><span class="koboSpan" id="kobo.93.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">l</span></strong><span class="koboSpan" id="kobo.95.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.96.1">l</span></strong><span class="koboSpan" id="kobo.97.1">, but does not finish </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">o</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">Hello</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">^</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">hello$</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.104.1">Depends</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.105.1">If the engine performing the match is case-sensitive, the string doesn’t match </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">the pattern.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.107.1">Table 4.1: A list of patterns with explanations</span></p>
<p><span class="koboSpan" id="kobo.108.1">This concept becomes a lot more interesting when complex patterns are employed, such as one that validates an email address: </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$</span></strong><span class="koboSpan" id="kobo.110.1">. </span><span class="koboSpan" id="kobo.110.2">Validating a well-formed email address programmatically would require a great deal of code, while</span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.111.1"> all of the work can be done with a single regular expression </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">pattern matching</span><a id="_idTextAnchor421"/><span class="koboSpan" id="kobo.113.1">.</span></span><a id="_idTextAnchor422"/></p>
<h3><span class="koboSpan" id="kobo.114.1">PCRE syntax</span></h3>
<p><span class="koboSpan" id="kobo.115.1">The syntax</span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.116.1"> that NGINX</span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.117.1"> employs originates from the </span><strong class="bold"><span class="koboSpan" id="kobo.118.1">Perl Compatible Regular Expressions</span></strong><span class="koboSpan" id="kobo.119.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.120.1">PCRE</span></strong><span class="koboSpan" id="kobo.121.1">) library, which (if you remember </span><a href="B21787_02.xhtml#_idTextAnchor121"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.122.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.123.1">) is a prerequisite for making your own build unless you disable modules that make use of it. </span><span class="koboSpan" id="kobo.123.2">It’s the most commonly used form of regular expression, and nearly everything you learn here remains valid for other </span><span class="No-Break"><span class="koboSpan" id="kobo.124.1">language variations.</span></span></p>
<p><span class="koboSpan" id="kobo.125.1">In its simplest form, a pattern is composed of one character—for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">x</span></strong><span class="koboSpan" id="kobo.127.1">. </span><span class="koboSpan" id="kobo.127.2">We can match strings against this pattern. </span><span class="koboSpan" id="kobo.127.3">Does </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">example</span></strong><span class="koboSpan" id="kobo.129.1"> match the </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">x</span></strong><span class="koboSpan" id="kobo.131.1"> pattern? </span><span class="koboSpan" id="kobo.131.2">Yes, </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">example</span></strong><span class="koboSpan" id="kobo.133.1"> contains the </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">x</span></strong><span class="koboSpan" id="kobo.135.1"> character. </span><span class="koboSpan" id="kobo.135.2">It can be more than one specific character; the </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">[a-z]</span></strong><span class="koboSpan" id="kobo.137.1"> pattern matches any character between </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">a</span></strong><span class="koboSpan" id="kobo.139.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">z</span></strong><span class="koboSpan" id="kobo.141.1">, or even a combination of letters and digits: </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">[a-z0-9]</span></strong><span class="koboSpan" id="kobo.143.1">. </span><span class="koboSpan" id="kobo.143.2">In consequence, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">hell[a-z0-9]</span></strong><span class="koboSpan" id="kobo.145.1"> pattern validates the following strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">hello</span></strong><span class="koboSpan" id="kobo.147.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.148.1">hell4</span></strong><span class="koboSpan" id="kobo.149.1">, but not </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">hell</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.151.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">hell!</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.154.1">You probably noticed</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.155.1"> that we employed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">[</span></strong><span class="koboSpan" id="kobo.157.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">]</span></strong><span class="koboSpan" id="kobo.159.1"> characters. </span><span class="koboSpan" id="kobo.159.2">These are called </span><strong class="bold"><span class="koboSpan" id="kobo.160.1">metacharacters</span></strong><span class="koboSpan" id="kobo.161.1"> and have a special effect on the pattern. </span><span class="koboSpan" id="kobo.161.2">There is a total of </span><em class="italic"><span class="koboSpan" id="kobo.162.1">11</span></em><span class="koboSpan" id="kobo.163.1"> metacharacters, and all play a different role. </span><span class="koboSpan" id="kobo.163.2">If you want to create a pattern that actually contains one of these characters, you need to escape the character with </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">\</span></strong><span class="koboSpan" id="kobo.165.1"> (</span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">backslash):</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002-2">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.167.1">Metacharacter</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.168.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">^</span></strong></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.170.1">Beginning</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.171.1">The entity after this character must be found at </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">the beginning:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.173.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">^h</span></strong></span></li>
<li><span class="koboSpan" id="kobo.176.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">hello</span></strong><span class="koboSpan" id="kobo.178.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">h</span></strong><span class="koboSpan" id="kobo.180.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">hh</span></strong><span class="koboSpan" id="kobo.182.1"> (anything beginning </span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">with </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.184.1">h</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.186.1">Non-matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">character</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">ssh</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">$</span></strong></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.191.1">End</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.192.1">The entity before this character must be found at </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1">the end:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.194.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">e$</span></strong></span></li>
<li><span class="koboSpan" id="kobo.197.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">sample</span></strong><span class="koboSpan" id="kobo.199.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">e</span></strong><span class="koboSpan" id="kobo.201.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">file</span></strong><span class="koboSpan" id="kobo.203.1"> (anything ending </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">with </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.205.1">e</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.207.1">Non-matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">extra</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">shell</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">.</span></strong><span class="koboSpan" id="kobo.212.1"> (</span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">dot)</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.214.1">Any</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.215.1">Matches </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">any character:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.217.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">hell.</span></strong></span></li>
<li><span class="koboSpan" id="kobo.220.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">hello</span></strong><span class="koboSpan" id="kobo.222.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">hellx</span></strong><span class="koboSpan" id="kobo.224.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">hell5</span></strong><span class="koboSpan" id="kobo.226.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">hell!</span></strong></span></li>
<li><span class="koboSpan" id="kobo.229.1">Non-matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">hell</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">helo</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">[ ]</span></strong></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.234.1">Set</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.235.1">Matches any character within the </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">specified set:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.237.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">[a-z]</span></strong><span class="koboSpan" id="kobo.239.1"> for a range, </span><strong class="source-inline"><span class="koboSpan" id="kobo.240.1">[abcd]</span></strong><span class="koboSpan" id="kobo.241.1"> for a set, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">[a-z0-9]</span></strong><span class="koboSpan" id="kobo.243.1"> for two ranges. </span><span class="koboSpan" id="kobo.243.2">Note that if you want to include the </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">-</span></strong><span class="koboSpan" id="kobo.245.1"> character in a range, you need to insert it right after </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">[</span></strong><span class="koboSpan" id="kobo.247.1"> or just </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">before </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">]</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.251.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">hell[a-y123-]</span></strong></span></li>
<li><span class="koboSpan" id="kobo.254.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">hello</span></strong><span class="koboSpan" id="kobo.256.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">hell1</span></strong><span class="koboSpan" id="kobo.258.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">hell2</span></strong><span class="koboSpan" id="kobo.260.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">hell3</span></strong><span class="koboSpan" id="kobo.262.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">hell-</span></strong></span></li>
<li><span class="koboSpan" id="kobo.265.1">Non-matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">hellz</span></strong><span class="koboSpan" id="kobo.267.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">hell4</span></strong><span class="koboSpan" id="kobo.269.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">heloo</span></strong><span class="koboSpan" id="kobo.271.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">he-llo</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">[^ ]</span></strong></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.275.1">Negate set</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.276.1">Matches any character that is not within the </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">specified set:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.278.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">hell[^a-np-z0-9]</span></strong></span></li>
<li><span class="koboSpan" id="kobo.281.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">hello</span></strong><span class="koboSpan" id="kobo.283.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">hell!</span></strong></span></li>
<li><span class="koboSpan" id="kobo.286.1">Non-matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">hella</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">hell5</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">|</span></strong></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.291.1">Alternation</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.292.1">Matches the entity placed either before or </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">after </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">|</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.296.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">hello|welcome</span></strong></span></li>
<li><span class="koboSpan" id="kobo.299.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">hello</span></strong><span class="koboSpan" id="kobo.301.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">welcome</span></strong><span class="koboSpan" id="kobo.303.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">helloes</span></strong><span class="koboSpan" id="kobo.305.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">awelcome</span></strong></span></li>
<li><span class="koboSpan" id="kobo.308.1">Non-matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">hell</span></strong><span class="koboSpan" id="kobo.310.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">ellow</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">owelcom</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">( )</span></strong></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.315.1">Grouping</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.316.1">Groups a set of entities, often to be used in conjunction with </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">|</span></strong><span class="koboSpan" id="kobo.318.1">. </span><span class="koboSpan" id="kobo.318.2">Also </span><strong class="bold"><span class="koboSpan" id="kobo.319.1">captures</span></strong><span class="koboSpan" id="kobo.320.1"> the matched entities; captures are detailed </span><span class="No-Break"><span class="koboSpan" id="kobo.321.1">further on:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.322.1">Example pattern: </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">^(</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">hello|hi) there$</span></strong></span></li>
<li><span class="koboSpan" id="kobo.325.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">hello there</span></strong><span class="koboSpan" id="kobo.327.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">hi there</span></strong></span></li>
<li><span class="koboSpan" id="kobo.329.1">Non-matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">hey there</span></strong><span class="koboSpan" id="kobo.331.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">ahoy there</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.333.1">\</span></strong></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.334.1">Escape</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.335.1">Allows you to escape </span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">special characters:</span></span></p>
<p><span class="koboSpan" id="kobo.337.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.338.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">Hello\</span></strong></span></p>
<p><span class="koboSpan" id="kobo.340.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">Hello.</span></strong><span class="koboSpan" id="kobo.342.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">Hello. </span><span class="koboSpan" id="kobo.343.2">How are you?</span></strong><span class="koboSpan" id="kobo.344.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">Hi! </span><span class="koboSpan" id="kobo.345.2">Hello...</span></strong></span></p>
<p><span class="koboSpan" id="kobo.346.1">Non-matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">Hello</span></strong><span class="koboSpan" id="kobo.348.1">,  </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">Hello!how </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.350.1">are you?</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor423"/><span class="koboSpan" id="kobo.351.1">Table 4.2: A list of metacharacters and their roles</span></p>
<h3><a id="_idTextAnchor424"/><span class="koboSpan" id="kobo.352.1">Quantifiers</span></h3>
<p><span class="koboSpan" id="kobo.353.1">So far, you are able to express</span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.354.1"> simple patterns with a limited number of characters. </span><span class="koboSpan" id="kobo.354.2">Quantifiers</span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.355.1"> allow you to extend the number of </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">accepted entities:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table003-2">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.357.1">Quantifier</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.358.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">*</span></strong></p>
<p><span class="koboSpan" id="kobo.360.1">0 or </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">more times</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.362.1">The entity preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">*</span></strong><span class="koboSpan" id="kobo.364.1"> must be found 0 or </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">more times:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.366.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">he*llo</span></strong></span></li>
<li><span class="koboSpan" id="kobo.369.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">hllo</span></strong><span class="koboSpan" id="kobo.371.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">hello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.374.1">heeeello</span></strong></span></li>
<li><span class="koboSpan" id="kobo.375.1">Non-matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">hallo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">ello</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">+</span></strong></p>
<p><span class="koboSpan" id="kobo.380.1">1 or </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">more times</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.382.1">The entity preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">+</span></strong><span class="koboSpan" id="kobo.384.1"> must be found 1 or </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">more times:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.386.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">he+llo</span></strong></span></li>
<li><span class="koboSpan" id="kobo.389.1">Matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">hello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">heeeello</span></strong></span></li>
<li><span class="koboSpan" id="kobo.393.1">Non-matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">hllo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">helo</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">?</span></strong></p>
<p><span class="koboSpan" id="kobo.398.1">0 or </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">1 times</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.400.1">The entity preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">?</span></strong><span class="koboSpan" id="kobo.402.1"> must be found 0 or </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">1 times:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.404.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">he?llo</span></strong></span></li>
<li><span class="koboSpan" id="kobo.407.1">Matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.408.1">hello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">hllo</span></strong></span></li>
<li><span class="koboSpan" id="kobo.411.1">Non-matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">heello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">heeeello</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">{</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">x}</span></strong></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">x</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.418.1"> times</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.419.1">The entity preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">{x}</span></strong><span class="koboSpan" id="kobo.421.1"> must be found </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">x</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.423.1"> times:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.424.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">he{3}llo</span></strong></span></li>
<li><span class="koboSpan" id="kobo.427.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">heeello</span></strong><span class="koboSpan" id="kobo.429.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">oh </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.431.1">heeello there!</span></strong></span></li>
<li><span class="koboSpan" id="kobo.432.1">Non-matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.433.1">hello</span></strong><span class="koboSpan" id="kobo.434.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">heello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">heeeello</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">{</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">x,}</span></strong></span></p>
<p><span class="koboSpan" id="kobo.440.1">At least </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">x</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.442.1"> times</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.443.1">The entity preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.444.1">{x,}</span></strong><span class="koboSpan" id="kobo.445.1"> must be found at least </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">x</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.447.1"> times:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.448.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.449.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">he{3,}llo</span></strong></span></li>
<li><span class="koboSpan" id="kobo.451.1">Matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">heeello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">heeeeeeello</span></strong></span></li>
<li><span class="koboSpan" id="kobo.455.1">Non-matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">hllo</span></strong><span class="koboSpan" id="kobo.457.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">hello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.460.1">hello</span></strong></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">{</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">x,y}</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">x</span></strong><span class="koboSpan" id="kobo.464.1"> to </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">y</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.466.1"> times</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.467.1">The entity preceding </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">{x,y}</span></strong><span class="koboSpan" id="kobo.469.1"> must be found between </span><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">x</span></strong><span class="koboSpan" id="kobo.471.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">y</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.473.1"> times:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.474.1">Example </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">pattern: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.476.1">he{2,4}llo</span></strong></span></li>
<li><span class="koboSpan" id="kobo.477.1">Matching strings: </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">heello</span></strong><span class="koboSpan" id="kobo.479.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">heeello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">heeeello</span></strong></span></li>
<li><span class="koboSpan" id="kobo.483.1">Non-matching strings: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">hello</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.485.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">heeeeello</span></strong></span></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.487.1">Table 4.3: A list of quantifiers and their roles</span></p>
<p><span class="koboSpan" id="kobo.488.1">As you probably</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.489.1"> noticed, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">{</span></strong><span class="koboSpan" id="kobo.491.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">}</span></strong><span class="koboSpan" id="kobo.493.1"> characters</span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.494.1"> in the regular expressions conflict with the block delimiter of the NGINX configuration file syntax language. </span><span class="koboSpan" id="kobo.494.2">If you want to write a regular expression pattern that includes </span><em class="italic"><span class="koboSpan" id="kobo.495.1">curly brackets</span></em><span class="koboSpan" id="kobo.496.1">, you need to place the pattern between quotes (single or </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">double quotes):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.498.1">
rewrite hel{2,}o /hello.php; # invalid
rewrite "hel{2,}o" /hello.php; # valid
rewrite 'hel{2,}o' /hello.php; # val</span><a id="_idTextAnchor425"/><span class="koboSpan" id="kobo.499.1">i</span><a id="_idTextAnchor426"/><span class="koboSpan" id="kobo.500.1">d</span></pre> <h3><span class="koboSpan" id="kobo.501.1">Captures</span></h3>
<p><span class="koboSpan" id="kobo.502.1">One last feature of the regular</span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.503.1"> expression mechanism</span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.504.1"> is the ability to capture sub-expressions. </span><span class="koboSpan" id="kobo.504.2">Whatever text is placed between parentheses (</span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">( )</span></strong><span class="koboSpan" id="kobo.506.1">) is captured and can be used after the matching process. </span><span class="koboSpan" id="kobo.506.2">The captured characters become available under the form of variables called </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">$N</span></strong><span class="koboSpan" id="kobo.508.1">, where </span><strong class="source-inline"><span class="koboSpan" id="kobo.509.1">N</span></strong><span class="koboSpan" id="kobo.510.1"> is a numeric index, in order of capture. </span><span class="koboSpan" id="kobo.510.2">Alternatively, you can attribute an arbitrary name to each of your captures (see the following example). </span><span class="koboSpan" id="kobo.510.3">Variables generated through the captures can be inserted within </span><span class="No-Break"><span class="koboSpan" id="kobo.511.1">directive values.</span></span></p>
<p><span class="koboSpan" id="kobo.512.1">Here are a couple of examples to illustrate </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">the principle:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table004-1">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.514.1">Pattern</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.515.1">Example of a </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.516.1">matching string</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.517.1">Captured</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.518.1">^(</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">hello|hi) (sir|mister)$</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">hello sir</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">$1 = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">hello</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">$2 = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">sir</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">^(</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">hello (sir))$</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">hello sir</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">$1 = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">hello sir</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">$2 = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">sir</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">^(.*)$</span></strong></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">nginx rocks</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">$1 = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">nginx rocks</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">^(.{</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">1,3})([0-9]{1,4})([?!]{1,2})$</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">abc1234!?</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">$1 = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.540.1">abc</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">$2 = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">1234</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">$3 = !?</span></strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.544.1">Named captures are also supported through the </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">following syntax:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">?&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">name&gt;</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.548.1">Example: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">^/(?&lt;folder&gt;[^/]+)/(?&lt;file&gt;.*)$</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">admin/doc</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">$folder = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.553.1">admin</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">$file = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">doc</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.556.1">Table 4.4: A list of patterns and expressions</span></p>
<p><span class="koboSpan" id="kobo.557.1">When you use a regular</span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.558.1"> expression in NGINX—for example, in the</span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.559.1"> context of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.560.1">location</span></strong><span class="koboSpan" id="kobo.561.1"> block—the buffers that you capture can be employed in </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">later directives:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.563.1">
server {
    server_name website.com;
    location ~* ^/(downloads|files)/(.*)$ {
        add_header Capture1 $1;
        add_header Capture2 $2;
    }
}</span></pre> <p><span class="koboSpan" id="kobo.564.1">In the preceding example, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.565.1">location</span></strong><span class="koboSpan" id="kobo.566.1"> block will match the request URI against a regular expression. </span><span class="koboSpan" id="kobo.566.2">A few URIs that would apply here are </span><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">/downloads/file.txt</span></strong><span class="koboSpan" id="kobo.568.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">/files/archive.zip</span></strong><span class="koboSpan" id="kobo.570.1">, or even </span><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">/files/docs/report.doc</span></strong><span class="koboSpan" id="kobo.572.1">. </span><span class="koboSpan" id="kobo.572.2">Two parts are captured: </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">$1</span></strong><span class="koboSpan" id="kobo.574.1"> will contain either </span><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">downloads</span></strong><span class="koboSpan" id="kobo.576.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">files</span></strong><span class="koboSpan" id="kobo.578.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">$2</span></strong><span class="koboSpan" id="kobo.580.1"> will contain whatever comes after </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">/downloads/</span></strong><span class="koboSpan" id="kobo.582.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.583.1">/files/</span></strong><span class="koboSpan" id="kobo.584.1">. </span><span class="koboSpan" id="kobo.584.2">Note that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">add_header</span></strong><span class="koboSpan" id="kobo.586.1"> directive (syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.587.1">add_header header_name header_value</span></strong><span class="koboSpan" id="kobo.588.1">; see the </span><em class="italic"><span class="koboSpan" id="kobo.589.1">HTTP headers </span></em><span class="koboSpan" id="kobo.590.1">section) is employed here to append arbitrary headers</span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.591.1"> to the client response, for the sole purpose</span><a id="_idIndexMarker261"/> <span class="No-Break"><span class="koboSpan" id="kobo.592.1">of demonstrati</span><a id="_idTextAnchor427"/><a id="_idTextAnchor428"/><span class="koboSpan" id="kobo.593.1">on.</span></span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor429"/><span class="koboSpan" id="kobo.594.1">Internal requests</span></h2>
<p><span class="koboSpan" id="kobo.595.1">NGINX differentiates</span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.596.1"> external and internal</span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.597.1"> requests. </span><span class="koboSpan" id="kobo.597.2">External requests originate directly from the client; the URI is then matched against possible </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.599.1"> blocks:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.600.1">
server {
    server_name website.com;
    location = /document.html {
        deny all; # example directive
    }
}</span></pre> <p><span class="koboSpan" id="kobo.601.1">A client request to </span><a href="http://website.com/document.html"><span class="koboSpan" id="kobo.602.1">http://website.com/document.html</span></a><span class="koboSpan" id="kobo.603.1"> would directly fall into the preceding </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.604.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.605.1"> block.</span></span></p>
<p><span class="koboSpan" id="kobo.606.1">Opposite to this, internal requests are triggered by NGINX via specific directives. </span><span class="koboSpan" id="kobo.606.2">Among the directives offered by the default</span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.607.1"> NGINX modules, there are several directives capable of producing internal</span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.608.1"> requests: </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">error_page</span></strong><span class="koboSpan" id="kobo.610.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.611.1">index</span></strong><span class="koboSpan" id="kobo.612.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">rewrite</span></strong><span class="koboSpan" id="kobo.614.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.615.1">try_files</span></strong><span class="koboSpan" id="kobo.616.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">add_before_body</span></strong><span class="koboSpan" id="kobo.618.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">add_after_body</span></strong><span class="koboSpan" id="kobo.620.1"> (from the addition module), the </span><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">include</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.622.1">Server-Side Includes</span></strong><span class="koboSpan" id="kobo.623.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.624.1">SSI</span></strong><span class="koboSpan" id="kobo.625.1">) command, </span><span class="No-Break"><span class="koboSpan" id="kobo.626.1">and</span></span><span class="No-Break"><a id="_idIndexMarker266"/></span><span class="No-Break"><span class="koboSpan" id="kobo.627.1"> more.</span></span></p>
<p><span class="koboSpan" id="kobo.628.1">There are two different types of </span><span class="No-Break"><span class="koboSpan" id="kobo.629.1">internal requests:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.630.1">Internal redirects</span></strong><span class="koboSpan" id="kobo.631.1">: NGINX redirects the client</span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.632.1"> requests internally. </span><span class="koboSpan" id="kobo.632.2">The URI is changed, and the request may therefore match another </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1">location</span></strong><span class="koboSpan" id="kobo.634.1"> block and become eligible for different settings. </span><span class="koboSpan" id="kobo.634.2">The most common case of internal redirects is when using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.635.1">rewrite</span></strong><span class="koboSpan" id="kobo.636.1"> directive, which allows you to rewrite the </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">request URI.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.638.1">Sub-requests</span></strong><span class="koboSpan" id="kobo.639.1">: Additional requests that are triggered</span><a id="_idIndexMarker268"/><span class="koboSpan" id="kobo.640.1"> internally to generate content that is complementary to the main request. </span><span class="koboSpan" id="kobo.640.2">A simple example would be with the addition module. </span><span class="koboSpan" id="kobo.640.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.641.1">add_after_body</span></strong><span class="koboSpan" id="kobo.642.1"> directive allows you to specify a URI that will be processed after the original one, the resulting content being appended to the body of the original request. </span><span class="koboSpan" id="kobo.642.2">The SSI module also makes use of sub-requests to insert content with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.643.1">include</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.644.1">S</span><a id="_idTextAnchor430"/><span class="koboSpan" id="kobo.645.1">S</span><a id="_idTextAnchor431"/><span class="koboSpan" id="kobo.646.1">I command.</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.647.1">error_page</span></h3>
<p><span class="koboSpan" id="kobo.648.1">Detailed in the module</span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.649.1"> directives of the NGINX HTTP core module, </span><strong class="source-inline"><span class="koboSpan" id="kobo.650.1">error_page</span></strong><span class="koboSpan" id="kobo.651.1"> allows you to define the server behavior when a specific error code occurs. </span><span class="koboSpan" id="kobo.651.2">The simplest form is to affect a URI to an </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">error code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.653.1">
server {
    server_name website.com;
    error_page 403 /errors/forbidden.html;
    error_page 404 /errors/not_found.html;
}</span></pre> <p><span class="koboSpan" id="kobo.654.1">When a client attempts to access a URI that triggers one of these errors (such as loading a document or file that does not exist on the server, resulting in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">404</span></strong><span class="koboSpan" id="kobo.656.1"> error), NGINX is supposed to serve the page associated with the error code. </span><span class="koboSpan" id="kobo.656.2">In fact, it does not just send the client the error page; it actually initiates a completely new request, based on the </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1">new URI.</span></span></p>
<p><span class="koboSpan" id="kobo.658.1">Consequently, you can end up falling back on a different configuration, as in the </span><span class="No-Break"><span class="koboSpan" id="kobo.659.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.660.1">
server {
    server_name website.com;
    root /var/www/vhosts/website.com/httpdocs/;
    error_page 404 /errors/404.html;
    location /errors/ {
        alias /var/www/common/errors/;
        internal;
    }
}</span></pre> <p><span class="koboSpan" id="kobo.661.1">When a client attempts to load</span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.662.1"> a document that does not exist, they will initially receive a </span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">404</span></strong><span class="koboSpan" id="kobo.664.1"> error. </span><span class="koboSpan" id="kobo.664.2">We employed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.665.1">error_page</span></strong><span class="koboSpan" id="kobo.666.1"> directive to specify that </span><strong class="source-inline"><span class="koboSpan" id="kobo.667.1">404</span></strong><span class="koboSpan" id="kobo.668.1"> errors should create an internal redirect to </span><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">/errors/404.html</span></strong><span class="koboSpan" id="kobo.670.1">. </span><span class="koboSpan" id="kobo.670.2">As a result, a new request is generated by NGINX, with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">/errors/404.html</span></strong><span class="koboSpan" id="kobo.672.1"> URI. </span><span class="koboSpan" id="kobo.672.2">This URI falls under the location </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">/errors/</span></strong><span class="koboSpan" id="kobo.674.1"> block, so the corresponding </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1">configuration applies.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.676.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.677.1">Logs can prove to be particularly useful when working with redirects and URL rewrites. </span><span class="koboSpan" id="kobo.677.2">Be aware that information on internal redirects will show up in the logs only if you set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">error_log</span></strong><span class="koboSpan" id="kobo.679.1"> directive to </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">debug</span></strong><span class="koboSpan" id="kobo.681.1">. </span><span class="koboSpan" id="kobo.681.2">You can also get it to show up at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.682.1">notice</span></strong><span class="koboSpan" id="kobo.683.1"> level, under the condition that you specify </span><strong class="source-inline"><span class="koboSpan" id="kobo.684.1">rewrite_log on;</span></strong><span class="koboSpan" id="kobo.685.1"> wherever you </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">need it.</span></span></p>
<p><span class="koboSpan" id="kobo.687.1">A raw but trimmed excerpt from the debug log summarizes </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">the mechanism:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.689.1">
-&gt;http request line: "GET /page.html HTTP/1.1"
-&gt;http uri: "/page.html"
-&gt;test location: "/errors/"
-&gt;using configuration ""
-&gt;http filename: "/var/www/vhosts/website.com/httpdocs/page.html"
-&gt; open() "/var/www/vhosts/website.com/httpdocs/page.html" failed (2: No such file or directory), client: 127.0.0.1, server: website.com, request: "GET /page.html HTTP/1.1", host:"website.com"
-&gt;http finalize request: 404, "/page.html?" </span><span class="koboSpan" id="kobo.689.2">1
-&gt;http special response: 404, "/page.html?"
</span><span class="koboSpan" id="kobo.689.3">-&gt;internal redirect: "/errors/404.html?"
</span><span class="koboSpan" id="kobo.689.4">-&gt;test location: "/errors/"
-&gt;using configuration "/errors/"
-&gt;http filename: "/var/www/common/errors/404.html"
-&gt;http finalize request: 0, "/errors/404.html?" </span><span class="koboSpan" id="kobo.689.5">1</span></pre> <p><span class="koboSpan" id="kobo.690.1">Note that the use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.691.1">internal</span></strong><span class="koboSpan" id="kobo.692.1"> directive in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.693.1">location</span></strong><span class="koboSpan" id="kobo.694.1"> block forbids clients from accessing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.695.1">/errors/</span></strong><span class="koboSpan" id="kobo.696.1"> directory. </span><span class="koboSpan" id="kobo.696.2">This location can thus only be accessed through an </span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">internal redirect.</span></span></p>
<p><span class="koboSpan" id="kobo.698.1">The mechanism is the same for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.699.1">index</span></strong><span class="koboSpan" id="kobo.700.1"> directive (detailed further on in the </span><em class="italic"><span class="koboSpan" id="kobo.701.1">Index </span></em><span class="koboSpan" id="kobo.702.1">section). </span><span class="koboSpan" id="kobo.702.2">If no file path is provided in the client request, NGINX will attempt to serve the specified index page</span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.703.1"> by triggering an </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">inte</span><a id="_idTextAnchor432"/><span class="koboSpan" id="kobo.705.1">r</span><a id="_idTextAnchor433"/><span class="koboSpan" id="kobo.706.1">nal redirect.</span></span></p>
<h3><span class="koboSpan" id="kobo.707.1">Rewrite</span></h3>
<p><span class="koboSpan" id="kobo.708.1">While the previous </span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">error_page</span></strong><span class="koboSpan" id="kobo.710.1"> directive is not actually</span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.711.1"> part of the Rewrite module, detailing its functionality provides a solid introduction to the way NGINX handles </span><span class="No-Break"><span class="koboSpan" id="kobo.712.1">client requests.</span></span></p>
<p><span class="koboSpan" id="kobo.713.1">Similar to how the </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">error_page</span></strong><span class="koboSpan" id="kobo.715.1"> directive redirects to another location, rewriting the URI with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">rewrite</span></strong><span class="koboSpan" id="kobo.717.1"> directive generates an </span><span class="No-Break"><span class="koboSpan" id="kobo.718.1">internal redirect:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.719.1">
server {
    server_name website.com;
    root /var/www/vhosts/website.com/httpdocs/;
    location /storage/ {
        internal;
        alias /var/www/storage/;
    }
    location /documents/ {
        rewrite ^/documents/(.*)$ /storage/$1;
    }
}</span></pre> <p><span class="koboSpan" id="kobo.720.1">A client query to </span><strong class="source-inline"><span class="koboSpan" id="kobo.721.1">http://website.com/documents/file.txt</span></strong><span class="koboSpan" id="kobo.722.1"> initially matches the second </span><strong class="source-inline"><span class="koboSpan" id="kobo.723.1">location</span></strong><span class="koboSpan" id="kobo.724.1"> block (</span><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">location /documents/</span></strong><span class="koboSpan" id="kobo.726.1">). </span><span class="koboSpan" id="kobo.726.2">However, the block contains a rewrite instruction that transforms the URI from </span><strong class="source-inline"><span class="koboSpan" id="kobo.727.1">/documents/file.txt</span></strong><span class="koboSpan" id="kobo.728.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">/storage/file.txt</span></strong><span class="koboSpan" id="kobo.730.1">. </span><span class="koboSpan" id="kobo.730.2">The URI transformation reinitializes the process; the new URI is matched against the </span><strong class="source-inline"><span class="koboSpan" id="kobo.731.1">location</span></strong><span class="koboSpan" id="kobo.732.1"> blocks. </span><span class="koboSpan" id="kobo.732.2">This time, the first </span><strong class="source-inline"><span class="koboSpan" id="kobo.733.1">location</span></strong><span class="koboSpan" id="kobo.734.1"> block (</span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">location /storage/</span></strong><span class="koboSpan" id="kobo.736.1">) matches the </span><span class="No-Break"><span class="koboSpan" id="kobo.737.1">URI (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.738.1">/storage/file.txt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.739.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.740.1">Again, a quick peek at the debug log details</span><a id="_idIndexMarker273"/> <span class="No-Break"><span class="koboSpan" id="kobo.741.1">the mechanism:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.742.1">
-&gt;http request line: "GET /documents/file.txt HTTP/1.1"
-&gt;http uri: "/documents/file.txt"
-&gt;test location: "/storage/"
-&gt;test location: "/documents/"
-&gt;using configuration "/documents/"
-&gt;http script regex: "^/documents/(.*)$"
-&gt;"^/documents/(.*)$" matches "/documents/file.txt", client: 127.0.0.1, server: website.com, request: "GET /documents/file.txt HTTP/1.1", host: "website.com"
-&gt;rewritten data: "/storage/file.txt", args: "", client: 127.0.0.1, server: website.com, request: "GET /documents/file.txt HTTP/1.1", host: "website.com"
-&gt;test location: "/storage/"
-&gt;using configuration "/storage/"
-&gt;http filename: "/var/www/storage/file.txt"
-&gt;HTTP/1.1 200 OK
-&gt;http output filter "/st</span><a id="_idTextAnchor434"/><span class="koboSpan" id="kobo.743.1">o</span><a id="_idTextAnchor435"/><span class="koboSpan" id="kobo.744.1">rage/test.txt?"</span></pre> <h3><span class="koboSpan" id="kobo.745.1">Infinite loops</span></h3>
<p><span class="koboSpan" id="kobo.746.1">With all of the different syntaxes</span><a id="_idIndexMarker274"/><span class="koboSpan" id="kobo.747.1"> and directives, you could easily get confused. </span><span class="koboSpan" id="kobo.747.2">Worse, you might get NGINX confused. </span><span class="koboSpan" id="kobo.747.3">This happens, for instance, when your rewrite rules are redundant and cause internal redirects to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.748.1">loop infinitely</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.749.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.750.1">
server {
    server_name website.com;
    location /documents/ {
        rewrite ^(.*)$ /documents/2018/$1;
    }
}</span></pre> <p><span class="koboSpan" id="kobo.751.1">You thought you were doing well, but this configuration actually triggers an internal redirect of </span><strong class="source-inline"><span class="koboSpan" id="kobo.752.1">/documents/anything</span></strong><span class="koboSpan" id="kobo.753.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">/documents/2018//documents/anything</span></strong><span class="koboSpan" id="kobo.755.1">. </span><span class="koboSpan" id="kobo.755.2">Moreover, since the location patterns are re-evaluated after an internal redirect, </span><strong class="source-inline"><span class="koboSpan" id="kobo.756.1">/documents/2018//documents/anything</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.757.1">becomes </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.758.1">/documents/2018//documents/2018//documents/anything</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.760.1">Here is the corresponding excerpt from the </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1">debug log:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.762.1">
-&gt;test location: "/documents/"
-&gt;using configuration "/documents/"
-&gt;rewritten data: "/documents/2018//documents/file.txt", [...]
-&gt;test location: "/documents/"
-&gt;using configuration "/documents/"
-&gt;rewritten data: "/documents/2018//documents/2018//documents/file.txt" [...]
-&gt;test location: «/documents/»
-&gt;using configuration «/documents/»
-&gt;rewritten data: -
&gt;»/documents/2018//documents/2018//documents/2018//documents/file.txt» [...]
-&gt;[...]</span></pre> <p><span class="koboSpan" id="kobo.763.1">You are probably wondering if this goes on indefinitely; the answer is </span><em class="italic"><span class="koboSpan" id="kobo.764.1">no</span></em><span class="koboSpan" id="kobo.765.1">. </span><span class="koboSpan" id="kobo.765.2">The amount of cycles is restricted to </span><em class="italic"><span class="koboSpan" id="kobo.766.1">10</span></em><span class="koboSpan" id="kobo.767.1">. </span><span class="koboSpan" id="kobo.767.2">You are only allowed 10 internal redirects. </span><span class="koboSpan" id="kobo.767.3">For anything past this limit, NGINX will produce a </span><strong class="source-inline"><span class="koboSpan" id="kobo.768.1">500 Internal Server </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.769.1">Error</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.770.1"> message.</span></span></p>
<p><span class="koboSpan" id="kobo.771.1">It is possible to prevent infinite loops for cases such as this where you might want to update the internal path over time. </span><span class="koboSpan" id="kobo.771.2">Simply use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.772.1">break</span></strong><span class="koboSpan" id="kobo.773.1"> flag on the rewrite, as documented later, and NGINX</span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.774.1"> will not do an </span><a id="_idTextAnchor436"/><span class="No-Break"><span class="koboSpan" id="kobo.775.1">i</span><a id="_idTextAnchor437"/><a id="_idTextAnchor438"/><span class="koboSpan" id="kobo.776.1">nternal redirect.</span></span></p>
<h2 id="_idParaDest-100"><a id="_idTextAnchor439"/><span class="koboSpan" id="kobo.777.1">Conditional structure</span></h2>
<p><span class="koboSpan" id="kobo.778.1">The Rewrite module introduces </span><a id="_idIndexMarker276"/><span class="koboSpan" id="kobo.779.1">a new set of directives and blocks, among which is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.780.1">if</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.781.1">conditional structure:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.782.1">
server {
    if ($request_method = POST) {
      [...]
    }
}</span></pre> <p><span class="koboSpan" id="kobo.783.1">This offers the possibility to apply a configuration according to the specified condition. </span><span class="koboSpan" id="kobo.783.2">If the condition is </span><strong class="source-inline"><span class="koboSpan" id="kobo.784.1">true</span></strong><span class="koboSpan" id="kobo.785.1">, the configuration is applied; otherwise, </span><span class="No-Break"><span class="koboSpan" id="kobo.786.1">it isn’t.</span></span></p>
<p><span class="koboSpan" id="kobo.787.1">The following table describes the various syntaxes</span><a id="_idIndexMarker277"/><span class="koboSpan" id="kobo.788.1"> accepted when forming </span><span class="No-Break"><span class="koboSpan" id="kobo.789.1">a condition:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table005">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.790.1">Operator</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.791.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.792.1">None</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.793.1">The condition is </span><strong class="source-inline"><span class="koboSpan" id="kobo.794.1">true</span></strong><span class="koboSpan" id="kobo.795.1"> if the specified variable or data is not equal to an empty string or a string starting with the </span><span class="No-Break"><span class="koboSpan" id="kobo.796.1">character </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.797.1">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.798.1">:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.799.1">if ($</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.800.1">string) {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.801.1">  [...]</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.802.1">}</span></strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.803.1">=</span></strong><span class="koboSpan" id="kobo.804.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.805.1">!=</span></strong></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.806.1">The condition is </span><strong class="source-inline"><span class="koboSpan" id="kobo.807.1">true</span></strong><span class="koboSpan" id="kobo.808.1"> if the argument preceding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.809.1">=</span></strong><span class="koboSpan" id="kobo.810.1"> symbol is equal to the argument following it. </span><span class="koboSpan" id="kobo.810.2">The following example can be read as, “</span><em class="italic"><span class="koboSpan" id="kobo.811.1">If the request method is equal to</span></em> <strong class="source-inline"><span class="koboSpan" id="kobo.812.1">POST</span></strong><em class="italic"><span class="koboSpan" id="kobo.813.1">, then apply </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.814.1">the configuration</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.815.1">”:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.816.1">if   ($request_method = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.817.1">POST) {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.818.1">  [...]</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.819.1">}</span></strong></p>
<p><span class="koboSpan" id="kobo.820.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.821.1">!=</span></strong><span class="koboSpan" id="kobo.822.1"> operator does the opposite: “</span><em class="italic"><span class="koboSpan" id="kobo.823.1">If the request method is not equal to</span></em> <strong class="source-inline"><span class="koboSpan" id="kobo.824.1">GET</span></strong><em class="italic"><span class="koboSpan" id="kobo.825.1">, then apply </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.826.1">the configuration</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.827.1">”:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.828.1">if   ($request_method != </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.829.1">GET) {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.830.1">  [...]</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">}</span></strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">~</span></strong><span class="koboSpan" id="kobo.833.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">~*</span></strong><span class="koboSpan" id="kobo.835.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">!~</span></strong><span class="koboSpan" id="kobo.837.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">!~*</span></strong></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.839.1">The condition is </span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">true</span></strong><span class="koboSpan" id="kobo.841.1"> if the argument preceding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">~</span></strong><span class="koboSpan" id="kobo.843.1"> symbol matches the regular expression pattern placed </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">after it:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.845.1">if   ($request_filename ~ "\.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">txt$") {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.847.1">  [...]</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.848.1">}</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.849.1">~</span></strong><span class="koboSpan" id="kobo.850.1"> is case-sensitive, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.851.1">~*</span></strong><span class="koboSpan" id="kobo.852.1"> is case-insensitive. </span><span class="koboSpan" id="kobo.852.2">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.853.1">!</span></strong><span class="koboSpan" id="kobo.854.1"> symbol to negate </span><span class="No-Break"><span class="koboSpan" id="kobo.855.1">the matching:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.856.1">if   ($request_filename !~* "\.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.857.1">php$") {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">  [...]</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.859.1">}</span></strong></p>
<p><span class="koboSpan" id="kobo.860.1">You can insert capture buffers in the </span><span class="No-Break"><span class="koboSpan" id="kobo.861.1">regular expression:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.862.1">if ($uri ~ "^/search/(.*)$")   {</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.863.1">  set $</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.864.1">query $1;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.865.1">  rewrite ^   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.866.1">http://google.com/search?q=$query;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.867.1">}</span></strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.868.1">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.869.1">f</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.870.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.871.1">!-f</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.872.1">Tests the existence of the </span><span class="No-Break"><span class="koboSpan" id="kobo.873.1">specified file:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.874.1">if (-f   $</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.875.1">request_filename) {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.876.1">  [...] # if the   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.877.1">file exists</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.878.1">}</span></strong></p>
<p><span class="koboSpan" id="kobo.879.1">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.880.1">!-f</span></strong><span class="koboSpan" id="kobo.881.1"> to test the non-existence of </span><span class="No-Break"><span class="koboSpan" id="kobo.882.1">the file:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.883.1">if (!-f   $</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.884.1">request_filename) {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.885.1">  [...] # if the   file does </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">not exist</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.887.1">}</span></strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.888.1">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.889.1">d</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.890.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.891.1">!-d</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.892.1">Similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.893.1">-f</span></strong><span class="koboSpan" id="kobo.894.1"> operator, for testing the existence of </span><span class="No-Break"><span class="koboSpan" id="kobo.895.1">a directory.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.896.1">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.897.1">e</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.898.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">!-e</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.900.1">Similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.901.1">-f</span></strong><span class="koboSpan" id="kobo.902.1"> operator, for testing the existence of a file, directory, or </span><span class="No-Break"><span class="koboSpan" id="kobo.903.1">symbolic link.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.904.1">-</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.905.1">x</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.906.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.907.1">!-x</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.908.1">Similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.909.1">-f</span></strong><span class="koboSpan" id="kobo.910.1"> operator, for testing whether a file exists and </span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">is executable.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.912.1">Table 4.5: A list of syntaxes for conditions</span></p>
<p><span class="koboSpan" id="kobo.913.1">As of version 1.13.8, there are no </span><strong class="source-inline"><span class="koboSpan" id="kobo.914.1">else</span></strong><span class="koboSpan" id="kobo.915.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.916.1">else if</span></strong><span class="koboSpan" id="kobo.917.1">-like</span><a id="_idIndexMarker278"/><span class="koboSpan" id="kobo.918.1"> instructions. </span><span class="koboSpan" id="kobo.918.2">However, other directives allowing you to control the configuration flow sequencing </span><span class="No-Break"><span class="koboSpan" id="kobo.919.1">are available.</span></span></p>
<p><span class="koboSpan" id="kobo.920.1">You might wonder: </span><em class="italic"><span class="koboSpan" id="kobo.921.1">What are the advantages of using a</span></em> <strong class="source-inline"><span class="koboSpan" id="kobo.922.1">location</span></strong> <em class="italic"><span class="koboSpan" id="kobo.923.1">block over an</span></em> <strong class="source-inline"><span class="koboSpan" id="kobo.924.1">if</span></strong> <em class="italic"><span class="koboSpan" id="kobo.925.1">block?</span></em><span class="koboSpan" id="kobo.926.1"> Indeed, in the following example, both seem to have the </span><span class="No-Break"><span class="koboSpan" id="kobo.927.1">same effect:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.928.1">
if ($uri ~ /search/) {
  [...]
}
location ~ /search/ {
    [...]
}</span></pre> <p><span class="koboSpan" id="kobo.929.1">As a matter of fact, the main difference lies within the directives that can be employed within either block. </span><span class="koboSpan" id="kobo.929.2">Some can be inserted in an </span><strong class="source-inline"><span class="koboSpan" id="kobo.930.1">if</span></strong><span class="koboSpan" id="kobo.931.1"> block and some can’t; on the contrary, almost all directives are authorized within a </span><strong class="source-inline"><span class="koboSpan" id="kobo.932.1">location</span></strong><span class="koboSpan" id="kobo.933.1"> block, as you probably noticed in the directive listings so far. </span><span class="koboSpan" id="kobo.933.2">In general, it’s best to only insert directives from the Rewrite module within an </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1">if</span></strong><span class="koboSpan" id="kobo.935.1"> block, as other directives</span><a id="_idIndexMarker279"/><span class="koboSpan" id="kobo.936.1"> were not originally intended for </span><span class="No-Break"><span class="koboSpan" id="kobo.937.1">such usage</span><a id="_idTextAnchor440"/><a id="_idTextAnchor441"/><span class="koboSpan" id="kobo.938.1">.</span></span></p>
<h2 id="_idParaDest-101"><a id="_idTextAnchor442"/><span class="koboSpan" id="kobo.939.1">Directives</span></h2>
<p><span class="koboSpan" id="kobo.940.1">The Rewrite module </span><a id="_idIndexMarker280"/><span class="koboSpan" id="kobo.941.1">provides</span><a id="_idIndexMarker281"/><span class="koboSpan" id="kobo.942.1"> you with a set of directives that do more than just rewrite a URI. </span><span class="koboSpan" id="kobo.942.2">The following table describes these directives, along with the context in which they can </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">be employed:</span></span></p>
<table class="No-Table-Style" id="table006">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.944.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.945.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.946.1">rewrite</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.947.1">Context: server, </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.948.1">location, if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.949.1">As discussed previously, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.950.1">rewrite</span></strong><span class="koboSpan" id="kobo.951.1"> directive allows you to rewrite the URI of the current request, thus resetting the treatment of the </span><span class="No-Break"><span class="koboSpan" id="kobo.952.1">said request.</span></span></p>
<p><span class="koboSpan" id="kobo.953.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.954.1">rewrite regexp </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.955.1">replacement [flag];</span></strong></span></p>
<p><span class="koboSpan" id="kobo.956.1">Where </span><strong class="source-inline"><span class="koboSpan" id="kobo.957.1">regexp</span></strong><span class="koboSpan" id="kobo.958.1"> is the regular expression, the URI should match in order for the replacement </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">to apply.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.960.1">The flag may take one of the </span><span class="No-Break"><span class="koboSpan" id="kobo.961.1">following values:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.962.1">last</span></strong><span class="koboSpan" id="kobo.963.1">: The current rewrite rule should be the last to be applied. </span><span class="koboSpan" id="kobo.963.2">After its application, the new URI is processed by NGINX, and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.964.1">location</span></strong><span class="koboSpan" id="kobo.965.1"> block is searched for. </span><span class="koboSpan" id="kobo.965.2">However, further rewrite instructions will </span><span class="No-Break"><span class="koboSpan" id="kobo.966.1">be disregarded.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">break</span></strong><span class="koboSpan" id="kobo.968.1">: The current rewrite rule is applied, but NGINX does not initiate a new request for the modified URI (does not restart the search for matching </span><strong class="source-inline"><span class="koboSpan" id="kobo.969.1">location</span></strong><span class="koboSpan" id="kobo.970.1"> blocks). </span><span class="koboSpan" id="kobo.970.2">All further </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">rewrite</span></strong><span class="koboSpan" id="kobo.972.1"> directives </span><span class="No-Break"><span class="koboSpan" id="kobo.973.1">are ignored.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.974.1">redirect</span></strong><span class="koboSpan" id="kobo.975.1">: Returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">302 Moved Temporarily</span></strong><span class="koboSpan" id="kobo.977.1"> HTTP response, with the replacement URI set as the value of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.978.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.979.1"> header.</span></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style"/>
<td class="No-Table-Style">
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.980.1">permanent</span></strong><span class="koboSpan" id="kobo.981.1">: Returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.982.1">301 Moved Permanently</span></strong><span class="koboSpan" id="kobo.983.1"> HTTP response, with the replacement URI set as the value of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.984.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.985.1"> header.</span></span></li>
<li><span class="koboSpan" id="kobo.986.1">If you specify a URI beginning with </span><strong class="source-inline"><span class="koboSpan" id="kobo.987.1">http://</span></strong><span class="koboSpan" id="kobo.988.1"> as the replacement URI, NGINX will automatically use the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.989.1">redirect</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.990.1"> flag.</span></span></li>
<li><span class="koboSpan" id="kobo.991.1">Note that the request URI processed by the directive is a relative URI; it does not contain the hostname and protocol. </span><span class="koboSpan" id="kobo.991.2">For a request such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.992.1">http://website.com/documents/page.html</span></strong><span class="koboSpan" id="kobo.993.1">, the request URI </span><span class="No-Break"><span class="koboSpan" id="kobo.994.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.995.1">/documents/page.html</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.996.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.997.1">If decoded, this URI corresponding to a request, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.998.1">http://website.com/my%20page.html</span></strong><span class="koboSpan" id="kobo.999.1">, would be </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">/my page.html</span></strong><span class="koboSpan" id="kobo.1001.1"> (in the encoded URI, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">%20</span></strong><span class="koboSpan" id="kobo.1003.1"> indicates a </span><span class="No-Break"><span class="koboSpan" id="kobo.1004.1">whitespace character).</span></span></li>
<li><span class="koboSpan" id="kobo.1005.1">Does not contain arguments; for a request such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1006.1">http://website.com/page.php?id=1&amp;p=2</span></strong><span class="koboSpan" id="kobo.1007.1">, the URI would be </span><strong class="source-inline"><span class="koboSpan" id="kobo.1008.1">/page.php</span></strong><span class="koboSpan" id="kobo.1009.1">. </span><span class="koboSpan" id="kobo.1009.2">When rewriting the URI, you don’t need to consider including arguments in the replacement URI; NGINX does it for you. </span><span class="koboSpan" id="kobo.1009.3">If you want NGINX to not include arguments after the rewritten URI, you must insert a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1010.1">?</span></strong><span class="koboSpan" id="kobo.1011.1"> character at the end of the replacement URI: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1012.1">rewrite ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1013.1">search/(.*)$ /search.php?q=$1?</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1014.1">.</span></span></li>
</ul>
<p><span class="No-Break"><span class="koboSpan" id="kobo.1015.1">Examples:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1016.1">rewrite ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1">search/(.*)$ /search.php?q=$1;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1018.1">rewrite ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1">search/(.*)$ /search.php?q=$1?;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1020.1">rewrite ^ </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1021.1">http://website.com;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1022.1">rewrite ^ </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1023.1">http://website.com permanent;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">break</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1025.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1026.1">server</span></strong><span class="koboSpan" id="kobo.1027.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1029.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1030.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1031.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1032.1">break</span></strong><span class="koboSpan" id="kobo.1033.1"> directive is used to prevent further </span><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1">rewrite</span></strong><span class="koboSpan" id="kobo.1035.1"> directives. </span><span class="koboSpan" id="kobo.1035.2">Past this point, the URI is fixed and cannot </span><span class="No-Break"><span class="koboSpan" id="kobo.1036.1">be altered.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.1037.1">Example:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1038.1">if (-f $</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1039.1">uri) {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1040.1">  break; # break   if the </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1041.1">file exists</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1042.1">}</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1043.1">if ($uri ~   ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1044.1">search/(.*)$) {</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1">  set $</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1046.1">query $1;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1047.1">  rewrite ^   /</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1048.1">search.php?q=$query?;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1049.1">}</span></strong></p>
<p><span class="koboSpan" id="kobo.1050.1">This example rewrites </span><strong class="source-inline"><span class="koboSpan" id="kobo.1051.1">/search/anything</span></strong><span class="koboSpan" id="kobo.1052.1">-like queries to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1053.1">/search.php?q=anything</span></strong><span class="koboSpan" id="kobo.1054.1">. </span><span class="koboSpan" id="kobo.1054.2">However, if the requested file exists (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1055.1">/search/index.html</span></strong><span class="koboSpan" id="kobo.1056.1">), the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1057.1">break</span></strong><span class="koboSpan" id="kobo.1058.1"> instruction prevents NGINX from rewriting </span><span class="No-Break"><span class="koboSpan" id="kobo.1059.1">the URI.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1060.1">return</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1061.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1062.1">server</span></strong><span class="koboSpan" id="kobo.1063.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1064.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1065.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1067.1">Interrupts the processing of the request and returns the specified HTTP status code or </span><span class="No-Break"><span class="koboSpan" id="kobo.1068.1">specified text.</span></span></p>
<p><span class="koboSpan" id="kobo.1069.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1070.1">return code | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1071.1">text;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1072.1">Here, the code is one of the following status codes: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">204</span></strong><span class="koboSpan" id="kobo.1074.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1075.1">308</span></strong><span class="koboSpan" id="kobo.1076.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1077.1">400</span></strong><span class="koboSpan" id="kobo.1078.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1079.1">402</span></strong><span class="koboSpan" id="kobo.1080.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1">406</span></strong><span class="koboSpan" id="kobo.1082.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1083.1">408</span></strong><span class="koboSpan" id="kobo.1084.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1085.1">410</span></strong><span class="koboSpan" id="kobo.1086.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1087.1">411</span></strong><span class="koboSpan" id="kobo.1088.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1">413</span></strong><span class="koboSpan" id="kobo.1090.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1091.1">416</span></strong><span class="koboSpan" id="kobo.1092.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1093.1">500</span></strong><span class="koboSpan" id="kobo.1094.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1095.1">504</span></strong><span class="koboSpan" id="kobo.1096.1">. </span><span class="koboSpan" id="kobo.1096.2">In addition, you may use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1097.1">444</span></strong><span class="koboSpan" id="kobo.1098.1"> NGINX-specific code in order to return an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1">HTTP 200 OK</span></strong><span class="koboSpan" id="kobo.1100.1"> status code with no further response header or body. </span><span class="koboSpan" id="kobo.1100.2">Alternatively, you may also specify a raw text value that will be returned to the user as a response body. </span><span class="koboSpan" id="kobo.1100.3">This comes in handy when testing whether your request URIs fall within particular </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1101.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1102.1"> blocks.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.1103.1">Example:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1104.1">if ($uri ~   ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1105.1">admin/) {</span></strong></span></p>
<p><strong class="source-inline"> </strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1106.1">return 403;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1">  # the   instruction below is </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1108.1">NOT executed</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1109.1">  # as Nginx   already completed </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1110.1">the request</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1111.1">  rewrite ^   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1112.1">http://website.com;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1113.1">}</span></strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1114.1">set</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1115.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1116.1">server</span></strong><span class="koboSpan" id="kobo.1117.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1118.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1119.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1120.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1121.1">Initializes or redefines a variable. </span><span class="koboSpan" id="kobo.1121.2">Note that some variables cannot be redefined; for example, you are not allowed to </span><span class="No-Break"><span class="koboSpan" id="kobo.1122.1">alter </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1123.1">$uri</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1124.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1125.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1126.1">set $</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1127.1">variable value;</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.1128.1">Examples:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1129.1">set $var1 "some   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1130.1">text";</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1131.1">if ($var1 ~ ^(.*)   (.*)$) {</span></strong></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1132.1">  set $var2 $1$2;   #</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1133.1">concatenation</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1134.1">  rewrite ^   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1135.1">http://website.com/$var2;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1136.1">}</span></strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1137.1">uninitialized_variable_warn</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1138.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1139.1">http</span></strong><span class="koboSpan" id="kobo.1140.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1141.1">server</span></strong><span class="koboSpan" id="kobo.1142.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1143.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1144.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1145.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1146.1">If set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1">on</span></strong><span class="koboSpan" id="kobo.1148.1">, NGINX will issue log messages when the configuration employs a variable that has not yet </span><span class="No-Break"><span class="koboSpan" id="kobo.1149.1">been initialized.</span></span></p>
<p><span class="koboSpan" id="kobo.1150.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1151.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1152.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1153.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.1154.1">Example:</span></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1155.1">uninitialized_variable_warn on;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1156.1">rewrite_log</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1157.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1158.1">http</span></strong><span class="koboSpan" id="kobo.1159.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1160.1">server</span></strong><span class="koboSpan" id="kobo.1161.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1162.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1163.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1165.1">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.1166.1">rewrite_log</span></strong><span class="koboSpan" id="kobo.1167.1"> is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1168.1">on</span></strong><span class="koboSpan" id="kobo.1169.1">, NGINX will issue log messages for every operation performed by the rewrite engine at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1170.1">notice</span></strong><span class="koboSpan" id="kobo.1171.1"> error level (see the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">error_log</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1173.1"> directive).</span></span></p>
<p><span class="koboSpan" id="kobo.1174.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1175.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1176.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1">off</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1178.1">Default </span><span class="No-Break"><span class="koboSpan" id="kobo.1179.1">value: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1180.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.1181.1">Example:</span></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1182.1">rewrite_log off;</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor443"/><span class="koboSpan" id="kobo.1183.1">Table 4.6: A list of directives used to rewrite URIs</span></p>
<h2 id="_idParaDest-102"><a id="_idTextAnchor444"/><span class="koboSpan" id="kobo.1184.1">Common rewrite rules</span></h2>
<p><span class="koboSpan" id="kobo.1185.1">Here is a set of rewrite rules</span><a id="_idIndexMarker282"/><span class="koboSpan" id="kobo.1186.1"> that satisfy basic needs for dynamic websites that wish to beautify their page links, thanks to the URL rewriting mechanism. </span><span class="koboSpan" id="kobo.1186.2">You will obviously need to adjust these rules according to your particular situation, as every website </span><span class="No-Break"><span class="koboSpan" id="kobo.1187.1">is different</span><a id="_idTextAnchor445"/><span class="koboSpan" id="kobo.1188.1">.</span></span><a id="_idTextAnchor446"/></p>
<h3><span class="koboSpan" id="kobo.1189.1">Performing a search</span></h3>
<p><span class="koboSpan" id="kobo.1190.1">This rewrite rule is intended</span><a id="_idIndexMarker283"/><span class="koboSpan" id="kobo.1191.1"> for search queries. </span><span class="koboSpan" id="kobo.1191.2">Search keywords are included in </span><span class="No-Break"><span class="koboSpan" id="kobo.1192.1">the URL:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1193.1">Input </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1194.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1195.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1196.1">http://website.com/search/some-search-keywords</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1197.1">Rewritten </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1198.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1199.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1200.1">http://website.com/search.php?q=some-search-keywords</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1201.1">Rewrite rule</span></strong><span class="koboSpan" id="kobo.1202.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1203.1">rewrite ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1204.1">search/(.*)$ /search.php?q=$1?</span><a id="_idTextAnchor447"/><a id="_idTextAnchor448"/><span class="koboSpan" id="kobo.1205.1">;</span></strong></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.1206.1">User profile page</span></h3>
<p><span class="koboSpan" id="kobo.1207.1">Most dynamic websites</span><a id="_idIndexMarker284"/><span class="koboSpan" id="kobo.1208.1"> that allow visitors to register offer a profile view page. </span><span class="koboSpan" id="kobo.1208.2">URLs of this form can be employed, containing both the user ID and </span><span class="No-Break"><span class="koboSpan" id="kobo.1209.1">the username:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1210.1">Input </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1211.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1212.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1213.1">http://website.com/user/31/James</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1214.1">Rewritten </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1215.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1216.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1217.1">http://website.com/user.php?id=31&amp;name=James</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1218.1">Rewrite rule</span></strong><span class="koboSpan" id="kobo.1219.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1220.1">rewrite ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1221.1">user/([0-9]+)/(.+)$ /user.php?id=$1&amp;name=$2</span><a id="_idTextAnchor449"/><a id="_idTextAnchor450"/><span class="koboSpan" id="kobo.1222.1">?;</span></strong></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.1223.1">Multiple parameters</span></h3>
<p><span class="koboSpan" id="kobo.1224.1">Some websites may use</span><a id="_idIndexMarker285"/><span class="koboSpan" id="kobo.1225.1"> different syntaxes for the argument string—for example, by separating non-named arguments </span><span class="No-Break"><span class="koboSpan" id="kobo.1226.1">with slashes:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1227.1">Input </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1228.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1229.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1230.1">http://website.com/index.php/param1/param2/param3</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1231.1">Rewritten </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1232.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1233.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1234.1">http://website.com/index.php?p1=param1&amp;p2=param2&amp;p3=param3</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1235.1">Rewrite rule</span></strong><span class="koboSpan" id="kobo.1236.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1237.1">rewrite ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1238.1">index.php/(.*)/(.*)/(.*)$ /index.php?p1=$1&amp;p2=$2&amp;p3=$</span><a id="_idTextAnchor451"/><a id="_idTextAnchor452"/><span class="koboSpan" id="kobo.1239.1">3?;</span></strong></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.1240.1">Wikipedia-like</span></h3>
<p><span class="koboSpan" id="kobo.1241.1">Many websites have now adopted</span><a id="_idIndexMarker286"/><span class="koboSpan" id="kobo.1242.1"> the URL style introduced by </span><em class="italic"><span class="koboSpan" id="kobo.1243.1">Wikipedia</span></em><span class="koboSpan" id="kobo.1244.1">, including a prefix folder followed by an </span><span class="No-Break"><span class="koboSpan" id="kobo.1245.1">article name:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1246.1">Input URI</span></strong><span class="koboSpan" id="kobo.1247.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1248.1">http:// website.com/wiki/Some_keyword</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1249.1">Rewritten URI</span></strong><span class="koboSpan" id="kobo.1250.1">: 	</span><span class="No-Break"><span class="koboSpan" id="kobo.1251.1">http://website.com/wiki/index.php?title=Some_keyword</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1252.1">Rewrite rule</span></strong><span class="koboSpan" id="kobo.1253.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1254.1">rewrite ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1255.1">wiki/(.*)$ /wiki/index.php?title=</span><a id="_idTextAnchor453"/><a id="_idTextAnchor454"/><span class="koboSpan" id="kobo.1256.1">$1?;</span></strong></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.1257.1">News website article</span></h3>
<p><span class="koboSpan" id="kobo.1258.1">This URL structure is often employed</span><a id="_idIndexMarker287"/><span class="koboSpan" id="kobo.1259.1"> by news websites, as URLs contain indications of articles’ contents. </span><span class="koboSpan" id="kobo.1259.2">It is formed of an article identifier, followed by a slash, then a list of keywords. </span><span class="koboSpan" id="kobo.1259.3">The keywords can usually be ignored and not included in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1260.1">rewritten URI:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1261.1">Input </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1262.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1263.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1264.1">http://website.com/33526/us-economy-strengthens</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1265.1">Rewritten </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1266.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1267.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1268.1">http://website.com/article.php?id=33526</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1269.1">Rewrite rule</span></strong><span class="koboSpan" id="kobo.1270.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1271.1">rewrite ^/([</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1272.1">0-9]+)/.*$ /article.php?id</span><a id="_idTextAnchor455"/><a id="_idTextAnchor456"/><span class="koboSpan" id="kobo.1273.1">=$1?;</span></strong></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.1274.1">Discussion board</span></h3>
<p><span class="koboSpan" id="kobo.1275.1">Modern bulletin boards</span><a id="_idIndexMarker288"/><span class="koboSpan" id="kobo.1276.1"> now use </span><em class="italic"><span class="koboSpan" id="kobo.1277.1">pretty URLs</span></em><span class="koboSpan" id="kobo.1278.1">, for the most part. </span><span class="koboSpan" id="kobo.1278.2">This example shows how to create a </span><em class="italic"><span class="koboSpan" id="kobo.1279.1">topic view</span></em><span class="koboSpan" id="kobo.1280.1"> URL with two parameters: the topic identifier and the starting post. </span><span class="koboSpan" id="kobo.1280.2">Once again, keywords </span><span class="No-Break"><span class="koboSpan" id="kobo.1281.1">are ignored:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1282.1">Input </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1283.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1284.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1285.1">http://website.com/topic-1234-50-some-keywords.html</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1286.1">Rewritten </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1287.1">URI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1288.1">:	</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1289.1">http://website.com/viewtopic.php?topic=1234&amp;start=50</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1290.1">Rewrite rule</span></strong><span class="koboSpan" id="kobo.1291.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1292.1">rewrite ^/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1293.1">topic-([0-9]+)-([0-9]+)-(.*)\.html$ /viewtopic.php?topic=$1&amp;sta</span><a id="_idTextAnchor457"/><a id="_idTextAnchor458"/><span class="koboSpan" id="kobo.1294.1">r</span><a id="_idTextAnchor459"/><a id="_idTextAnchor460"/><a id="_idTextAnchor461"/><a id="_idTextAnchor462"/><a id="_idTextAnchor463"/><a id="_idTextAnchor464"/><span class="koboSpan" id="kobo.1295.1">t=$2?;</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1296.1">The first half of this chapter covered one of the most important NGINX modules—namely, the Rewrite module. </span><span class="koboSpan" id="kobo.1296.2">There are a lot more modules that will greatly enrich the functionality of the web server; they are regrouped by theme in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1">following se</span><a id="_idTextAnchor465"/><span class="koboSpan" id="kobo.1298.1">ction.</span></span></p>
<h1 id="_idParaDest-103"><a id="_idTextAnchor466"/><span class="koboSpan" id="kobo.1299.1">Looking at some additional modules</span></h1>
<p><span class="koboSpan" id="kobo.1300.1">Among the modules described in this section, some are included in the default NGINX build, but some are not. </span><span class="koboSpan" id="kobo.1300.2">This implies that unless you specifically configured your NGINX build to include these modules (as described in </span><a href="B21787_01.xhtml#_idTextAnchor014"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1301.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.1302.1">), they will not be available to you. </span><span class="koboSpan" id="kobo.1302.2">But remember that rebuilding NGINX to include additional modules is a relatively quick and </span><span class="No-Break"><span class="koboSpan" id="kobo.1303.1">easy p</span><a id="_idTextAnchor467"/><span class="koboSpan" id="kobo.1304.1">r</span><a id="_idTextAnchor468"/><span class="koboSpan" id="kobo.1305.1">ocess.</span></span></p>
<h2 id="_idParaDest-104"><a id="_idTextAnchor469"/><span class="koboSpan" id="kobo.1306.1">Website access and logging</span></h2>
<p><span class="koboSpan" id="kobo.1307.1">The following set of modules allows you to configure how visitors access your website and the way your server </span><span class="No-Break"><span class="koboSpan" id="kobo.1308.1">logs re</span><a id="_idTextAnchor470"/><span class="koboSpan" id="kobo.1309.1">q</span><a id="_idTextAnchor471"/><span class="koboSpan" id="kobo.1310.1">uests.</span></span></p>
<h3><span class="koboSpan" id="kobo.1311.1">Index</span></h3>
<p><span class="koboSpan" id="kobo.1312.1">The Index module provides a simple directive</span><a id="_idIndexMarker289"/><span class="koboSpan" id="kobo.1313.1"> named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1314.1">index</span></strong><span class="koboSpan" id="kobo.1315.1"> that lets you define the page that NGINX will serve by default if no filename is specified in the client request (in other words, it defines the website </span><strong class="source-inline"><span class="koboSpan" id="kobo.1316.1">index</span></strong><span class="koboSpan" id="kobo.1317.1"> page). </span><span class="koboSpan" id="kobo.1317.2">You may specify multiple filenames; the first file to be found will be served. </span><span class="koboSpan" id="kobo.1317.3">If none of the specified files are found, NGINX will either attempt to generate an automatic index of the files, if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1318.1">autoindex</span></strong><span class="koboSpan" id="kobo.1319.1"> directive is enabled (check the HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.1320.1">autoindex</span></strong><span class="koboSpan" id="kobo.1321.1"> module) or return a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1322.1">403 Forbidden</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1323.1">error page.</span></span></p>
<p><span class="koboSpan" id="kobo.1324.1">Optionally, you may insert an absolute filename (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1325.1">/page.html</span></strong><span class="koboSpan" id="kobo.1326.1">), but only as the last argument of </span><span class="No-Break"><span class="koboSpan" id="kobo.1327.1">the directive.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.1328.1">Syntax</span></strong><span class="koboSpan" id="kobo.1329.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1330.1">index file1 [</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1331.1">file2...] [absolute_file];</span></strong></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.1332.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1333.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1334.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1335.1">index.html</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1336.1">Here’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1337.1">an example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1338.1">
index index.php index.html index.htm;
index index.php index2.php /catchall.php;</span></pre> <p><span class="koboSpan" id="kobo.1339.1">This directive is valid in the following contexts: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1340.1">http</span></strong><span class="koboSpan" id="kobo.1341.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1342.1">server</span></strong><span class="koboSpan" id="kobo.1343.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.1344.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1345.1">l</span><a id="_idTextAnchor472"/><span class="koboSpan" id="kobo.1346.1">o</span><a id="_idTextAnchor473"/><span class="koboSpan" id="kobo.1347.1">cation</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1348.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.1349.1">Autoindex</span></h3>
<p><span class="koboSpan" id="kobo.1350.1">If NGINX cannot provide an index</span><a id="_idIndexMarker290"/><span class="koboSpan" id="kobo.1351.1"> page for the requested directory, the default behavior is to return a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1352.1">403 Forbidden HTTP</span></strong><span class="koboSpan" id="kobo.1353.1"> error page. </span><span class="koboSpan" id="kobo.1353.2">With the following set of directives, you enable an automatic listing of the files that are present in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1354.1">requested directory:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer026">
<span class="koboSpan" id="kobo.1355.1"><img alt="Figure 4.1: A screenshot showing the autoindex module listing the content of a directory" src="image/B21787_04_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1356.1">Figure 4.1: A screenshot showing the autoindex module listing the content of a directory</span></p>
<p><span class="koboSpan" id="kobo.1357.1">Three columns of information appear for each file: the filename, the file date and time, and the file size</span><a id="_idIndexMarker291"/> <span class="No-Break"><span class="koboSpan" id="kobo.1358.1">in bytes:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table007">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1359.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1360.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.1361.1">Autoindex</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1362.1">Context: </span><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.1363.1">http</span></strong><span class="koboSpan" id="kobo.1364.1">, </span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.1365.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1366.1">, </span></span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.1367.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1368.1">Enables or disables automatic directory listing for directories missing an </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1369.1">index</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1370.1"> page.</span></span></p>
<p><span class="koboSpan" id="kobo.1371.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1372.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1373.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1374.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1375.1">autoindex_exact_size</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1376.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1377.1">http</span></strong><span class="koboSpan" id="kobo.1378.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1379.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1380.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1381.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1382.1">If set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1383.1">on</span></strong><span class="koboSpan" id="kobo.1384.1">, this directive ensures that the listing displays file sizes in bytes. </span><span class="koboSpan" id="kobo.1384.2">Otherwise, another unit is employed, such as KB, MB, </span><span class="No-Break"><span class="koboSpan" id="kobo.1385.1">or GB.</span></span></p>
<p><span class="koboSpan" id="kobo.1386.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1387.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1388.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1389.1">off</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1390.1">Default </span><span class="No-Break"><span class="koboSpan" id="kobo.1391.1">value: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1392.1">on</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1393.1">autoindex_localtime</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1394.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1395.1">http</span></strong><span class="koboSpan" id="kobo.1396.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1397.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1398.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1399.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1400.1">By default, this directive is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1401.1">off</span></strong><span class="koboSpan" id="kobo.1402.1">, so the date and time of files in the listing appear as GMT time. </span><span class="koboSpan" id="kobo.1402.2">Set it to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1403.1">on</span></strong><span class="koboSpan" id="kobo.1404.1"> to make use of the local </span><span class="No-Break"><span class="koboSpan" id="kobo.1405.1">server time.</span></span></p>
<p><span class="koboSpan" id="kobo.1406.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1407.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1408.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1409.1">off</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1410.1">Default </span><span class="No-Break"><span class="koboSpan" id="kobo.1411.1">value: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1412.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.1413.1">autoindex_format</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1414.1">Context: </span><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.1415.1">http</span></strong><span class="koboSpan" id="kobo.1416.1">, </span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.1417.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1418.1">, </span></span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.1419.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1420.1">NGINX offers to serve the directory index in different formats: HTML, XML, JSON, or JSONP (by default, HTML </span><span class="No-Break"><span class="koboSpan" id="kobo.1421.1">is used).</span></span></p>
<p><span class="koboSpan" id="kobo.1422.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1423.1">autoindex_format html | xml | json | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1424.1">jsonp;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1425.1">If you set the directive value to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1426.1">jsonp</span></strong><span class="koboSpan" id="kobo.1427.1">, NGINX will insert the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1428.1">callback</span></strong><span class="koboSpan" id="kobo.1429.1"> query argument as JSONP callback. </span><span class="koboSpan" id="kobo.1429.2">For example, your script should call this </span><span class="No-Break"><span class="koboSpan" id="kobo.1430.1">URI: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1431.1">/folder/?callback=MyCallbackName</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1432.1">.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor474"/><span class="koboSpan" id="kobo.1433.1">Table 4.7: A list of directives for the autoindex module</span></p>
<h3><a id="_idTextAnchor475"/><span class="koboSpan" id="kobo.1434.1">Random index</span></h3>
<p><span class="koboSpan" id="kobo.1435.1">This module enables a simple</span><a id="_idIndexMarker292"/><span class="koboSpan" id="kobo.1436.1"> directive, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1437.1">random_index</span></strong><span class="koboSpan" id="kobo.1438.1">, which can be used within a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1439.1">location</span></strong><span class="koboSpan" id="kobo.1440.1"> block in order for NGINX to return an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1441.1">index</span></strong><span class="koboSpan" id="kobo.1442.1"> page selected randomly among the files of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1443.1">specified directory.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1444.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1445.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.1446.1">NGINX build.</span></span></p>
<p><span class="koboSpan" id="kobo.1447.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1448.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1449.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1450.1">of</span><a id="_idTextAnchor476"/><span class="koboSpan" id="kobo.1451.1">f</span></strong></span><strong class="source-inline"><a id="_idTextAnchor477"/></strong></p>
<h3><span class="koboSpan" id="kobo.1452.1">Log</span></h3>
<p><span class="koboSpan" id="kobo.1453.1">This module controls the behavior</span><a id="_idIndexMarker293"/><span class="koboSpan" id="kobo.1454.1"> of NGINX regarding access logs. </span><span class="koboSpan" id="kobo.1454.2">It is a key module for system administrators, as it allows analyzing the runtime behavior of web applications. </span><span class="koboSpan" id="kobo.1454.3">It is composed of three </span><span class="No-Break"><span class="koboSpan" id="kobo.1455.1">essential directives:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table008">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1456.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1457.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1458.1">access_log</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1459.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1460.1">http</span></strong><span class="koboSpan" id="kobo.1461.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1462.1">server</span></strong><span class="koboSpan" id="kobo.1463.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1464.1">location</span></strong><span class="koboSpan" id="kobo.1465.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1466.1">if</span></strong><span class="koboSpan" id="kobo.1467.1"> (in </span><span class="No-Break"><span class="koboSpan" id="kobo.1468.1">location), </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1469.1">limit_except</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1470.1">This parameter defines the access log file path and the format of entries in the access log by selecting a template name or disables </span><span class="No-Break"><span class="koboSpan" id="kobo.1471.1">access logging.</span></span></p>
<p><span class="koboSpan" id="kobo.1472.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1473.1">access_log path [format [buffer=size]] | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1474.1">off;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1475.1">Some remarks concerning the </span><span class="No-Break"><span class="koboSpan" id="kobo.1476.1">directive syntax:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1477.1">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1478.1">access_log off</span></strong><span class="koboSpan" id="kobo.1479.1"> to disable access logging at the </span><span class="No-Break"><span class="koboSpan" id="kobo.1480.1">current level</span></span></li>
<li><span class="koboSpan" id="kobo.1481.1">The format argument corresponds to a template declared with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1482.1">log_format</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1483.1"> directive</span></span></li>
<li><span class="koboSpan" id="kobo.1484.1">If the format argument is not specified, the default format is </span><span class="No-Break"><span class="koboSpan" id="kobo.1485.1">employed (combined)</span></span></li>
<li><span class="koboSpan" id="kobo.1486.1">You may use variables in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1487.1">file path</span></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1488.1">log_format</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1489.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1490.1">http</span></strong><span class="koboSpan" id="kobo.1491.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1492.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1493.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1494.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1495.1">Defines a template to be utilized by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1496.1">access_log</span></strong><span class="koboSpan" id="kobo.1497.1"> directive, describing contents that should be included in an entry of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1498.1">access log.</span></span></p>
<p><span class="koboSpan" id="kobo.1499.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1500.1">log_format template_name [</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1501.1">escape=default|json] format_string;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1502.1">The default template is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1503.1">combined</span></strong><span class="koboSpan" id="kobo.1504.1"> and matches the </span><span class="No-Break"><span class="koboSpan" id="kobo.1505.1">following example:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1506.1">log_format   combined '$remote_addr - $remote_user [$time_local] '"$</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1507.1">request" $status</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1508.1">$</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1509.1">body_bytes_sent '"$http_referer"</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1510.1">"$</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1511.1">http_user_agent"';</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1512.1"># </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1513.1">Other example</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.1514.1">log_format   simple '$</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1515.1">remote_addr $request';</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1516.1">open_log_file_cache</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1517.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1518.1">http</span></strong><span class="koboSpan" id="kobo.1519.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1520.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1521.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1522.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.1523.1">Configures the cache for log file descriptors. </span><span class="koboSpan" id="kobo.1523.2">Please refer to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1524.1">open_file_cache</span></strong><span class="koboSpan" id="kobo.1525.1"> directive of the HTTP core module for </span><span class="No-Break"><span class="koboSpan" id="kobo.1526.1">additional information.</span></span></p>
<p><span class="koboSpan" id="kobo.1527.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1528.1">open_log_file_cache max=N [inactive=time] [min_uses=N] [valid=time] | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1529.1">off;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1530.1">The arguments are similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1531.1">open_file_cache</span></strong><span class="koboSpan" id="kobo.1532.1"> directive and other related directives, the difference being that this applies to access log </span><span class="No-Break"><span class="koboSpan" id="kobo.1533.1">files only.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1534.1">Table 4.8: A list of directives for the Log module</span></p>
<p><span class="koboSpan" id="kobo.1535.1">The Log module also enables</span><a id="_idIndexMarker294"/><span class="koboSpan" id="kobo.1536.1"> several new variables, though they are only accessible when writing </span><span class="No-Break"><span class="koboSpan" id="kobo.1537.1">log entries:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1538.1">$connection</span></strong><span class="koboSpan" id="kobo.1539.1">: The </span><span class="No-Break"><span class="koboSpan" id="kobo.1540.1">connection number</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1541.1">$pipe</span></strong><span class="koboSpan" id="kobo.1542.1">: The variable is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1543.1">p</span></strong><span class="koboSpan" id="kobo.1544.1"> if the request </span><span class="No-Break"><span class="koboSpan" id="kobo.1545.1">was pipelined</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1546.1">$time_local</span></strong><span class="koboSpan" id="kobo.1547.1">: Local time (at the time of writing the </span><span class="No-Break"><span class="koboSpan" id="kobo.1548.1">log entry)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1549.1">$msec</span></strong><span class="koboSpan" id="kobo.1550.1">: Local time (at the time of writing the log entry) to </span><span class="No-Break"><span class="koboSpan" id="kobo.1551.1">the microsecond</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1552.1">$request_time</span></strong><span class="koboSpan" id="kobo.1553.1">: Total length of the request processing, </span><span class="No-Break"><span class="koboSpan" id="kobo.1554.1">in milliseconds</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1555.1">$status</span></strong><span class="koboSpan" id="kobo.1556.1">: Response </span><span class="No-Break"><span class="koboSpan" id="kobo.1557.1">status code</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1558.1">$bytes_sent</span></strong><span class="koboSpan" id="kobo.1559.1">: Total number of bytes sent to </span><span class="No-Break"><span class="koboSpan" id="kobo.1560.1">the client</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1561.1">$body_bytes_sent</span></strong><span class="koboSpan" id="kobo.1562.1">: Number of bytes sent to the client for the </span><span class="No-Break"><span class="koboSpan" id="kobo.1563.1">response body</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1564.1">$apache_bytes_sent</span></strong><span class="koboSpan" id="kobo.1565.1">: Similar to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1566.1">$body_bytes</span></strong><span class="koboSpan" id="kobo.1567.1">, which corresponds to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1568.1">%B</span></strong><span class="koboSpan" id="kobo.1569.1"> parameter of </span><span class="No-Break"><span class="koboSpan" id="kobo.1570.1">Apache’s </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1571.1">mod_log_config</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1572.1">$request_length</span></strong><span class="koboSpan" id="kobo.1573.1">: Length of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1574.1">request body</span></span><a id="_idTextAnchor478"/></li>
</ul>
<h2 id="_idParaDest-105"><a id="_idTextAnchor479"/><span class="koboSpan" id="kobo.1575.1">Limits and restrictions</span></h2>
<p><span class="koboSpan" id="kobo.1576.1">The following modules allow you to regulate access to the documents of your websites, require users to authenticate, match a set of rules, or simply restrict access to </span><span class="No-Break"><span class="koboSpan" id="kobo.1577.1">certain visitors</span><a id="_idTextAnchor480"/><span class="koboSpan" id="kobo.1578.1">.</span></span><a id="_idTextAnchor481"/></p>
<h3><span class="koboSpan" id="kobo.1579.1">auth_basic module</span></h3>
<p><span class="koboSpan" id="kobo.1580.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1581.1">auth_basic</span></strong><span class="koboSpan" id="kobo.1582.1"> module enables</span><a id="_idIndexMarker295"/><span class="koboSpan" id="kobo.1583.1"> the basic authentication functionality. </span><span class="koboSpan" id="kobo.1583.2">With the two directives that it brings forth, you can make it so that a specific location of your website (or your server) is restricted to users who authenticate with a username </span><span class="No-Break"><span class="koboSpan" id="kobo.1584.1">and password:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1585.1">
location /admin/ {
    auth_basic "Admin control panel"; # variables are supported
    auth_basic_user_file access/password_file;
}</span></pre> <p><span class="koboSpan" id="kobo.1586.1">The first directive, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1587.1">auth_basic</span></strong><span class="koboSpan" id="kobo.1588.1">, can be set to either </span><strong class="source-inline"><span class="koboSpan" id="kobo.1589.1">off</span></strong><span class="koboSpan" id="kobo.1590.1"> or a text message, usually referred to as </span><em class="italic"><span class="koboSpan" id="kobo.1591.1">authentication challenge</span></em><span class="koboSpan" id="kobo.1592.1"> or </span><em class="italic"><span class="koboSpan" id="kobo.1593.1">authentication realm</span></em><span class="koboSpan" id="kobo.1594.1">. </span><span class="koboSpan" id="kobo.1594.2">This message is displayed by web browsers in a username/password box when a client attempts to access the </span><span class="No-Break"><span class="koboSpan" id="kobo.1595.1">protected resource.</span></span></p>
<p><span class="koboSpan" id="kobo.1596.1">The second one, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1597.1">auth_basic_user_file</span></strong><span class="koboSpan" id="kobo.1598.1">, defines the path of the password file relative to the directory of the configuration file. </span><span class="koboSpan" id="kobo.1598.2">A password file is formed of lines respecting the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1599.1">username:[{SCHEME}]password[:comment]</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1600.1"> syntax:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1601.1">username</span></strong><span class="koboSpan" id="kobo.1602.1">: A plain </span><span class="No-Break"><span class="koboSpan" id="kobo.1603.1">text username.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1604.1">{SCHEME}</span></strong><span class="koboSpan" id="kobo.1605.1">: Optionally, the password hashing method. </span><span class="koboSpan" id="kobo.1605.2">There are currently three supported schemes: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1606.1">{PLAIN}</span></strong><span class="koboSpan" id="kobo.1607.1"> for plain-text passwords, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1608.1">{SHA}</span></strong><span class="koboSpan" id="kobo.1609.1"> for SHA-1 hashing, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1610.1">{SSHA}</span></strong><span class="koboSpan" id="kobo.1611.1"> for salted </span><span class="No-Break"><span class="koboSpan" id="kobo.1612.1">SHA-1 hashing.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.1613.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1614.1">Please note that </span><strong class="source-inline"><span class="koboSpan" id="kobo.1615.1">PLAIN</span></strong><span class="koboSpan" id="kobo.1616.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1617.1">SHA</span></strong><span class="koboSpan" id="kobo.1618.1">, while still supported, are insecure methods. </span><span class="koboSpan" id="kobo.1618.2">We recommend you use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1619.1">SSHA</span></strong><span class="koboSpan" id="kobo.1620.1"> for </span><span class="No-Break"><span class="koboSpan" id="kobo.1621.1">salting passwords.</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1622.1">password</span></strong><span class="koboSpan" id="kobo.1623.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.1624.1">The password.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1625.1">comment</span></strong><span class="koboSpan" id="kobo.1626.1">: A plain-text comment for your </span><span class="No-Break"><span class="koboSpan" id="kobo.1627.1">own use.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1628.1">If you fail to specify</span><a id="_idIndexMarker296"/><span class="koboSpan" id="kobo.1629.1"> a scheme, the password will need to be encrypted with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1630.1">crypt(3)</span></strong><span class="koboSpan" id="kobo.1631.1"> function—for example, with the help of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1632.1">htpasswd</span></strong><span class="koboSpan" id="kobo.1633.1"> command-line utility from </span><span class="No-Break"><span class="koboSpan" id="kobo.1634.1">Apache package</span><a id="_idTextAnchor482"/><a id="_idTextAnchor483"/><span class="koboSpan" id="kobo.1635.1">s.</span></span></p>
<h3><span class="koboSpan" id="kobo.1636.1">Access</span></h3>
<p><span class="koboSpan" id="kobo.1637.1">Two important directives</span><a id="_idIndexMarker297"/><span class="koboSpan" id="kobo.1638.1"> are brought up by this module: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1639.1">allow</span></strong><span class="koboSpan" id="kobo.1640.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1641.1">deny</span></strong><span class="koboSpan" id="kobo.1642.1">. </span><span class="koboSpan" id="kobo.1642.2">They let you allow or deny access to a resource for a specific IP address or IP </span><span class="No-Break"><span class="koboSpan" id="kobo.1643.1">address range.</span></span></p>
<p><span class="koboSpan" id="kobo.1644.1">Both directives have the same syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1645.1">allow IP</span></strong><span class="koboSpan" id="kobo.1646.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1647.1">CIDR</span></strong><span class="koboSpan" id="kobo.1648.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1649.1">unix:</span></strong><span class="koboSpan" id="kobo.1650.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1651.1">all</span></strong><span class="koboSpan" id="kobo.1652.1">, where </span><strong class="source-inline"><span class="koboSpan" id="kobo.1653.1">IP</span></strong><span class="koboSpan" id="kobo.1654.1"> is an IP address, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1655.1">CIDR</span></strong><span class="koboSpan" id="kobo.1656.1"> is an IP address range (</span><strong class="bold"><span class="koboSpan" id="kobo.1657.1">Classless Inter-Domain Routing</span></strong><span class="koboSpan" id="kobo.1658.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.1659.1">CIDR</span></strong><span class="koboSpan" id="kobo.1660.1"> syntax), </span><strong class="source-inline"><span class="koboSpan" id="kobo.1661.1">unix:</span></strong><span class="koboSpan" id="kobo.1662.1"> represents all Unix</span><a id="_idIndexMarker298"/><span class="koboSpan" id="kobo.1663.1"> domain sockets, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1664.1">all</span></strong><span class="koboSpan" id="kobo.1665.1"> specifies that the directive applies to </span><span class="No-Break"><span class="koboSpan" id="kobo.1666.1">all clients:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1667.1">
location {
allow 127.0.0.1; # allow local IP address
allow unix:; # allow UNIX domain sockets
    deny all; # deny all other IP addresses
}</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.1668.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1669.1">Note that rules are processed from the top down: if your first instruction is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1670.1">deny all</span></strong><span class="koboSpan" id="kobo.1671.1">, all possible </span><strong class="source-inline"><span class="koboSpan" id="kobo.1672.1">allow</span></strong><span class="koboSpan" id="kobo.1673.1"> exceptions that you place afterward will have no effect. </span><span class="koboSpan" id="kobo.1673.2">The opposite is also true; if you start with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1674.1">allow all</span></strong><span class="koboSpan" id="kobo.1675.1">, all possible </span><strong class="source-inline"><span class="koboSpan" id="kobo.1676.1">deny</span></strong><span class="koboSpan" id="kobo.1677.1"> directives that you place afterward will have no effect, as you already allowed all </span><span class="No-Break"><span class="koboSpan" id="kobo.1678.1">IP addres</span><a id="_idTextAnchor484"/><a id="_idTextAnchor485"/><span class="koboSpan" id="kobo.1679.1">ses.</span></span></p>
<h3><span class="koboSpan" id="kobo.1680.1">Limit connections</span></h3>
<p><span class="koboSpan" id="kobo.1681.1">The mechanism induced</span><a id="_idIndexMarker299"/><span class="koboSpan" id="kobo.1682.1"> by this module is a little more complex than regular ones. </span><span class="koboSpan" id="kobo.1682.2">It allows you to define the maximum amount of simultaneous connections to the server for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1683.1">specific </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1684.1">zone</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1685.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1686.1">The first step is to define the zone using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1687.1">limit_conn_zone</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1688.1"> directive:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1689.1">The directive syntax is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1690.1">limit_conn_zone $</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1691.1">variable zone=name:size;</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1692.1">$variable</span></strong><span class="koboSpan" id="kobo.1693.1"> is the variable that will be used to differentiate one client from another, typically </span><strong class="source-inline"><span class="koboSpan" id="kobo.1694.1">$binary_remote_addr</span></strong><span class="koboSpan" id="kobo.1695.1">, the IP address of the client in binary format (more efficient </span><span class="No-Break"><span class="koboSpan" id="kobo.1696.1">than ASCII)</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1697.1">name</span></strong><span class="koboSpan" id="kobo.1698.1"> is an arbitrary name given to </span><span class="No-Break"><span class="koboSpan" id="kobo.1699.1">the zone</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1700.1">size</span></strong><span class="koboSpan" id="kobo.1701.1"> is the maximum size you allocate to the table storing </span><span class="No-Break"><span class="koboSpan" id="kobo.1702.1">session states</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1703.1">The following example defines zones based on the client IP addresses (</span><span class="No-Break"><span class="koboSpan" id="kobo.1704.1">incoming connections):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1705.1">
limit_conn_zone $binary_remote_addr zone=myzone:10m;</span></pre> <p><span class="koboSpan" id="kobo.1706.1">Now that you have defined a zone, you may limit connections </span><span class="No-Break"><span class="koboSpan" id="kobo.1707.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1708.1">limit_conn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1709.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1710.1">
limit_conn zone_name connection_limit;</span></pre> <p><span class="koboSpan" id="kobo.1711.1">When applied to the previous example, it becomes </span><span class="No-Break"><span class="koboSpan" id="kobo.1712.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1713.1">
location /downloads/ {
    limit_conn myzone 1;
}</span></pre> <p><span class="koboSpan" id="kobo.1714.1">As a result, requests that share the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.1715.1">$binary_remote_addr</span></strong><span class="koboSpan" id="kobo.1716.1"> IP address are subject to the connection limit (one simultaneous connection). </span><span class="koboSpan" id="kobo.1716.2">If the limit is reached, all additional concurrent requests will be answered with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1717.1">503 Service Unavailable</span></strong><span class="koboSpan" id="kobo.1718.1"> HTTP response. </span><span class="koboSpan" id="kobo.1718.2">This response code can be overridden if you specify another code via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1719.1">limit_conn_status</span></strong><span class="koboSpan" id="kobo.1720.1"> directive. </span><span class="koboSpan" id="kobo.1720.2">If you wish to log client requests that are affected by the limits you have set, enable the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1721.1">limit_conn_log_level</span></strong><span class="koboSpan" id="kobo.1722.1"> directive</span><a id="_idIndexMarker300"/><span class="koboSpan" id="kobo.1723.1"> and specify the log level (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1724.1">info</span></strong><span class="koboSpan" id="kobo.1725.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1726.1">notice</span></strong><span class="koboSpan" id="kobo.1727.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1728.1">warn</span></strong><span class="koboSpan" id="kobo.1729.1"> | </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1730.1">e</span><a id="_idTextAnchor486"/><a id="_idTextAnchor487"/><span class="koboSpan" id="kobo.1731.1">rror</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1732.1">).</span></span></p>
<h3><span class="koboSpan" id="kobo.1733.1">Limit request</span></h3>
<p><span class="koboSpan" id="kobo.1734.1">In a similar fashion, the Limit request module</span><a id="_idIndexMarker301"/><span class="koboSpan" id="kobo.1735.1"> allows you to limit the amount of requests for a </span><span class="No-Break"><span class="koboSpan" id="kobo.1736.1">defined zone.</span></span></p>
<p><span class="koboSpan" id="kobo.1737.1">Defining the zone is done via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1738.1">limit_req_zone</span></strong><span class="koboSpan" id="kobo.1739.1"> directive; its syntax differs from the Limit zone </span><span class="No-Break"><span class="koboSpan" id="kobo.1740.1">equivalent directive:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1741.1">
limit_req_zone $variable zone=name:max_memory_size rate=rate;</span></pre> <p><span class="koboSpan" id="kobo.1742.1">The directive parameters</span><a id="_idIndexMarker302"/><span class="koboSpan" id="kobo.1743.1"> are identical, except</span><a id="_idIndexMarker303"/><span class="koboSpan" id="kobo.1744.1"> for the trailing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1745.1">rate</span></strong><span class="koboSpan" id="kobo.1746.1"> parameter, expressed in </span><strong class="bold"><span class="koboSpan" id="kobo.1747.1">requests per second</span></strong><span class="koboSpan" id="kobo.1748.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1749.1">r/s</span></strong><span class="koboSpan" id="kobo.1750.1">) or </span><strong class="bold"><span class="koboSpan" id="kobo.1751.1">requests per minute</span></strong><span class="koboSpan" id="kobo.1752.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1753.1">r/m</span></strong><span class="koboSpan" id="kobo.1754.1">). </span><span class="koboSpan" id="kobo.1754.2">It defines a request rate that will be applied to clients where the zone is enabled. </span><span class="koboSpan" id="kobo.1754.3">To apply a zone to a location, use the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1755.1">limit_req</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1756.1"> directive:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1757.1">
limit_req zone=name burst=burst [nodelay];</span></pre> <p><span class="koboSpan" id="kobo.1758.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1759.1">burst</span></strong><span class="koboSpan" id="kobo.1760.1"> parameter defines the maximum possible bursts of requests. </span><span class="koboSpan" id="kobo.1760.2">When the amount of requests received from a client exceeds the limit defined in the zone, responses are delayed in a manner that respects the rate that you defined. </span><span class="koboSpan" id="kobo.1760.3">To a certain extent, only a maximum of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1761.1">burst</span></strong><span class="koboSpan" id="kobo.1762.1"> requests will be accepted simultaneously. </span><span class="koboSpan" id="kobo.1762.2">Past this limit, NGINX returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1763.1">503 Service Unavailable</span></strong><span class="koboSpan" id="kobo.1764.1"> HTTP error response. </span><span class="koboSpan" id="kobo.1764.2">This response code can be overridden if you specify another code via the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1765.1">limit_req_status</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1766.1"> directive:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1767.1">
limit_req_zone $binary_remote_addr zone=myzone:10m rate=2r/s;
[...]
location /downloads/ {
limit_req zone=myzone burst=10;
limit_req_status 404; # returns a 403 error if limit is exceeded
}</span></pre> <p><span class="koboSpan" id="kobo.1768.1">If you wish to log client requests that are affected by the limits you have set, enable the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1769.1">limit_req_log_level</span></strong><span class="koboSpan" id="kobo.1770.1"> directive</span><a id="_idIndexMarker304"/><span class="koboSpan" id="kobo.1771.1"> and specify the log level (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1772.1">info</span></strong><span class="koboSpan" id="kobo.1773.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1774.1">notice</span></strong><span class="koboSpan" id="kobo.1775.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1776.1">warn</span><a id="_idTextAnchor488"/><a id="_idTextAnchor489"/></strong><span class="koboSpan" id="kobo.1777.1"> | </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1778.1">error</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1779.1">).</span></span></p>
<h3><span class="koboSpan" id="kobo.1780.1">Auth request</span></h3>
<p><span class="koboSpan" id="kobo.1781.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1782.1">auth_request</span></strong><span class="koboSpan" id="kobo.1783.1"> module was implemented</span><a id="_idIndexMarker305"/><span class="koboSpan" id="kobo.1784.1"> in recent versions of NGINX and allows you to allow or deny access to a resource based on the result of a sub-request. </span><span class="koboSpan" id="kobo.1784.2">NGINX calls the URI that you specify via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1785.1">auth_request</span></strong><span class="koboSpan" id="kobo.1786.1"> directive: if the sub-request returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1787.1">2xx</span></strong><span class="koboSpan" id="kobo.1788.1"> response code (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1789.1">HTTP/200 OK</span></strong><span class="koboSpan" id="kobo.1790.1">), access is allowed. </span><span class="koboSpan" id="kobo.1790.2">If the sub-request returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1791.1">401</span></strong><span class="koboSpan" id="kobo.1792.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1793.1">403</span></strong><span class="koboSpan" id="kobo.1794.1"> status code, access is denied, and NGINX forwards the response code to the client. </span><span class="koboSpan" id="kobo.1794.2">Should the backend return any other response code, NGINX will consider it to be an error and deny access to </span><span class="No-Break"><span class="koboSpan" id="kobo.1795.1">the resource:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1796.1">
location /downloads/ {
# if the script below returns a 200 status code,
# the download is authorized
auth_request /authorization.php;
}</span></pre> <p><span class="koboSpan" id="kobo.1797.1">Additionally, the module offers a second directive, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1798.1">auth_request_set</span></strong><span class="koboSpan" id="kobo.1799.1">, allowing you to set a variable after the sub-request is executed. </span><span class="koboSpan" id="kobo.1799.2">You can insert variables that originate from the sub-request upstream (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1800.1">$upstream_http_*</span></strong><span class="koboSpan" id="kobo.1801.1">), such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1802.1">$upstream_http_server</span></strong><span class="koboSpan" id="kobo.1803.1"> or other HTTP</span><a id="_idIndexMarker306"/><span class="koboSpan" id="kobo.1804.1"> headers, from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1805.1">server response:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1806.1">
location /downloads/ {
     # requests authorization from PHP script
     auth_request /authorization.php;
     # assuming authorization is granted, get filename from
     # sub-request response header and redirect
     auth_request_set $filename "${upstream_http_x_filename}.zip";
    rewrite ^ /documents/</span><a id="_idTextAnchor490"/><span class="koboSpan" id="kobo.1807.1">$</span><a id="_idTextAnchor491"/><span class="koboSpan" id="kobo.1808.1">filename;
}</span></pre> <h2 id="_idParaDest-106"><a id="_idTextAnchor492"/><span class="koboSpan" id="kobo.1809.1">Content and encoding</span></h2>
<p><span class="koboSpan" id="kobo.1810.1">The following set of modules provides functionalities that have an effect on the contents served to the client, either by modifying the way the response is encoded, by affecting the headers, or by generating a response </span><a id="_idTextAnchor493"/><span class="No-Break"><span class="koboSpan" id="kobo.1811.1">f</span><a id="_idTextAnchor494"/><span class="koboSpan" id="kobo.1812.1">rom scratch.</span></span></p>
<h3><span class="koboSpan" id="kobo.1813.1">Empty GIF</span></h3>
<p><span class="koboSpan" id="kobo.1814.1">The purpose of this module</span><a id="_idIndexMarker307"/><span class="koboSpan" id="kobo.1815.1"> is to provide a directive that serves a 1x1 transparent GIF image from the memory. </span><span class="koboSpan" id="kobo.1815.2">Such files are sometimes used by web designers to tweak the appearance of their websites. </span><span class="koboSpan" id="kobo.1815.3">With this directive, you get an empty GIF straight from the memory, instead of reading and processing an actual GIF file from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1816.1">storage space.</span></span></p>
<p><span class="koboSpan" id="kobo.1817.1">To utilize this feature, simply insert the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1818.1">empty_gif</span></strong><span class="koboSpan" id="kobo.1819.1"> directive in the location</span><a id="_idIndexMarker308"/><span class="koboSpan" id="kobo.1820.1"> of </span><span class="No-Break"><span class="koboSpan" id="kobo.1821.1">your choice:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1822.1">
location = /empty.gif {
    </span><a id="_idTextAnchor495"/><span class="koboSpan" id="kobo.1823.1">e</span><a id="_idTextAnchor496"/><span class="koboSpan" id="kobo.1824.1">mpty_gif;
}</span></pre> <h3><span class="koboSpan" id="kobo.1825.1">MP4</span></h3>
<p><span class="koboSpan" id="kobo.1826.1">MP4 is a module that enables</span><a id="_idIndexMarker309"/><span class="koboSpan" id="kobo.1827.1"> a simple functionality that becomes useful when serving MP4 video files. </span><span class="koboSpan" id="kobo.1827.2">It parses a special argument of the request, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1828.1">start</span></strong><span class="koboSpan" id="kobo.1829.1">, which indicates the offset of the section the client wishes to download or pseudo-stream. </span><span class="koboSpan" id="kobo.1829.2">The video file must thus be accessed with the following URI: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1830.1">video.mp4?start=XXX</span></strong><span class="koboSpan" id="kobo.1831.1">. </span><span class="koboSpan" id="kobo.1831.2">This parameter is prepared automatically by mainstream video players, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.1832.1">JW Player.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1833.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1834.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.1835.1">NGINX build.</span></span></p>
<p><span class="koboSpan" id="kobo.1836.1">To utilize this feature, simply insert the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1837.1">.mp4</span></strong><span class="koboSpan" id="kobo.1838.1"> directive in the location of </span><span class="No-Break"><span class="koboSpan" id="kobo.1839.1">your choice:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1840.1">
location ~* \.mp4 {
    mp4;
}</span></pre> <p><span class="koboSpan" id="kobo.1841.1">Be aware that if NGINX fails to seek the requested position within the video file, the request will result in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1842.1">500 Internal Server Error</span></strong><span class="koboSpan" id="kobo.1843.1"> HTTP response. </span><span class="koboSpan" id="kobo.1843.2">JW Player sometimes misinterprets this error and simply displays a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1844.1">Video not foun</span><a id="_idTextAnchor497"/><span class="koboSpan" id="kobo.1845.1">d</span><a id="_idTextAnchor498"/></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1846.1">error message.</span></span></p>
<h3><span class="koboSpan" id="kobo.1847.1">HTTP headers</span></h3>
<p><span class="koboSpan" id="kobo.1848.1">Three directives are introduced</span><a id="_idIndexMarker310"/><span class="koboSpan" id="kobo.1849.1"> by this module that will affect the header of the response sent to </span><span class="No-Break"><span class="koboSpan" id="kobo.1850.1">the client.</span></span></p>
<p><span class="koboSpan" id="kobo.1851.1">First, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1852.1">add_header name value [always]</span></strong><span class="koboSpan" id="kobo.1853.1"> lets you add a new line in the response headers, respecting the following syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1854.1">Name: value</span></strong><span class="koboSpan" id="kobo.1855.1">. </span><span class="koboSpan" id="kobo.1855.2">The line is added only for responses of the following codes: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1856.1">200</span></strong><span class="koboSpan" id="kobo.1857.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1858.1">201</span></strong><span class="koboSpan" id="kobo.1859.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1860.1">204</span></strong><span class="koboSpan" id="kobo.1861.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1862.1">301</span></strong><span class="koboSpan" id="kobo.1863.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1864.1">302</span></strong><span class="koboSpan" id="kobo.1865.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1866.1">304</span></strong><span class="koboSpan" id="kobo.1867.1">. </span><span class="koboSpan" id="kobo.1867.2">You may insert variables in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1868.1">value</span></strong><span class="koboSpan" id="kobo.1869.1"> argument. </span><span class="koboSpan" id="kobo.1869.2">If you specify </span><strong class="source-inline"><span class="koboSpan" id="kobo.1870.1">always</span></strong><span class="koboSpan" id="kobo.1871.1"> at the end of the directive value, the header will always be added, regardless of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1872.1">response code.</span></span></p>
<p><span class="koboSpan" id="kobo.1873.1">Additionally, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1874.1">add_trailer name value [always]</span></strong><span class="koboSpan" id="kobo.1875.1"> directive allows you to add a header to the end of the response if the response code is one of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1876.1">200</span></strong><span class="koboSpan" id="kobo.1877.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1878.1">201</span></strong><span class="koboSpan" id="kobo.1879.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1880.1">204</span></strong><span class="koboSpan" id="kobo.1881.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1882.1">206</span></strong><span class="koboSpan" id="kobo.1883.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1884.1">301</span></strong><span class="koboSpan" id="kobo.1885.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1886.1">302</span></strong><span class="koboSpan" id="kobo.1887.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1888.1">303</span></strong><span class="koboSpan" id="kobo.1889.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1890.1">307</span></strong><span class="koboSpan" id="kobo.1891.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1892.1">308</span></strong><span class="koboSpan" id="kobo.1893.1">. </span><span class="koboSpan" id="kobo.1893.2">This directive can be specified multiple times to add multiple headers. </span><span class="koboSpan" id="kobo.1893.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1894.1">always</span></strong><span class="koboSpan" id="kobo.1895.1"> flag works similarly to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1896.1">add_header</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1897.1"> version.</span></span></p>
<p><span class="koboSpan" id="kobo.1898.1">Finally, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1899.1">expires</span></strong><span class="koboSpan" id="kobo.1900.1"> directive allows you to control the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1901.1">Expires</span></strong><span class="koboSpan" id="kobo.1902.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1903.1">Cache-Control</span></strong><span class="koboSpan" id="kobo.1904.1"> HTTP headers sent to the client, affecting requests of the same code, as listed earlier. </span><span class="koboSpan" id="kobo.1904.2">It accepts a single value among </span><span class="No-Break"><span class="koboSpan" id="kobo.1905.1">the following:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1906.1">off</span></strong><span class="koboSpan" id="kobo.1907.1">: Does not modify </span><span class="No-Break"><span class="koboSpan" id="kobo.1908.1">either header.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1909.1">A time value</span></strong><span class="koboSpan" id="kobo.1910.1">: The expiration date of the file is set to </span><em class="italic"><span class="koboSpan" id="kobo.1911.1">the current time</span></em><span class="koboSpan" id="kobo.1912.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.1913.1">the time you specify</span></em><span class="koboSpan" id="kobo.1914.1">. </span><span class="koboSpan" id="kobo.1914.2">For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1915.1">expires 24h</span></strong><span class="koboSpan" id="kobo.1916.1"> will return an expiry date set to 24 hours </span><span class="No-Break"><span class="koboSpan" id="kobo.1917.1">from now.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1918.1">epoch</span></strong><span class="koboSpan" id="kobo.1919.1">: The expiration date of the file is set to January 1, 1970. </span><span class="koboSpan" id="kobo.1919.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1920.1">Cache-Control</span></strong><span class="koboSpan" id="kobo.1921.1"> header is set </span><span class="No-Break"><span class="koboSpan" id="kobo.1922.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1923.1">no-cache</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1924.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1925.1">max</span></strong><span class="koboSpan" id="kobo.1926.1">: The expiration date of the file is set to December 31, 2037. </span><span class="koboSpan" id="kobo.1926.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1927.1">Cache-Control</span></strong><span class="koboSpan" id="kobo.1928.1"> header</span><a id="_idIndexMarker311"/><span class="koboSpan" id="kobo.1929.1"> i</span><a id="_idTextAnchor499"/><span class="koboSpan" id="kobo.1930.1">s</span><a id="_idTextAnchor500"/><span class="koboSpan" id="kobo.1931.1"> set to </span><span class="No-Break"><span class="koboSpan" id="kobo.1932.1">10 years.</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.1933.1">Addition</span></h3>
<p><span class="koboSpan" id="kobo.1934.1">The Addition module allows </span><a id="_idIndexMarker312"/><span class="koboSpan" id="kobo.1935.1">you to (through simple directives) add content before or after the body of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1936.1">HTTP response.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1937.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1938.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.1939.1">NGINX build.</span></span></p>
<p><span class="koboSpan" id="kobo.1940.1">The two main directives are </span><span class="No-Break"><span class="koboSpan" id="kobo.1941.1">the following:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1942.1">add_before_body file_uri;</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1943.1">add_after_body file_uri;</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1944.1">As stated previously, NGINX triggers a sub-request for fetching the specified URI. </span><span class="koboSpan" id="kobo.1944.2">Additionally, you can define the types of files to which content is appended in case your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1945.1">location</span></strong><span class="koboSpan" id="kobo.1946.1"> block pattern</span><a id="_idIndexMarker313"/><span class="koboSpan" id="kobo.1947.1"> is not specific enough (</span><span class="No-Break"><span class="koboSpan" id="kobo.1948.1">default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1949.1">text/html</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1950.1">):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1951.1">
addition_types mime_type1 [mime_type2...];</span><a id="_idTextAnchor501"/><a id="_idTextAnchor502"/><span class="koboSpan" id="kobo.1952.1">
addition_types *;</span></pre> <h3><span class="koboSpan" id="kobo.1953.1">Substitution</span></h3>
<p><span class="koboSpan" id="kobo.1954.1">Along the lines of the previous</span><a id="_idIndexMarker314"/><span class="koboSpan" id="kobo.1955.1"> module, the Substitution module allows you to search and replace text directly from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1956.1">response body:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1957.1">
sub_filter searched_text replacement_text;</span></pre> <p><span class="koboSpan" id="kobo.1958.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.1959.1">NGINX build.</span></span></p>
<p><span class="koboSpan" id="kobo.1960.1">Two additional directives provide </span><span class="No-Break"><span class="koboSpan" id="kobo.1961.1">more flexibility:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1962.1">sub_filter_once</span></strong><span class="koboSpan" id="kobo.1963.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1964.1">on</span></strong><span class="koboSpan" id="kobo.1965.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1966.1">off</span></strong><span class="koboSpan" id="kobo.1967.1">, default </span><strong class="source-inline"><span class="koboSpan" id="kobo.1968.1">on</span></strong><span class="koboSpan" id="kobo.1969.1">): Only replaces the text once, and stops after the </span><span class="No-Break"><span class="koboSpan" id="kobo.1970.1">first occurrence.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1971.1">sub_filter_types</span></strong><span class="koboSpan" id="kobo.1972.1"> (default </span><strong class="source-inline"><span class="koboSpan" id="kobo.1973.1">text/html</span></strong><span class="koboSpan" id="kobo.1974.1">): Affects additional MIME types that will be eligible for text replacement. </span><span class="koboSpan" id="kobo.1974.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1975.1">*</span></strong> <a id="_idTextAnchor503"/><a id="_idTextAnchor504"/><span class="koboSpan" id="kobo.1976.1">wildcard </span><span class="No-Break"><span class="koboSpan" id="kobo.1977.1">is allowed.</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.1978.1">Gzip filter</span></h3>
<p><span class="koboSpan" id="kobo.1979.1">This module allows</span><a id="_idIndexMarker315"/><span class="koboSpan" id="kobo.1980.1"> you to compress the response body with the Gzip algorithm before sending it to the client. </span><span class="koboSpan" id="kobo.1980.2">To enable Gzip compression, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1981.1">gzip</span></strong><span class="koboSpan" id="kobo.1982.1"> directive (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1983.1">on</span></strong><span class="koboSpan" id="kobo.1984.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.1985.1">off</span></strong><span class="koboSpan" id="kobo.1986.1">) at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1987.1">http</span></strong><span class="koboSpan" id="kobo.1988.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1989.1">server</span></strong><span class="koboSpan" id="kobo.1990.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1991.1">location</span></strong><span class="koboSpan" id="kobo.1992.1">, and even the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1993.1">if</span></strong><span class="koboSpan" id="kobo.1994.1"> level (though that is not recommended). </span><span class="koboSpan" id="kobo.1994.2">The following directives will help you to further configure the </span><span class="No-Break"><span class="koboSpan" id="kobo.1995.1">filter options:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table009">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1996.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1997.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1998.1">gzip_buffers</span></strong></span></p>
<p><span class="koboSpan" id="kobo.1999.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2000.1">http</span></strong><span class="koboSpan" id="kobo.2001.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2002.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2003.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2004.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2005.1">Defines the amount and size of buffers to be used for storing the </span><span class="No-Break"><span class="koboSpan" id="kobo.2006.1">compressed response.</span></span></p>
<p><span class="koboSpan" id="kobo.2007.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2008.1">gzip_buffers </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2009.1">amount size;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2010.1">Default: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2011.1">gzip_buffers 4 4k</span></strong><span class="koboSpan" id="kobo.2012.1"> (or </span><strong class="source-inline"><span class="koboSpan" id="kobo.2013.1">8k</span></strong><span class="koboSpan" id="kobo.2014.1">, depending on </span><span class="No-Break"><span class="koboSpan" id="kobo.2015.1">the OS)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2016.1">gzip_comp_level</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2017.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2018.1">http</span></strong><span class="koboSpan" id="kobo.2019.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2020.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2021.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2022.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2023.1">Defines the compression level of the algorithm. </span><span class="koboSpan" id="kobo.2023.2">The specified value ranges from </span><strong class="source-inline"><span class="koboSpan" id="kobo.2024.1">1</span></strong><span class="koboSpan" id="kobo.2025.1"> (low compression, faster for the CPU) to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2026.1">9</span></strong><span class="koboSpan" id="kobo.2027.1"> (high </span><span class="No-Break"><span class="koboSpan" id="kobo.2028.1">compression, slower).</span></span></p>
<p><span class="koboSpan" id="kobo.2029.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.2030.1">Numeric value</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2031.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2032.1">1</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2033.1">gzip_disable</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2034.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2035.1">http</span></strong><span class="koboSpan" id="kobo.2036.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2037.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2038.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2039.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2040.1">Disables Gzip compression for requests where the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2041.1">User-Agent</span></strong><span class="koboSpan" id="kobo.2042.1"> HTTP header matches the specified </span><span class="No-Break"><span class="koboSpan" id="kobo.2043.1">regular expression.</span></span></p>
<p><span class="koboSpan" id="kobo.2044.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.2045.1">Regular expression</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2046.1">Default: None</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2047.1">gzip_http_version</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2048.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2049.1">http</span></strong><span class="koboSpan" id="kobo.2050.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2051.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2052.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2053.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2054.1">Enables Gzip compression for the specified </span><span class="No-Break"><span class="koboSpan" id="kobo.2055.1">protocol version.</span></span></p>
<p><span class="koboSpan" id="kobo.2056.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2057.1">1.0</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2058.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2059.1">1.1</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2060.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2061.1">1.1</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2062.1">gzip_min_length</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2063.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2064.1">http</span></strong><span class="koboSpan" id="kobo.2065.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2066.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2067.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2068.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2069.1">If the response body length is inferior to the specified value, it is </span><span class="No-Break"><span class="koboSpan" id="kobo.2070.1">not compressed.</span></span></p>
<p><span class="koboSpan" id="kobo.2071.1">Syntax: Numeric </span><span class="No-Break"><span class="koboSpan" id="kobo.2072.1">value (size)</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2073.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2074.1">0</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2075.1">gzip_proxied</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2076.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2077.1">http</span></strong><span class="koboSpan" id="kobo.2078.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2079.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2080.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2081.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2082.1">Enables or disables Gzip compression for the body of responses received from a proxy (see reverse-proxying mechanisms in </span><span class="No-Break"><span class="koboSpan" id="kobo.2083.1">later chapters).</span></span></p>
<p><span class="koboSpan" id="kobo.2084.1">The directive accepts the following parameters; some can </span><span class="No-Break"><span class="koboSpan" id="kobo.2085.1">be combined:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2086.1">off/any</span></strong><span class="koboSpan" id="kobo.2087.1">: Disables or enables compression for </span><span class="No-Break"><span class="koboSpan" id="kobo.2088.1">all requests</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2089.1">expired</span></strong><span class="koboSpan" id="kobo.2090.1">: Enables compression if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2091.1">Expires</span></strong><span class="koboSpan" id="kobo.2092.1"> header </span><span class="No-Break"><span class="koboSpan" id="kobo.2093.1">prevents caching</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2094.1">no-cache/no-store/private</span></strong><span class="koboSpan" id="kobo.2095.1">: Enables compression if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2096.1">Cache-Control</span></strong><span class="koboSpan" id="kobo.2097.1"> header is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2098.1">no-cache</span></strong><span class="koboSpan" id="kobo.2099.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2100.1">no-store</span></strong><span class="koboSpan" id="kobo.2101.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.2102.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2103.1">private</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2104.1">no_last_modified</span></strong><span class="koboSpan" id="kobo.2105.1">: Enables compression in case the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2106.1">Last-Modified</span></strong><span class="koboSpan" id="kobo.2107.1"> header is </span><span class="No-Break"><span class="koboSpan" id="kobo.2108.1">not set</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2109.1">no_etag</span></strong><span class="koboSpan" id="kobo.2110.1">: Enables compression in case the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2111.1">ETag</span></strong><span class="koboSpan" id="kobo.2112.1"> header is </span><span class="No-Break"><span class="koboSpan" id="kobo.2113.1">not set</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2114.1">auth</span></strong><span class="koboSpan" id="kobo.2115.1">: Enables compression in case an </span><strong class="source-inline"><span class="koboSpan" id="kobo.2116.1">Authorization</span></strong><span class="koboSpan" id="kobo.2117.1"> header </span><span class="No-Break"><span class="koboSpan" id="kobo.2118.1">is set</span></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2119.1">gzip_types</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2120.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2121.1">http</span></strong><span class="koboSpan" id="kobo.2122.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2123.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2124.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2125.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2126.1">Enables compression for types other than the default </span><strong class="source-inline"><span class="koboSpan" id="kobo.2127.1">text/html</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2128.1">MIME type.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2129.1">Syntax:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2130.1">gzip_types   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2131.1">mime_type1 [mime_type2...];</span></strong></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2132.1">gzip_types *;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2133.1">Default: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2134.1">text/html</span></strong><span class="koboSpan" id="kobo.2135.1"> (cannot </span><span class="No-Break"><span class="koboSpan" id="kobo.2136.1">be disabled)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2137.1">gzip_vary</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2138.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2139.1">http</span></strong><span class="koboSpan" id="kobo.2140.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2141.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2142.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2143.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2144.1">Adds the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2145.1">Vary: Accept-Encoding</span></strong><span class="koboSpan" id="kobo.2146.1"> HTTP header to </span><span class="No-Break"><span class="koboSpan" id="kobo.2147.1">the response.</span></span></p>
<p><span class="koboSpan" id="kobo.2148.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2149.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2150.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2151.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2152.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2153.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2154.1">gzip_window</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2155.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2156.1">http</span></strong><span class="koboSpan" id="kobo.2157.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2158.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2159.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2160.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2161.1">Sets the size of the window buffer (</span><strong class="source-inline"><span class="koboSpan" id="kobo.2162.1">windowBits</span></strong><span class="koboSpan" id="kobo.2163.1"> argument) for Gzipping operations. </span><span class="koboSpan" id="kobo.2163.2">This directive value is used for calls to functions from the </span><span class="No-Break"><span class="koboSpan" id="kobo.2164.1">Zlib library.</span></span></p>
<p><span class="koboSpan" id="kobo.2165.1">Syntax: Numeric </span><span class="No-Break"><span class="koboSpan" id="kobo.2166.1">value (size)</span></span></p>
<p><span class="koboSpan" id="kobo.2167.1">Default: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2168.1">MAX_WBITS</span></strong><span class="koboSpan" id="kobo.2169.1"> constant from the </span><span class="No-Break"><span class="koboSpan" id="kobo.2170.1">Zlib library</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2171.1">gzip_hash</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2172.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2173.1">http</span></strong><span class="koboSpan" id="kobo.2174.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2175.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2176.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2177.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2178.1">Sets the amount of memory that should be allocated for the internal compression state (</span><strong class="source-inline"><span class="koboSpan" id="kobo.2179.1">memLevel</span></strong><span class="koboSpan" id="kobo.2180.1"> argument). </span><span class="koboSpan" id="kobo.2180.2">This directive value is used for calls to functions from the </span><span class="No-Break"><span class="koboSpan" id="kobo.2181.1">Zlib library.</span></span></p>
<p><span class="koboSpan" id="kobo.2182.1">Syntax: Numeric </span><span class="No-Break"><span class="koboSpan" id="kobo.2183.1">value (size)</span></span></p>
<p><span class="koboSpan" id="kobo.2184.1">Default: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2185.1">MAX_MEM_LEVEL</span></strong><span class="koboSpan" id="kobo.2186.1"> constant from the Zlib </span><span class="No-Break"><span class="koboSpan" id="kobo.2187.1">prerequisite library</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2188.1">postpone_gzipping</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2189.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2190.1">http</span></strong><span class="koboSpan" id="kobo.2191.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2192.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2193.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2194.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2195.1">Defines a minimum data threshold to be reached before starting the </span><span class="No-Break"><span class="koboSpan" id="kobo.2196.1">Gzip compression.</span></span></p>
<p><span class="koboSpan" id="kobo.2197.1">Syntax: Size (</span><span class="No-Break"><span class="koboSpan" id="kobo.2198.1">numeric value)</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2199.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2200.1">0</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2201.1">gzip_no_buffer</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2202.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2203.1">http</span></strong><span class="koboSpan" id="kobo.2204.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2205.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2206.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2207.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2208.1">By default, NGINX waits until at least one buffer (defined by </span><strong class="source-inline"><span class="koboSpan" id="kobo.2209.1">gzip_buffers</span></strong><span class="koboSpan" id="kobo.2210.1">) is filled with data before sending a response to the client. </span><span class="koboSpan" id="kobo.2210.2">Enabling this directive </span><span class="No-Break"><span class="koboSpan" id="kobo.2211.1">disables buffering.</span></span></p>
<p><span class="koboSpan" id="kobo.2212.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2213.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2214.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2215.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2216.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2217.1">off</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor505"/><span class="koboSpan" id="kobo.2218.1">Table 4.9: A list of directives for the Gzip module</span></p>
<h3><a id="_idTextAnchor506"/><span class="koboSpan" id="kobo.2219.1">Gzip static</span></h3>
<p><span class="koboSpan" id="kobo.2220.1">This module adds a simple functionality</span><a id="_idIndexMarker316"/><span class="koboSpan" id="kobo.2221.1"> to the Gzip filter mechanism. </span><span class="koboSpan" id="kobo.2221.2">When its </span><strong class="source-inline"><span class="koboSpan" id="kobo.2222.1">gzip_static</span></strong><span class="koboSpan" id="kobo.2223.1"> directive (</span><strong class="source-inline"><span class="koboSpan" id="kobo.2224.1">on</span></strong><span class="koboSpan" id="kobo.2225.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2226.1">off</span></strong><span class="koboSpan" id="kobo.2227.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.2228.1">always</span></strong><span class="koboSpan" id="kobo.2229.1">) is enabled, NGINX will automatically look for a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2230.1">.gz</span></strong><span class="koboSpan" id="kobo.2231.1"> file corresponding to the requested document before serving it. </span><span class="koboSpan" id="kobo.2231.2">This allows NGINX to send pre-compressed documents instead of compressing documents on the fly at each request. </span><span class="koboSpan" id="kobo.2231.3">Specifying </span><strong class="source-inline"><span class="koboSpan" id="kobo.2232.1">always</span></strong><span class="koboSpan" id="kobo.2233.1"> will force NGINX to serve the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2234.1">gzip</span></strong><span class="koboSpan" id="kobo.2235.1"> version regardless of whether the client accepts </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2236.1">gzip</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2237.1"> encoding.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.2238.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2239.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.2240.1">NGINX build.</span></span></p>
<p><span class="koboSpan" id="kobo.2241.1">If a client requests </span><strong class="source-inline"><span class="koboSpan" id="kobo.2242.1">/documents/page.html</span></strong><span class="koboSpan" id="kobo.2243.1">, NGINX checks for the existence of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2244.1">/documents/page.html.gz</span></strong><span class="koboSpan" id="kobo.2245.1"> file. </span><span class="koboSpan" id="kobo.2245.2">If the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2246.1">.gz</span></strong><span class="koboSpan" id="kobo.2247.1"> file is found, it is served to the client. </span><span class="koboSpan" id="kobo.2247.2">Note that NGINX</span><a id="_idIndexMarker317"/><span class="koboSpan" id="kobo.2248.1"> does not generate </span><strong class="source-inline"><span class="koboSpan" id="kobo.2249.1">.gz</span></strong><span class="koboSpan" id="kobo.2250.1"> files itself, even after serving the </span><span class="No-Break"><span class="koboSpan" id="kobo.2251.1">requested files</span><a id="_idTextAnchor507"/><a id="_idTextAnchor508"/><span class="koboSpan" id="kobo.2252.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.2253.1">Gunzip filter</span></h3>
<p><span class="koboSpan" id="kobo.2254.1">With the Gunzip filter module, you can decompress</span><a id="_idIndexMarker318"/><span class="koboSpan" id="kobo.2255.1"> a Gzip-compressed response sent from a backend in order to serve it </span><em class="italic"><span class="koboSpan" id="kobo.2256.1">raw</span></em><span class="koboSpan" id="kobo.2257.1"> to the client—for example, in case the client browser is not able to process gzipped files (Microsoft Internet Explorer 6). </span><span class="koboSpan" id="kobo.2257.2">Simply insert </span><strong class="source-inline"><span class="koboSpan" id="kobo.2258.1">gunzip on;</span></strong><span class="koboSpan" id="kobo.2259.1"> in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2260.1">location</span></strong><span class="koboSpan" id="kobo.2261.1"> block to employ this module. </span><span class="koboSpan" id="kobo.2261.2">You can also set the buffer amount and size with </span><strong class="source-inline"><span class="koboSpan" id="kobo.2262.1">gunzip_buffers amount size;</span></strong><span class="koboSpan" id="kobo.2263.1">, where </span><strong class="source-inline"><span class="koboSpan" id="kobo.2264.1">amount</span></strong><span class="koboSpan" id="kobo.2265.1"> is the amount of buffers to allocate and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2266.1">size</span></strong><span class="koboSpan" id="kobo.2267.1"> is the size of each </span><span class="No-Break"><span class="koboSpan" id="kobo.2268.1">allocated buff</span><a id="_idTextAnchor509"/><span class="koboSpan" id="kobo.2269.1">e</span><a id="_idTextAnchor510"/><span class="koboSpan" id="kobo.2270.1">r.</span></span></p>
<h3><span class="koboSpan" id="kobo.2271.1">Charset filter</span></h3>
<p><span class="koboSpan" id="kobo.2272.1">With the Charset filter module, you can control</span><a id="_idIndexMarker319"/><span class="koboSpan" id="kobo.2273.1"> the character set of the response body more accurately. </span><span class="koboSpan" id="kobo.2273.2">Not only are you able to specify the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2274.1">charset</span></strong><span class="koboSpan" id="kobo.2275.1"> argument of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2276.1">Content-Type</span></strong><span class="koboSpan" id="kobo.2277.1"> HTTP header (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.2278.1">Content-Type: text/html; charset=utf-8</span></strong><span class="koboSpan" id="kobo.2279.1">), but NGINX can also re-encode data to a specified encoding </span><span class="No-Break"><span class="koboSpan" id="kobo.2280.1">method automatically:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table010">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2281.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2282.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2283.1">charset</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2284.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2285.1">http</span></strong><span class="koboSpan" id="kobo.2286.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2287.1">server</span></strong><span class="koboSpan" id="kobo.2288.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2289.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2290.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2291.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2292.1">This directive adds the specified encoding to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2293.1">Content-Type</span></strong><span class="koboSpan" id="kobo.2294.1"> header of the response. </span><span class="koboSpan" id="kobo.2294.2">If the specified encoding differs from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2295.1">source_charset</span></strong><span class="koboSpan" id="kobo.2296.1"> one, NGINX re-encodes </span><span class="No-Break"><span class="koboSpan" id="kobo.2297.1">the document.</span></span></p>
<p><span class="koboSpan" id="kobo.2298.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2299.1">charset encoding | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2300.1">off;</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2301.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2302.1">off</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2303.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2304.1">charset utf-8;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2305.1">source_charset</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2306.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2307.1">http</span></strong><span class="koboSpan" id="kobo.2308.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2309.1">server</span></strong><span class="koboSpan" id="kobo.2310.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2311.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2312.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2313.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2314.1">Defines the initial encoding of the response; if the value specified in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2315.1">charset</span></strong><span class="koboSpan" id="kobo.2316.1"> directive differs, NGINX re-encodes </span><span class="No-Break"><span class="koboSpan" id="kobo.2317.1">the document.</span></span></p>
<p><span class="koboSpan" id="kobo.2318.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2319.1">source_charset encoding;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2320.1">override_charset</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2321.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2322.1">http</span></strong><span class="koboSpan" id="kobo.2323.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2324.1">server</span></strong><span class="koboSpan" id="kobo.2325.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2326.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2327.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2328.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2329.1">When NGINX receives a response from the proxy or FastCGI gateway, this directive defines whether or not the character encoding should be checked and </span><span class="No-Break"><span class="koboSpan" id="kobo.2330.1">potentially overridden.</span></span></p>
<p><span class="koboSpan" id="kobo.2331.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2332.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2333.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2334.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2335.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2336.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2337.1">charset_types</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2338.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2339.1">http</span></strong><span class="koboSpan" id="kobo.2340.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2341.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2342.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2343.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2344.1">Defines the MIME types that are eligible </span><span class="No-Break"><span class="koboSpan" id="kobo.2345.1">for re-encoding.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2346.1">Syntax:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2347.1">charset_types   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2348.1">mime_type1 [mime_type2...];</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2349.1">charset_types   * ;</span></strong></p>
<p><span class="koboSpan" id="kobo.2350.1">Default: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2351.1">text/html</span></strong><span class="koboSpan" id="kobo.2352.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2353.1">text/xml</span></strong><span class="koboSpan" id="kobo.2354.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2355.1">text/plain</span></strong><span class="koboSpan" id="kobo.2356.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2357.1">text/vnd.wap.wml</span></strong><span class="koboSpan" id="kobo.2358.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2359.1">application/x-javascript</span></strong><span class="koboSpan" id="kobo.2360.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.2361.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2362.1">application/rss+xml</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2363.1">charset_map</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2364.1">Context: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2365.1">http</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2366.1">Lets you define character re-encoding tables. </span><span class="koboSpan" id="kobo.2366.2">Each line of the table contains two hexadecimal codes to be exchanged. </span><span class="koboSpan" id="kobo.2366.3">You will find re-encoding tables for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2367.1">koi8-r</span></strong><span class="koboSpan" id="kobo.2368.1"> character set in the default NGINX configuration folder (</span><strong class="source-inline"><span class="koboSpan" id="kobo.2369.1">koi-win</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2370.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2371.1">koi-utf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2372.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.2373.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2374.1">charset_map src_encoding dest_encoding { ... </span><span class="koboSpan" id="kobo.2374.2">}</span></strong></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor511"/><span class="koboSpan" id="kobo.2375.1">Table 4.10: A list of directives for the Charset filter module</span></p>
<h3><a id="_idTextAnchor512"/><span class="koboSpan" id="kobo.2376.1">Memcached</span></h3>
<p><span class="koboSpan" id="kobo.2377.1">Memcached is a daemon application</span><a id="_idIndexMarker320"/><span class="koboSpan" id="kobo.2378.1"> that can be connected via sockets. </span><span class="koboSpan" id="kobo.2378.2">Its main purpose, as the name suggests, is to provide an efficient distributed key/value memory caching system. </span><span class="koboSpan" id="kobo.2378.3">The NGINX Memcached module provides directives, allowing you to configure access to the </span><span class="No-Break"><span class="koboSpan" id="kobo.2379.1">Memcached daemon:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table011">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2380.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2381.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2382.1">memcached_pass</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2383.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2384.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2385.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2386.1">if</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2387.1">Defines the hostname and port of the </span><span class="No-Break"><span class="koboSpan" id="kobo.2388.1">Memcached daemon.</span></span></p>
<p><span class="koboSpan" id="kobo.2389.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2390.1">memcached_pass hostname:port;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2391.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2392.1">memcached_pass localhost:11211;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2393.1">memcached_bind</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2394.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2395.1">http</span></strong><span class="koboSpan" id="kobo.2396.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2397.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2398.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2399.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2400.1">Forces NGINX to use the specified local IP address for connecting to the Memcached server. </span><span class="koboSpan" id="kobo.2400.2">This can come in handy if your server has multiple network cards connected to </span><span class="No-Break"><span class="koboSpan" id="kobo.2401.1">different networks.</span></span></p>
<p><span class="koboSpan" id="kobo.2402.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2403.1">memcached_bind IP_address;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2404.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2405.1">memcached_bind 192.168.1.2;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2406.1">memcached_connect_timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2407.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2408.1">http</span></strong><span class="koboSpan" id="kobo.2409.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2410.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2411.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2412.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2413.1">Defines the connection timeout in milliseconds (</span><span class="No-Break"><span class="koboSpan" id="kobo.2414.1">default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2415.1">60000</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2416.1">)</span></span></p>
<p><span class="koboSpan" id="kobo.2417.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2418.1">memcached_connect_timeout 5000;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2419.1">memcached_send_timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2420.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2421.1">http</span></strong><span class="koboSpan" id="kobo.2422.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2423.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2424.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2425.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2426.1">Defines the data writing operations timeout in milliseconds (</span><span class="No-Break"><span class="koboSpan" id="kobo.2427.1">default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2428.1">60000</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2429.1">)</span></span></p>
<p><span class="koboSpan" id="kobo.2430.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2431.1">memcached_send_timeout 5,000;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2432.1">memcached_read_timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2433.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2434.1">http</span></strong><span class="koboSpan" id="kobo.2435.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2436.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2437.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2438.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2439.1">Defines the data reading operations timeout in milliseconds (</span><span class="No-Break"><span class="koboSpan" id="kobo.2440.1">default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2441.1">60000</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2442.1">)</span></span></p>
<p><span class="koboSpan" id="kobo.2443.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2444.1">memcached_read_timeout 5,000;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2445.1">memcached_buffer_size</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2446.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2447.1">http</span></strong><span class="koboSpan" id="kobo.2448.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2449.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2450.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2451.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2452.1">Defines the size of the read and write buffer in bytes (default: </span><span class="No-Break"><span class="koboSpan" id="kobo.2453.1">page size)</span></span></p>
<p><span class="koboSpan" id="kobo.2454.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2455.1">memcached_buffer_size 8k;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2456.1">memcached_next_upstream</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2457.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2458.1">http</span></strong><span class="koboSpan" id="kobo.2459.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2460.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2461.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2462.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2463.1">When the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2464.1">memcached_pass</span></strong><span class="koboSpan" id="kobo.2465.1"> directive is connected to an upstream block (see the Upstream module), this directive defines the conditions that should be matched in order to skip to the next </span><span class="No-Break"><span class="koboSpan" id="kobo.2466.1">upstream server.</span></span></p>
<p><span class="koboSpan" id="kobo.2467.1">Syntax: Values selected among </span><strong class="source-inline"><span class="koboSpan" id="kobo.2468.1">error timeout</span></strong><span class="koboSpan" id="kobo.2469.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2470.1">invalid_response</span></strong><span class="koboSpan" id="kobo.2471.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2472.1">not_found</span></strong><span class="koboSpan" id="kobo.2473.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.2474.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2475.1">off</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2476.1">Default: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2477.1">error timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2478.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2479.1">memcached_next_upstream off;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2480.1">memcached_gzip_flag</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2481.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2482.1">http</span></strong><span class="koboSpan" id="kobo.2483.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2484.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2485.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2486.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2487.1">Checks for the presence of the specified flag in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2488.1">memcached</span></strong><span class="koboSpan" id="kobo.2489.1"> server response. </span><span class="koboSpan" id="kobo.2489.2">If the flag is present, NGINX sets the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2490.1">Content-encoding</span></strong><span class="koboSpan" id="kobo.2491.1"> header to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2492.1">gzip</span></strong><span class="koboSpan" id="kobo.2493.1"> to indicate that it will be serving </span><span class="No-Break"><span class="koboSpan" id="kobo.2494.1">gzipped content.</span></span></p>
<p><span class="koboSpan" id="kobo.2495.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.2496.1">Numeric flag</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2497.1">Default: (none)</span></span></p>
<p><span class="koboSpan" id="kobo.2498.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2499.1">memcached_gzip_flag 1;</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2500.1">Table 4.11: A list of directives for the Memcached module</span></p>
<p><span class="koboSpan" id="kobo.2501.1">Additionally, you will need to define a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2502.1">$memcached_key</span></strong><span class="koboSpan" id="kobo.2503.1"> variable that defines the key of the element that you are placing or fetching from the cache. </span><span class="koboSpan" id="kobo.2503.2">You may, for instance, use </span><strong class="source-inline"><span class="koboSpan" id="kobo.2504.1">set $memcached_key $uri</span></strong><span class="koboSpan" id="kobo.2505.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.2506.1">set $</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2507.1">memcached_key $uri?$args</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2508.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2509.1">Note that the NGINX Memcached module</span><a id="_idIndexMarker321"/><span class="koboSpan" id="kobo.2510.1"> is only able to retrieve data from the cache; it does not store the results of requests. </span><span class="koboSpan" id="kobo.2510.2">Storing data in the cache should be done by a server-side script. </span><span class="koboSpan" id="kobo.2510.3">You just need to make sure to employ the same key naming scheme in both your server-side scripts and the NGINX configuration. </span><span class="koboSpan" id="kobo.2510.4">As an example, we could decide to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.2511.1">memcached</span></strong><span class="koboSpan" id="kobo.2512.1"> to retrieve data from the cache before passing the request to a proxy, if the requested URI is not found (see </span><a href="B21787_06.xhtml#_idTextAnchor621"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.2513.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.2514.1">, for more details about the </span><span class="No-Break"><span class="koboSpan" id="kobo.2515.1">Proxy module):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2516.1">
server {
    server_name example.com;
    [...]
    location / {
        set $memcached_key $uri;
        memcached_pass 127.0.0.1:11211;
        error_page 404 @notcached;
    }
    location @notcached {
        internal;
        # if the file is not found, forward request to proxy
        proxy_pass 127.0.0.1:8080;
    }
}</span><a id="_idTextAnchor513"/><a id="_idTextAnchor514"/></pre> <h3><span class="koboSpan" id="kobo.2517.1">Image filter</span></h3>
<p><span class="koboSpan" id="kobo.2518.1">This module provides</span><a id="_idIndexMarker322"/><span class="koboSpan" id="kobo.2519.1"> image processing</span><a id="_idIndexMarker323"/><span class="koboSpan" id="kobo.2520.1"> functionalities through the </span><strong class="bold"><span class="koboSpan" id="kobo.2521.1">GD Graphics Library</span></strong><span class="koboSpan" id="kobo.2522.1"> (also known </span><span class="No-Break"><span class="koboSpan" id="kobo.2523.1">as </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2524.1">gdlib</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2525.1">).</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.2526.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2527.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.2528.1">NGINX build.</span></span></p>
<p><span class="koboSpan" id="kobo.2529.1">Make sure to employ the following directives on a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2530.1">location</span></strong><span class="koboSpan" id="kobo.2531.1"> block that filters image files only, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.2532.1">location ~* \.(png|jpg|gif|webp)$ { ... </span><span class="koboSpan" id="kobo.2532.2">}</span></strong><span class="koboSpan" id="kobo.2533.1">:</span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table012">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2534.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2535.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2536.1">image_filter</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2537.1">Context: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2538.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2539.1">Lets you apply a transformation on the image before sending it to the client. </span><span class="koboSpan" id="kobo.2539.2">There are five </span><span class="No-Break"><span class="koboSpan" id="kobo.2540.1">options available:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2541.1">off</span></strong><span class="koboSpan" id="kobo.2542.1">: Turns off previously </span><span class="No-Break"><span class="koboSpan" id="kobo.2543.1">set </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2544.1">image_filter</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2545.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2546.1">test</span></strong><span class="koboSpan" id="kobo.2547.1">: Makes sure that the requested document is an image file; returns a </span><strong class="source-inline"><span class="koboSpan" id="kobo.2548.1">415 Unsupported Media Type</span></strong><span class="koboSpan" id="kobo.2549.1"> HTTP error if the </span><span class="No-Break"><span class="koboSpan" id="kobo.2550.1">test fails.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2551.1">size</span></strong><span class="koboSpan" id="kobo.2552.1">: Composes a simple JSON response indicating information about the image, such as the size and type (for example; </span><strong class="source-inline"><span class="koboSpan" id="kobo.2553.1">{ "img": { "width":50, "height":50, "type":"png"}}</span></strong><span class="koboSpan" id="kobo.2554.1">). </span><span class="koboSpan" id="kobo.2554.2">If the file is invalid, a simple </span><strong class="source-inline"><span class="koboSpan" id="kobo.2555.1">{}</span></strong><span class="koboSpan" id="kobo.2556.1"> instance </span><span class="No-Break"><span class="koboSpan" id="kobo.2557.1">is returned.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2558.1">resize width height</span></strong><span class="koboSpan" id="kobo.2559.1">: Resizes the image to the </span><span class="No-Break"><span class="koboSpan" id="kobo.2560.1">specified dimensions.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2561.1">crop width height</span></strong><span class="koboSpan" id="kobo.2562.1">: Selects a portion of the image of the </span><span class="No-Break"><span class="koboSpan" id="kobo.2563.1">specified dimensions.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2564.1">rotate 90</span></strong><span class="koboSpan" id="kobo.2565.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.2566.1">180</span></strong><span class="koboSpan" id="kobo.2567.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.2568.1">270</span></strong><span class="koboSpan" id="kobo.2569.1">: Rotates the image by the specified angle (</span><span class="No-Break"><span class="koboSpan" id="kobo.2570.1">in degrees).</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.2571.1">Example: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2572.1">image_filter resize </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2573.1">200 100;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2574.1">image_filter_buffer</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2575.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2576.1">http</span></strong><span class="koboSpan" id="kobo.2577.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2578.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2579.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2580.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2581.1">Defines the maximum file size for images to </span><span class="No-Break"><span class="koboSpan" id="kobo.2582.1">be processed.</span></span></p>
<p><span class="koboSpan" id="kobo.2583.1">Default: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2584.1">image_filter_buffer 1m;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2585.1">image_filter_jpeg_quality</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2586.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2587.1">http</span></strong><span class="koboSpan" id="kobo.2588.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2589.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2590.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2591.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2592.1">Defines the quality of output </span><span class="No-Break"><span class="koboSpan" id="kobo.2593.1">JPEG images.</span></span></p>
<p><span class="koboSpan" id="kobo.2594.1">Default: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2595.1">image_filter_jpeg_quality 75;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2596.1">image_filter_webp_quality</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2597.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2598.1">http</span></strong><span class="koboSpan" id="kobo.2599.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2600.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2601.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2602.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2603.1">Defines the quality of output </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2604.1">webp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2605.1"> images.</span></span></p>
<p><span class="koboSpan" id="kobo.2606.1">Default: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2607.1">image_filter_webp_quality 80;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2608.1">image_filter_transparency</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2609.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2610.1">http</span></strong><span class="koboSpan" id="kobo.2611.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2612.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2613.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2614.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2615.1">By default, PNG and GIF images keep their existing transparency during operations you perform using the Image filter module. </span><span class="koboSpan" id="kobo.2615.2">If you set this directive to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2616.1">off</span></strong><span class="koboSpan" id="kobo.2617.1">, all existing transparency will be lost, but the image quality will </span><span class="No-Break"><span class="koboSpan" id="kobo.2618.1">be improved.</span></span></p>
<p><span class="koboSpan" id="kobo.2619.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2620.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2621.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2622.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2623.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2624.1">on</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2625.1">image_filter_sharpen</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2626.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2627.1">http</span></strong><span class="koboSpan" id="kobo.2628.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2629.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2630.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2631.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2632.1">Sharpens the image by a specified percentage (value may </span><span class="No-Break"><span class="koboSpan" id="kobo.2633.1">exceed 100).</span></span></p>
<p><span class="koboSpan" id="kobo.2634.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.2635.1">Numeric value</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2636.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2637.1">0</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2638.1">image_filter_interlace</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2639.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2640.1">http</span></strong><span class="koboSpan" id="kobo.2641.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2642.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2643.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2644.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2645.1">Enables interlacing of the output image. </span><span class="koboSpan" id="kobo.2645.2">If the output image is a JPG file, the image is generated in </span><em class="italic"><span class="koboSpan" id="kobo.2646.1">progressive </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.2647.1">JPEG</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.2648.1"> format.</span></span></p>
<p><span class="koboSpan" id="kobo.2649.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2650.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.2651.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2652.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2653.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2654.1">off</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.2655.1">Table 4.12: A list of directives for the Image filter module</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.2656.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2657.1">When it comes to JPG images, NGINX </span><a id="_idIndexMarker324"/><span class="koboSpan" id="kobo.2658.1">automatically strips off metadata (such as </span><strong class="bold"><span class="koboSpan" id="kobo.2659.1">EXIF</span></strong><span class="koboSpan" id="kobo.2660.1">) if it occupies more than five percent of the total space of </span><span class="No-Break"><span class="koboSpan" id="kobo.2661.1">the file.</span></span><a id="_idTextAnchor515"/><a id="_idTextAnchor516"/></p>
<h3><span class="koboSpan" id="kobo.2662.1">XSLT</span></h3>
<p><span class="koboSpan" id="kobo.2663.1">The NGINX XSLT module</span><a id="_idIndexMarker325"/><span class="koboSpan" id="kobo.2664.1"> allows you to apply an </span><strong class="bold"><span class="koboSpan" id="kobo.2665.1">Extensible Stylesheet Language Transformations</span></strong><span class="koboSpan" id="kobo.2666.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.2667.1">XSLT</span></strong><span class="koboSpan" id="kobo.2668.1">) transform on an XML file or response received from a backend server (proxy, FastCGI, and so on) before serving </span><span class="No-Break"><span class="koboSpan" id="kobo.2669.1">the client:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table013">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2670.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2671.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2672.1">xml_entities</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2673.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2674.1">http</span></strong><span class="koboSpan" id="kobo.2675.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2676.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2677.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2678.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2679.1">Specifies the </span><strong class="bold"><span class="koboSpan" id="kobo.2680.1">document type definition</span></strong><span class="koboSpan" id="kobo.2681.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.2682.1">DTD</span></strong><span class="koboSpan" id="kobo.2683.1">) file containing symbolic </span><span class="No-Break"><span class="koboSpan" id="kobo.2684.1">element definitions.</span></span></p>
<p><span class="koboSpan" id="kobo.2685.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.2686.1">File path</span></span></p>
<p><span class="koboSpan" id="kobo.2687.1">Example: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2688.1">xml_entities xml/entities.dtd;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2689.1">xslt_stylesheet</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2690.1">Context: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2691.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2692.1">Specifies the XSLT template file path with its parameters. </span><span class="koboSpan" id="kobo.2692.2">Variables may be inserted in </span><span class="No-Break"><span class="koboSpan" id="kobo.2693.1">the parameters.</span></span></p>
<p><span class="koboSpan" id="kobo.2694.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2695.1">xslt_stylesheet template [</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2696.1">param1] [param2...];</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2697.1">Example: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2698.1">xslt_stylesheet </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2699.1">xml/sch.xslt param=value;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2700.1">xslt_types</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2701.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2702.1">http</span></strong><span class="koboSpan" id="kobo.2703.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2704.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2705.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2706.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2707.1">Defines additional MIME types to which transforms may apply, other </span><span class="No-Break"><span class="koboSpan" id="kobo.2708.1">than </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2709.1">text/xml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2710.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.2711.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.2712.1">MIME type</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.2713.1">Example:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.2714.1">xslt_types   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2715.1">text/xml text/plain;</span></strong></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2716.1">xslt_types *;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2717.1">xslt_paramxslt_string_param</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2718.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2719.1">http</span></strong><span class="koboSpan" id="kobo.2720.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2721.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2722.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2723.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2724.1">Both directives allow defining parameters for XSLT stylesheets. </span><span class="koboSpan" id="kobo.2724.2">The difference lies in the way the specified value is interpreted: using </span><strong class="source-inline"><span class="koboSpan" id="kobo.2725.1">xslt_param</span></strong><span class="koboSpan" id="kobo.2726.1">, XPath expressions in the value are processed; </span><strong class="source-inline"><span class="koboSpan" id="kobo.2727.1">xslt_string_param</span></strong><span class="koboSpan" id="kobo.2728.1"> should be used for plain </span><span class="No-Break"><span class="koboSpan" id="kobo.2729.1">character strings.</span></span></p>
<p><span class="koboSpan" id="kobo.2730.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2731.1">xslt_param </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2732.1">key value;</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor517"/><span class="koboSpan" id="kobo.2733.1">Table 4.13: A list of directives for the XSLT module</span></p>
<h2 id="_idParaDest-107"><a id="_idTextAnchor518"/><span class="koboSpan" id="kobo.2734.1">About your visitors</span></h2>
<p><span class="koboSpan" id="kobo.2735.1">The following set of modules provides extra functionality that will help you find out more information about visitors, such as by parsing client request headers for browser name and version, assigning an identifier to requests presenting similarities, and </span><span class="No-Break"><span class="koboSpan" id="kobo.2736.1">so on.</span></span><a id="_idTextAnchor519"/></p>
<h3><a id="_idTextAnchor520"/><span class="koboSpan" id="kobo.2737.1">Browser</span></h3>
<p><span class="koboSpan" id="kobo.2738.1">The Browser module parses</span><a id="_idIndexMarker326"/><span class="koboSpan" id="kobo.2739.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2740.1">User-Agent</span></strong><span class="koboSpan" id="kobo.2741.1"> HTTP header of the client request in order to establish values for variables that can be employed later in the configuration. </span><span class="koboSpan" id="kobo.2741.2">The three variables produced are </span><span class="No-Break"><span class="koboSpan" id="kobo.2742.1">the following:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2743.1">$modern_browser</span></strong><span class="koboSpan" id="kobo.2744.1">: If the client browser is identified as being a modern web browser, the variable takes the value defined by the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2745.1">modern_browser_value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2746.1"> directive</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2747.1">$ancient_browser</span></strong><span class="koboSpan" id="kobo.2748.1">: If the client browser is identified as being an old web browser, the variable takes the value defined </span><span class="No-Break"><span class="koboSpan" id="kobo.2749.1">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2750.1">ancient_browser_value</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2751.1">$msie</span></strong><span class="koboSpan" id="kobo.2752.1">: This variable is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2753.1">1</span></strong><span class="koboSpan" id="kobo.2754.1"> if the client is using a Microsoft Internet </span><span class="No-Break"><span class="koboSpan" id="kobo.2755.1">Explorer browser</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.2756.1">To help NGINX recognize web browsers, distinguishing the old from the modern, you need to insert multiple occurrences of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2757.1">ancient_browser</span></strong><span class="koboSpan" id="kobo.2758.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2759.1">modern_browser</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2760.1"> directives:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2761.1">
modern_browser opera 10.0;</span></pre> <p><span class="koboSpan" id="kobo.2762.1">With this example, if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2763.1">User-Agent</span></strong><span class="koboSpan" id="kobo.2764.1"> HTTP header contains Opera 10.0, the client browser is </span><span class="No-Break"><span class="koboSpan" id="kobo.2765.1">considered</span></span><span class="No-Break"><a id="_idIndexMarker327"/></span><span class="No-Break"><span class="koboSpan" id="kobo.2766.1"> modern</span><a id="_idTextAnchor521"/><a id="_idTextAnchor522"/><span class="koboSpan" id="kobo.2767.1">.</span></span></p>
<h3><span class="koboSpan" id="kobo.2768.1">Map</span></h3>
<p><span class="koboSpan" id="kobo.2769.1">Just as with the Browser module, the Map module allows</span><a id="_idIndexMarker328"/><span class="koboSpan" id="kobo.2770.1"> you to create maps of values, depending on </span><span class="No-Break"><span class="koboSpan" id="kobo.2771.1">a variable:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2772.1">
map $uri $variable {
  /page.html  0;
  /contact.html  1;
  /index.html  2;
  default 0;
}
rewrite ^ /index.php?page=$variable;</span></pre> <p><span class="koboSpan" id="kobo.2773.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.2774.1">map</span></strong><span class="koboSpan" id="kobo.2775.1"> directive can only be inserted within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2776.1">http</span></strong><span class="koboSpan" id="kobo.2777.1"> block. </span><span class="koboSpan" id="kobo.2777.2">Following this example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2778.1">$variable</span></strong><span class="koboSpan" id="kobo.2779.1"> may have three different values. </span><span class="koboSpan" id="kobo.2779.2">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.2780.1">$uri</span></strong><span class="koboSpan" id="kobo.2781.1"> was set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2782.1">/page.html</span></strong><span class="koboSpan" id="kobo.2783.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2784.1">$variable</span></strong><span class="koboSpan" id="kobo.2785.1"> value is now defined as </span><strong class="source-inline"><span class="koboSpan" id="kobo.2786.1">0</span></strong><span class="koboSpan" id="kobo.2787.1">; if </span><strong class="source-inline"><span class="koboSpan" id="kobo.2788.1">$uri</span></strong><span class="koboSpan" id="kobo.2789.1"> was set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2790.1">/contact.html</span></strong><span class="koboSpan" id="kobo.2791.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2792.1">$variable</span></strong><span class="koboSpan" id="kobo.2793.1"> is now </span><strong class="source-inline"><span class="koboSpan" id="kobo.2794.1">1</span></strong><span class="koboSpan" id="kobo.2795.1">; if </span><strong class="source-inline"><span class="koboSpan" id="kobo.2796.1">$uri</span></strong><span class="koboSpan" id="kobo.2797.1"> was set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2798.1">/index.html</span></strong><span class="koboSpan" id="kobo.2799.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2800.1">$variable</span></strong><span class="koboSpan" id="kobo.2801.1"> value now equals </span><strong class="source-inline"><span class="koboSpan" id="kobo.2802.1">2</span></strong><span class="koboSpan" id="kobo.2803.1">. </span><span class="koboSpan" id="kobo.2803.2">For all other cases (</span><strong class="source-inline"><span class="koboSpan" id="kobo.2804.1">default</span></strong><span class="koboSpan" id="kobo.2805.1">), </span><strong class="source-inline"><span class="koboSpan" id="kobo.2806.1">$variable</span></strong><span class="koboSpan" id="kobo.2807.1"> is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2808.1">0</span></strong><span class="koboSpan" id="kobo.2809.1">. </span><span class="koboSpan" id="kobo.2809.2">The last instruction rewrites the URL accordingly. </span><span class="koboSpan" id="kobo.2809.3">Apart from </span><strong class="source-inline"><span class="koboSpan" id="kobo.2810.1">default</span></strong><span class="koboSpan" id="kobo.2811.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2812.1">map</span></strong><span class="koboSpan" id="kobo.2813.1"> directive accepts another special keyword: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2814.1">hostnames</span></strong><span class="koboSpan" id="kobo.2815.1">. </span><span class="koboSpan" id="kobo.2815.2">It allows you to match hostnames using wildcards such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.2816.1">*.domain.com</span></strong><span class="koboSpan" id="kobo.2817.1">. </span><span class="koboSpan" id="kobo.2817.2">Finally, it’s possible to mark a map as </span><strong class="source-inline"><span class="koboSpan" id="kobo.2818.1">volatile</span></strong><span class="koboSpan" id="kobo.2819.1">, which makes the </span><span class="No-Break"><span class="koboSpan" id="kobo.2820.1">map non-cacheable.</span></span></p>
<p><span class="koboSpan" id="kobo.2821.1">Two additional directives allow you to tweak the way NGINX manages the mechanism </span><span class="No-Break"><span class="koboSpan" id="kobo.2822.1">in memory:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2823.1">map_hash_max_size</span></strong><span class="koboSpan" id="kobo.2824.1">: Sets the maximum size of the hash table holding </span><span class="No-Break"><span class="koboSpan" id="kobo.2825.1">a map</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2826.1">map_hash_bucket_size</span></strong><span class="koboSpan" id="kobo.2827.1">: The maximum size of an entry in </span><span class="No-Break"><span class="koboSpan" id="kobo.2828.1">the map</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.2829.1">Regular expressions may also be used</span><a id="_idIndexMarker329"/><span class="koboSpan" id="kobo.2830.1"> in patterns if you prefix them with </span><strong class="source-inline"><span class="koboSpan" id="kobo.2831.1">~</span></strong><span class="koboSpan" id="kobo.2832.1"> (case-sensitive) or </span><strong class="source-inline"><span class="koboSpan" id="kobo.2833.1">~*</span></strong><span class="koboSpan" id="kobo.2834.1"> (</span><span class="No-Break"><span class="koboSpan" id="kobo.2835.1">case-insensitive):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2836.1">
map $http_referer $ref {
~google "Google";
    ~* yahoo "Yahoo";
    \~bing "Bing"; # not a regular expression due to the \ before the tilde
default $http_referer; # variables may be used</span><a id="_idTextAnchor523"/><a id="_idTextAnchor524"/><span class="koboSpan" id="kobo.2837.1">
}</span></pre> <h3><span class="koboSpan" id="kobo.2838.1">Geo</span></h3>
<p><span class="koboSpan" id="kobo.2839.1">The purpose of this module</span><a id="_idIndexMarker330"/><span class="koboSpan" id="kobo.2840.1"> is to provide functionality that is quite similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2841.1">map</span></strong><span class="koboSpan" id="kobo.2842.1"> directive, affecting a variable based on client data (in this case, the IP address). </span><span class="koboSpan" id="kobo.2842.2">The syntax is slightly different, in the extent that you are allowed to specify IPv4 and IPv6 address ranges (in </span><span class="No-Break"><span class="koboSpan" id="kobo.2843.1">CIDR format):</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2844.1">
geo $variable {
  default unknown;
  127.0.0.1   local;
  123.12.3.0/24  uk;
  92.43.0.0/16  fr;
}</span></pre> <p><span class="koboSpan" id="kobo.2845.1">Note that the preceding block is being presented to you just for the sake of the example and does not actually detect UK and French visitors; you’ll want to use the GeoIP module if you wish to achieve proper geographical location detection. </span><span class="koboSpan" id="kobo.2845.2">In this block, you may insert a number of directives that are specific to </span><span class="No-Break"><span class="koboSpan" id="kobo.2846.1">this module:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2847.1">delete</span></strong><span class="koboSpan" id="kobo.2848.1">: Allows you to remove the specified subnetwork from </span><span class="No-Break"><span class="koboSpan" id="kobo.2849.1">the mapping.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2850.1">default</span></strong><span class="koboSpan" id="kobo.2851.1">: The default value given to </span><strong class="source-inline"><span class="koboSpan" id="kobo.2852.1">$variable</span></strong><span class="koboSpan" id="kobo.2853.1"> in case the user’s IP address does not match any of the specified </span><span class="No-Break"><span class="koboSpan" id="kobo.2854.1">IP ranges.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2855.1">include</span></strong><span class="koboSpan" id="kobo.2856.1">: Allows you to include an </span><span class="No-Break"><span class="koboSpan" id="kobo.2857.1">external file.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2858.1">proxy</span></strong><span class="koboSpan" id="kobo.2859.1">: Defines a subnet of trusted addresses. </span><span class="koboSpan" id="kobo.2859.2">If the user IP address is among those trusted, the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2860.1">X-Forwarded-For</span></strong><span class="koboSpan" id="kobo.2861.1"> header is used as the IP address instead of the socket </span><span class="No-Break"><span class="koboSpan" id="kobo.2862.1">IP address.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2863.1">proxy_recursive</span></strong><span class="koboSpan" id="kobo.2864.1">: If enabled, this will look for the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2865.1">X-Forwarded-For</span></strong><span class="koboSpan" id="kobo.2866.1"> header, even if the client IP address is </span><span class="No-Break"><span class="koboSpan" id="kobo.2867.1">not trusted.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2868.1">ranges</span></strong><span class="koboSpan" id="kobo.2869.1">: If you insert this directive as the first line of your </span><strong class="source-inline"><span class="koboSpan" id="kobo.2870.1">geo</span></strong><span class="koboSpan" id="kobo.2871.1"> block, it allows you to specify IP ranges</span><a id="_idIndexMarker331"/><span class="koboSpan" id="kobo.2872.1"> instead of CIDR masks. </span><span class="koboSpan" id="kobo.2872.2">The following syntax is thus permitted: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2873.1">127.0.0.1-127.0.0.255 LO</span><a id="_idTextAnchor525"/><a id="_idTextAnchor526"/><span class="koboSpan" id="kobo.2874.1">CAL;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2875.1">.</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.2876.1">GeoIP</span></h3>
<p><span class="koboSpan" id="kobo.2877.1">Although the name suggests</span><a id="_idIndexMarker332"/><span class="koboSpan" id="kobo.2878.1"> some similarities with the previous one, this optional module provides accurate geographical information</span><a id="_idIndexMarker333"/><span class="koboSpan" id="kobo.2879.1"> about your visitors by making use of </span><em class="italic"><span class="koboSpan" id="kobo.2880.1">MaxMind</span></em><span class="koboSpan" id="kobo.2881.1"> (</span><a href="https://www.maxmind.com/en/home"><span class="koboSpan" id="kobo.2882.1">https://www.maxmind.com/en/home</span></a><span class="koboSpan" id="kobo.2883.1">) GeoIP binary databases. </span><span class="koboSpan" id="kobo.2883.2">You need to download the database files from the </span><em class="italic"><span class="koboSpan" id="kobo.2884.1">MaxMind</span></em><span class="koboSpan" id="kobo.2885.1"> website and place them in your </span><span class="No-Break"><span class="koboSpan" id="kobo.2886.1">NGINX directory.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.2887.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2888.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.2889.1">NGINX build.</span></span></p>
<p><span class="koboSpan" id="kobo.2890.1">Then, all you have to do is specify the database path with </span><span class="No-Break"><span class="koboSpan" id="kobo.2891.1">either directive:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.2892.1">
geoip_country country.dat; # country information db
geoip_city city.dat; # city information db
geoip_org geoiporg.dat; # ISP/organization db</span></pre> <p><span class="koboSpan" id="kobo.2893.1">The first directive enables several variables: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2894.1">$geoip_country_code</span></strong><span class="koboSpan" id="kobo.2895.1"> (two-letter country code), </span><strong class="source-inline"><span class="koboSpan" id="kobo.2896.1">$geoip_country_code3</span></strong><span class="koboSpan" id="kobo.2897.1"> (three-letter country code), and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2898.1">$geoip_country_name</span></strong><span class="koboSpan" id="kobo.2899.1"> (full country name). </span><span class="koboSpan" id="kobo.2899.2">The second directive includes the same variables but provides additional information: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2900.1">$geoip_region</span></strong><span class="koboSpan" id="kobo.2901.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2902.1">$geoip_city</span></strong><span class="koboSpan" id="kobo.2903.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2904.1">$geoip_postal_code</span></strong><span class="koboSpan" id="kobo.2905.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2906.1">$geoip_city_continent_code</span></strong><span class="koboSpan" id="kobo.2907.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2908.1">$geoip_latitude</span></strong><span class="koboSpan" id="kobo.2909.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2910.1">$geoip_longitude</span></strong><span class="koboSpan" id="kobo.2911.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2912.1">$geoip_dma_code</span></strong><span class="koboSpan" id="kobo.2913.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.2914.1">$geoip_area_code</span></strong><span class="koboSpan" id="kobo.2915.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2916.1">$geoip_region_name</span></strong><span class="koboSpan" id="kobo.2917.1">. </span><span class="koboSpan" id="kobo.2917.2">The third directive offers information about the organization or ISP that owns the specified IP </span><a id="_idIndexMarker334"/><span class="koboSpan" id="kobo.2918.1">address, by filling up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2919.1">$</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2920.1">geoip_org</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2921.1"> variable.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.2922.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.2923.1">If you need the variables to be encoded in UTF-8, simply add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2924.1">utf8</span></strong><span class="koboSpan" id="kobo.2925.1"> keyword at the end of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2926.1">geoip_</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2927.1"> dir</span><a id="_idTextAnchor527"/><a id="_idTextAnchor528"/><span class="koboSpan" id="kobo.2928.1">ectives.</span></span></p>
<h3><span class="koboSpan" id="kobo.2929.1">UserID filter</span></h3>
<p><span class="koboSpan" id="kobo.2930.1">This module assigns</span><a id="_idIndexMarker335"/><span class="koboSpan" id="kobo.2931.1"> an identifier to clients by issuing cookies. </span><span class="koboSpan" id="kobo.2931.2">The identifier can be accessed from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.2932.1">$uid_got</span></strong><span class="koboSpan" id="kobo.2933.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.2934.1">$uid_set</span></strong><span class="koboSpan" id="kobo.2935.1"> variables further in </span><span class="No-Break"><span class="koboSpan" id="kobo.2936.1">the configuration:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table014">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2937.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.2938.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2939.1">userid</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2940.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2941.1">http</span></strong><span class="koboSpan" id="kobo.2942.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2943.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2944.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2945.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2946.1">Enables or disables issuing and logging </span><span class="No-Break"><span class="koboSpan" id="kobo.2947.1">of cookies.</span></span></p>
<p><span class="koboSpan" id="kobo.2948.1">The directive accepts four </span><span class="No-Break"><span class="koboSpan" id="kobo.2949.1">possible values:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2950.1">on</span></strong><span class="koboSpan" id="kobo.2951.1">: Enables v2 cookies and </span><span class="No-Break"><span class="koboSpan" id="kobo.2952.1">logs them</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2953.1">v1</span></strong><span class="koboSpan" id="kobo.2954.1">: Enables v1 cookies and </span><span class="No-Break"><span class="koboSpan" id="kobo.2955.1">logs them</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2956.1">log</span></strong><span class="koboSpan" id="kobo.2957.1">: Does not send cookie data but logs </span><span class="No-Break"><span class="koboSpan" id="kobo.2958.1">incoming cookies</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.2959.1">off</span></strong><span class="koboSpan" id="kobo.2960.1">: Does not send </span><span class="No-Break"><span class="koboSpan" id="kobo.2961.1">cookie data</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.2962.1">Default value: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2963.1">userid off;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2964.1">userid_service</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2965.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2966.1">http</span></strong><span class="koboSpan" id="kobo.2967.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2968.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2969.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2970.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2971.1">Defines the IP address of the server issuing </span><span class="No-Break"><span class="koboSpan" id="kobo.2972.1">the cookie.</span></span></p>
<p><span class="koboSpan" id="kobo.2973.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2974.1">userid_service ip;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2975.1">Default: IP address of </span><span class="No-Break"><span class="koboSpan" id="kobo.2976.1">the server</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2977.1">userid_name</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2978.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2979.1">http</span></strong><span class="koboSpan" id="kobo.2980.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2981.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2982.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2983.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2984.1">Defines the name assigned to </span><span class="No-Break"><span class="koboSpan" id="kobo.2985.1">the cookie.</span></span></p>
<p><span class="koboSpan" id="kobo.2986.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2987.1">userid_name name;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2988.1">Default value: The </span><span class="No-Break"><span class="koboSpan" id="kobo.2989.1">user identifier</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2990.1">userid_domain</span></strong></span></p>
<p><span class="koboSpan" id="kobo.2991.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.2992.1">http</span></strong><span class="koboSpan" id="kobo.2993.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2994.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.2995.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.2996.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.2997.1">Defines the domain assigned to </span><span class="No-Break"><span class="koboSpan" id="kobo.2998.1">the cookie.</span></span></p>
<p><span class="koboSpan" id="kobo.2999.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3000.1">userid_domain domain;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3001.1">Default value: None (the domain part is </span><span class="No-Break"><span class="koboSpan" id="kobo.3002.1">not sent)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3003.1">userid_path</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3004.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3005.1">http</span></strong><span class="koboSpan" id="kobo.3006.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3007.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3008.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3009.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3010.1">Defines the path part of </span><span class="No-Break"><span class="koboSpan" id="kobo.3011.1">the cookie.</span></span></p>
<p><span class="koboSpan" id="kobo.3012.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3013.1">userid_path path;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3014.1">Default </span><span class="No-Break"><span class="koboSpan" id="kobo.3015.1">value: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3016.1">/</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3017.1">userid_expires</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3018.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3019.1">http</span></strong><span class="koboSpan" id="kobo.3020.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3021.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3022.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3023.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3024.1">Defines the cookie </span><span class="No-Break"><span class="koboSpan" id="kobo.3025.1">expiration date.</span></span></p>
<p><span class="koboSpan" id="kobo.3026.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3027.1">userid_expires date | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3028.1">max;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3029.1">Default value: No </span><span class="No-Break"><span class="koboSpan" id="kobo.3030.1">expiration date</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3031.1">userid_p3p</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3032.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3033.1">http</span></strong><span class="koboSpan" id="kobo.3034.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3035.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3036.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3037.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3038.1">Assigns a value to the </span><strong class="bold"><span class="koboSpan" id="kobo.3039.1">Platform for Privacy Preferences Project</span></strong><span class="koboSpan" id="kobo.3040.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.3041.1">P3P</span></strong><span class="koboSpan" id="kobo.3042.1">) header sent with </span><span class="No-Break"><span class="koboSpan" id="kobo.3043.1">the cookie.</span></span></p>
<p><span class="koboSpan" id="kobo.3044.1">Syntax: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3045.1">userid_p3p data;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3046.1">Default </span><span class="No-Break"><span class="koboSpan" id="kobo.3047.1">value: None</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor529"/><span class="koboSpan" id="kobo.3048.1">Table 4.14: A list of directives for the userid cookie identifier module</span></p>
<h3><a id="_idTextAnchor530"/><span class="koboSpan" id="kobo.3049.1">Referer</span></h3>
<p><span class="koboSpan" id="kobo.3050.1">A simple directive is introduced</span><a id="_idIndexMarker336"/><span class="koboSpan" id="kobo.3051.1"> by this module: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3052.1">valid_referers</span></strong><span class="koboSpan" id="kobo.3053.1">. </span><span class="koboSpan" id="kobo.3053.2">Its purpose is to check the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3054.1">Referer</span></strong><span class="koboSpan" id="kobo.3055.1"> HTTP header from the client request and to possibly deny access based on the value. </span><span class="koboSpan" id="kobo.3055.2">If the referrer is considered invalid, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3056.1">$invalid_referer</span></strong><span class="koboSpan" id="kobo.3057.1"> is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.3058.1">1</span></strong><span class="koboSpan" id="kobo.3059.1">. </span><span class="koboSpan" id="kobo.3059.2">In the list of valid referrers, you may employ three kinds </span><span class="No-Break"><span class="koboSpan" id="kobo.3060.1">of values:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.3061.1">None</span></strong><span class="koboSpan" id="kobo.3062.1">: The absence of a referrer is considered to be a </span><span class="No-Break"><span class="koboSpan" id="kobo.3063.1">valid referrer</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.3064.1">Blocked</span></strong><span class="koboSpan" id="kobo.3065.1">: A masked referrer (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.3066.1">XXXXX</span></strong><span class="koboSpan" id="kobo.3067.1">) is also </span><span class="No-Break"><span class="koboSpan" id="kobo.3068.1">considered valid</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.3069.1">A server name</span></strong><span class="koboSpan" id="kobo.3070.1">: The specified server name is considered to be a </span><span class="No-Break"><span class="koboSpan" id="kobo.3071.1">valid referrer</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.3072.1">Following the definition of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3073.1">$invalid_referer</span></strong><span class="koboSpan" id="kobo.3074.1"> variable, you may, for example, return an error code if the referrer was </span><span class="No-Break"><span class="koboSpan" id="kobo.3075.1">found invalid:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.3076.1">
valid_referers none blocked *.website.com *.google.com;
  if ($invalid_referer) {
  return 403;
}</span></pre> <p><span class="koboSpan" id="kobo.3077.1">Be aware that spoofing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3078.1">Referer</span></strong><span class="koboSpan" id="kobo.3079.1"> HTTP header is a very simple process, so checking the referer of client requests should not be used as a </span><span class="No-Break"><span class="koboSpan" id="kobo.3080.1">security measure.</span></span></p>
<p><span class="koboSpan" id="kobo.3081.1">Two more directives are offered by this module, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3082.1">referer_hash_bucket_size</span></strong><span class="koboSpan" id="kobo.3083.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.3084.1">referer_hash_max_size</span></strong><span class="koboSpan" id="kobo.3085.1">, respectively allowing you to define the bucket size and maximum size of valid referrers’ </span><span class="No-Break"><span class="koboSpan" id="kobo.3086.1">hash tables.</span></span><a id="_idTextAnchor531"/><a id="_idTextAnchor532"/></p>
<h3><span class="koboSpan" id="kobo.3087.1">Real IP</span></h3>
<p><span class="koboSpan" id="kobo.3088.1">This module provides one simple</span><a id="_idIndexMarker337"/><span class="koboSpan" id="kobo.3089.1"> feature: it replaces the client IP address with the one specified in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3090.1">X-Real-IP</span></strong><span class="koboSpan" id="kobo.3091.1"> HTTP header for clients that visit your website behind a proxy or for retrieving IP addresses from the proper header if NGINX is used as a backend server (it essentially has the same effect as Apache’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.3092.1">mod_rpaf</span></strong><span class="koboSpan" id="kobo.3093.1"> if you have experience with Apache). </span><span class="koboSpan" id="kobo.3093.2">To enable this feature, you need to insert the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3094.1">real_ip_header</span></strong><span class="koboSpan" id="kobo.3095.1"> directive that defines the HTTP header to be exploited: either </span><strong class="source-inline"><span class="koboSpan" id="kobo.3096.1">X-Real-IP</span></strong><span class="koboSpan" id="kobo.3097.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.3098.1">X-Forwarded-For</span></strong><span class="koboSpan" id="kobo.3099.1">. </span><span class="koboSpan" id="kobo.3099.2">The second step is to define trusted IP addresses; in other words, the clients that are allowed to make use of those headers. </span><span class="koboSpan" id="kobo.3099.3">This can be done thanks to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3100.1">set_real_ip_from</span></strong><span class="koboSpan" id="kobo.3101.1"> directive, which accepts both IP addresses and CIDR </span><span class="No-Break"><span class="koboSpan" id="kobo.3102.1">address ranges:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.3103.1">
real_ip_header X-Forwarded-For;
set_real_ip_from 192.168.0.0/16;
set_real_ip_from 127.0.0.1;
set_real_ip_from unix:; # trusts all UNIX-domain sockets</span></pre> <table class="No-Table-Style _idGenTablePara-1" id="table015">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.3104.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.3105.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3106.1">set_real_ip_from</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3107.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3108.1">http</span></strong><span class="koboSpan" id="kobo.3109.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3110.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3111.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3112.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3113.1">Sets the trusted addresses that will trigger the real IP header replacement. </span><span class="koboSpan" id="kobo.3113.2">Set this to the IP of the trusted reverse proxy (or proxies) in front </span><span class="No-Break"><span class="koboSpan" id="kobo.3114.1">of NGINX.</span></span></p>
<p><span class="koboSpan" id="kobo.3115.1">This directive can be specified multiple times, and hostnames </span><span class="No-Break"><span class="koboSpan" id="kobo.3116.1">are allowed.</span></span></p>
<p><span class="koboSpan" id="kobo.3117.1">The special value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.3118.1">unix:</span></strong><span class="koboSpan" id="kobo.3119.1"> sets all Unix sockets </span><span class="No-Break"><span class="koboSpan" id="kobo.3120.1">as trusted.</span></span></p>
<p><span class="koboSpan" id="kobo.3121.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3122.1">set_real_ip_from address | CIDR | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3123.1">unix:;</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3124.1">Default: None</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3125.1">real_ip_header</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3126.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3127.1">http</span></strong><span class="koboSpan" id="kobo.3128.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3129.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3130.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3131.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3132.1">Sets the header field that will be used as a replacement for the </span><span class="No-Break"><span class="koboSpan" id="kobo.3133.1">IP address.</span></span></p>
<p><span class="koboSpan" id="kobo.3134.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.3135.1">proxy_protocol</span></strong><span class="koboSpan" id="kobo.3136.1"> special value changes the IP to the one from the </span><span class="No-Break"><span class="koboSpan" id="kobo.3137.1">Proxy protocol.</span></span></p>
<p><span class="koboSpan" id="kobo.3138.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3139.1">real_ip_header field | X-Real-Ip | X-Forwarded-For | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3140.1">proxy_protocol;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3141.1">Default:  </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3142.1">X-Real-Ip</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3143.1">real_ip_recursive</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3144.1">Context: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3145.1">http</span></strong><span class="koboSpan" id="kobo.3146.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3147.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3148.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3149.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3150.1">If set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.3151.1">on</span></strong><span class="koboSpan" id="kobo.3152.1">, the replacement IP will be set to the last non-trusted IP in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3153.1">real_ip_header</span></strong><span class="koboSpan" id="kobo.3154.1"> field. </span><span class="koboSpan" id="kobo.3154.2">If set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.3155.1">off</span></strong><span class="koboSpan" id="kobo.3156.1">, will be replaced with the last IP in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3157.1">real_ip_header</span></strong><span class="koboSpan" id="kobo.3158.1"> field, whether trusted </span><span class="No-Break"><span class="koboSpan" id="kobo.3159.1">or not.</span></span></p>
<p><span class="koboSpan" id="kobo.3160.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3161.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.3162.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3163.1">off</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3164.1">Default:  </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3165.1">off</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.3166.1">Table 4.15: A list of directives for the real_ip module</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.3167.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.3168.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.3169.1">NGINX build.</span></span></p>
<h2 id="_idParaDest-108"><a id="_idTextAnchor533"/><a id="_idTextAnchor534"/><a id="_idTextAnchor535"/><span class="koboSpan" id="kobo.3170.1">SSL and security</span></h2>
<p><span class="koboSpan" id="kobo.3171.1">NGINX provides secure HTTP functionalities through the SSL module, but also offers an extra module, called </span><strong class="bold"><span class="koboSpan" id="kobo.3172.1">Secure Link</span></strong><span class="koboSpan" id="kobo.3173.1">, that helps you protect your website</span><a id="_idIndexMarker338"/><span class="koboSpan" id="kobo.3174.1"> and visitors in a totally </span><span class="No-Break"><span class="koboSpan" id="kobo.3175.1">different way</span><a id="_idTextAnchor536"/><span class="koboSpan" id="kobo.3176.1">.</span></span><a id="_idTextAnchor537"/></p>
<h3><span class="koboSpan" id="kobo.3177.1">SSL</span></h3>
<p><span class="koboSpan" id="kobo.3178.1">The SSL module enables HTTPS</span><a id="_idIndexMarker339"/><span class="koboSpan" id="kobo.3179.1"> support, HTTP over SSL/TLS in particular. </span><span class="koboSpan" id="kobo.3179.2">It gives you the possibility to serve secure websites by providing a certificate, a certificate key, and other parameters, defined with the </span><span class="No-Break"><span class="koboSpan" id="kobo.3180.1">following directives:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table016">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.3181.1">Directive</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.3182.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3183.1">ssl</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3184.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3185.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3186.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3187.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3188.1">Enables HTTPS for the specified server. </span><span class="koboSpan" id="kobo.3188.2">This directive is the equivalent of </span><strong class="source-inline"><span class="koboSpan" id="kobo.3189.1">listen 443 ssl</span></strong><span class="koboSpan" id="kobo.3190.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.3191.1">listen port ssl</span></strong><span class="koboSpan" id="kobo.3192.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.3193.1">more generally.</span></span></p>
<p><span class="koboSpan" id="kobo.3194.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3195.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.3196.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3197.1">off</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3198.1">Default: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3199.1">ssl off;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3200.1">ssl_certificate</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3201.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3202.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3203.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3204.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3205.1">Sets the path of the </span><strong class="bold"><span class="koboSpan" id="kobo.3206.1">Privacy Enhanced Mail</span></strong><span class="koboSpan" id="kobo.3207.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.3208.1">PEM</span></strong><span class="koboSpan" id="kobo.3209.1">) certificate. </span><span class="koboSpan" id="kobo.3209.2">This directive can be specified multiple times to load certificates of </span><span class="No-Break"><span class="koboSpan" id="kobo.3210.1">different types.</span></span></p>
<p><span class="koboSpan" id="kobo.3211.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.3212.1">File path</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3213.1">ssl_certificate_key</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3214.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3215.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3216.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3217.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3218.1">Sets the path of the PEM secret </span><span class="No-Break"><span class="koboSpan" id="kobo.3219.1">key file.</span></span></p>
<p><span class="koboSpan" id="kobo.3220.1">This directive can be specified multiple times to load certificates of </span><span class="No-Break"><span class="koboSpan" id="kobo.3221.1">different types.</span></span></p>
<p><span class="koboSpan" id="kobo.3222.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.3223.1">File path</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3224.1">ssl_client_certificate</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3225.1">Context: </span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3226.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3227.1">, </span></span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3228.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3229.1">Sets the path of the client </span><span class="No-Break"><span class="koboSpan" id="kobo.3230.1">PEM certificate.</span></span></p>
<p><span class="koboSpan" id="kobo.3231.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.3232.1">File path</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3233.1">ssl_crl</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3234.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3235.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3236.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3237.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3238.1">Orders NGINX to load a </span><strong class="bold"><span class="koboSpan" id="kobo.3239.1">Certificate Revocation List</span></strong><span class="koboSpan" id="kobo.3240.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.3241.1">CRL</span></strong><span class="koboSpan" id="kobo.3242.1">) file, which allows checking the revocation status of certificates when using TLS </span><span class="No-Break"><span class="koboSpan" id="kobo.3243.1">mutual authentication.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3244.1">ssl_dhparam</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3245.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3246.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3247.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3248.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3249.1">Sets the path of the </span><strong class="bold"><span class="koboSpan" id="kobo.3250.1">Diffie-Hellman</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.3251.1">parameters file.</span></span></p>
<p><span class="koboSpan" id="kobo.3252.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.3253.1">File path</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3254.1">ssl_protocols</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3255.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3256.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3257.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3258.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3259.1">Specifies the protocol that should </span><span class="No-Break"><span class="koboSpan" id="kobo.3260.1">be employed.</span></span></p>
<p><span class="koboSpan" id="kobo.3261.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3262.1">ssl_protocols [SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3263.1">TLSv1.2] [TLSv1.3];</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3264.1">Default: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3265.1">ssl_protocols TLSv1 TLSv1.1 </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3266.1">TLSv1.2 TLSv1.3;</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3267.1">ssl_ciphers</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3268.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3269.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3270.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3271.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3272.1">Specifies the ciphers that should be employed. </span><span class="koboSpan" id="kobo.3272.2">A list of available ciphers can be obtained by running the following command from the shell: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3273.1">openssl ciphers</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3274.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.3275.1">Syntax: </span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3276.1">ssl_ciphers cipher1[:cipher2...];</span></strong></span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.3277.1">Recommended</span></em><span class="koboSpan" id="kobo.3278.1">: Please visit </span><a href="http://ssl-config.mozilla.org"><span class="koboSpan" id="kobo.3279.1">ssl-config.mozilla.org</span></a><span class="koboSpan" id="kobo.3280.1"> for the default ciphers </span><span class="No-Break"><span class="koboSpan" id="kobo.3281.1">to use.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3282.1">ssl_prefer_server_ciphers</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3283.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3284.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3285.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3286.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3287.1">Specifies whether server ciphers should be preferred over </span><span class="No-Break"><span class="koboSpan" id="kobo.3288.1">client ciphers.</span></span></p>
<p><span class="koboSpan" id="kobo.3289.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3290.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.3291.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3292.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3293.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3294.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3295.1">ssl_verify_client</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3296.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3297.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3298.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3299.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3300.1">Enables verifying certificates transmitted by the client and sets the result in </span><strong class="source-inline"><span class="koboSpan" id="kobo.3301.1">$ssl_client_verify</span></strong><span class="koboSpan" id="kobo.3302.1">. </span><span class="koboSpan" id="kobo.3302.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.3303.1">optional_no_ca</span></strong><span class="koboSpan" id="kobo.3304.1"> value verifies the certificate if there is one, but does not require it to be signed by a trusted </span><strong class="bold"><span class="koboSpan" id="kobo.3305.1">certificate authority</span></strong><span class="koboSpan" id="kobo.3306.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.3307.1">CA</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3308.1">) certificate.</span></span></p>
<p><span class="koboSpan" id="kobo.3309.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3310.1">on | off | optional | </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3311.1">optional_no_ca</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3312.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3313.1">off</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3314.1">ssl_verify_depth</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3315.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3316.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3317.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3318.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3319.1">Specifies the verification depth of the client </span><span class="No-Break"><span class="koboSpan" id="kobo.3320.1">certificate chain.</span></span></p>
<p><span class="koboSpan" id="kobo.3321.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.3322.1">Numeric value</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3323.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3324.1">1</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3325.1">ssl_session_cache</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3326.1">Context: </span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3327.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3328.1">, </span></span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3329.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3330.1">Configures the cache for </span><span class="No-Break"><span class="koboSpan" id="kobo.3331.1">SSL sessions.</span></span></p>
<p><span class="koboSpan" id="kobo.3332.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3333.1">off</span></strong><span class="koboSpan" id="kobo.3334.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3335.1">none</span></strong><span class="koboSpan" id="kobo.3336.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3337.1">builtin:size</span></strong><span class="koboSpan" id="kobo.3338.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.3339.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3340.1">shared:name:size</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3341.1">Default: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3342.1">off</span></strong><span class="koboSpan" id="kobo.3343.1"> (disables </span><span class="No-Break"><span class="koboSpan" id="kobo.3344.1">SSL sessions)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3345.1">ssl_session_timeout</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3346.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3347.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3348.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3349.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3350.1">When SSL sessions are enabled, this directive defines the timeout for using </span><span class="No-Break"><span class="koboSpan" id="kobo.3351.1">session data.</span></span></p>
<p><span class="koboSpan" id="kobo.3352.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.3353.1">Time value</span></span></p>
<p><span class="koboSpan" id="kobo.3354.1">Default: </span><span class="No-Break"><span class="koboSpan" id="kobo.3355.1">5 minutes</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3356.1">ssl_password_phrase</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3357.1">Context: </span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3358.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3359.1">, </span></span><span class="No-Break"><strong class="source-inline" lang="fr-FR" xml:lang="fr-FR"><span class="koboSpan" id="kobo.3360.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3361.1">Specifies a file containing passphrases for secret keys. </span><span class="koboSpan" id="kobo.3361.2">Each passphrase is specified on a separate line; they are tried one after the other when loading a </span><span class="No-Break"><span class="koboSpan" id="kobo.3362.1">certificate key.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3363.1">Syntax: Filename</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3364.1">Default: (none)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3365.1">ssl_buffer_size</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3366.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3367.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3368.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3369.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3370.1">Specifies buffer size when serving requests </span><span class="No-Break"><span class="koboSpan" id="kobo.3371.1">over SSL.</span></span></p>
<p><span class="koboSpan" id="kobo.3372.1">Syntax: </span><span class="No-Break"><span class="koboSpan" id="kobo.3373.1">Size value</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3374.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3375.1">16k</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3376.1">ssl_session_tickets</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3377.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3378.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3379.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3380.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3381.1">Enables TLS session tickets, allowing for the client to reconnect faster, </span><span class="No-Break"><span class="koboSpan" id="kobo.3382.1">skipping renegotiation.</span></span></p>
<p><span class="koboSpan" id="kobo.3383.1">Syntax: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3384.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.3385.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3386.1">off</span></strong></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3387.1">Default: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3388.1">on</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3389.1">ssl_session_ticket_key</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3390.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3391.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3392.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3393.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3394.1">Sets the path of the key file used to encrypt and decrypt TLS session tickets. </span><span class="koboSpan" id="kobo.3394.2">By default, a random value </span><span class="No-Break"><span class="koboSpan" id="kobo.3395.1">is generated.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3396.1">Syntax: Filename</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3397.1">Default: (none)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3398.1">ssl_trusted_certificate</span></strong></span></p>
<p><span class="koboSpan" id="kobo.3399.1">Context: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3400.1">http</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3401.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3402.1">server</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.3403.1">Sets the path of a trusted certificate file (PEM format), used to validate the authenticity of client certificates, as well as stapling of </span><strong class="bold"><span class="koboSpan" id="kobo.3404.1">Online Certificate Status Protocol</span></strong><span class="koboSpan" id="kobo.3405.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.3406.1">OCSP</span></strong><span class="koboSpan" id="kobo.3407.1">) responses. </span><span class="koboSpan" id="kobo.3407.2">More about SSL stapling can be found in the </span><span class="No-Break"><span class="koboSpan" id="kobo.3408.1">next section.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3409.1">Syntax: Filename</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.3410.1">Default: (none)</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.3411.1">Table 4.16: A list of directives for the SSL module</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.3412.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.3413.1">This module is not included in the default </span><span class="No-Break"><span class="koboSpan" id="kobo.3414.1">NGINX build.</span></span></p>
<p><span class="koboSpan" id="kobo.3415.1">Additionally, the following variables are </span><span class="No-Break"><span class="koboSpan" id="kobo.3416.1">made available:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3417.1">$ssl_cipher</span></strong><span class="koboSpan" id="kobo.3418.1">: Indicates the cipher used for the </span><span class="No-Break"><span class="koboSpan" id="kobo.3419.1">current request</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3420.1">$ssl_ciphers</span></strong><span class="koboSpan" id="kobo.3421.1">: Returns a list of </span><span class="No-Break"><span class="koboSpan" id="kobo.3422.1">client-supported ciphers</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3423.1">$ssl_curves</span></strong><span class="koboSpan" id="kobo.3424.1">: Returns a list of client-supported curves for </span><span class="No-Break"><span class="koboSpan" id="kobo.3425.1">Elliptic Curves/EC/ECDH</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3426.1">$ssl_client_serial</span></strong><span class="koboSpan" id="kobo.3427.1">: Indicates the serial number of the </span><span class="No-Break"><span class="koboSpan" id="kobo.3428.1">client certificate</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3429.1">$ssl_client_s_dn</span></strong><span class="koboSpan" id="kobo.3430.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.3431.1">$ssl_client_i_dn</span></strong><span class="koboSpan" id="kobo.3432.1">: Indicates</span><a id="_idIndexMarker340"/><span class="koboSpan" id="kobo.3433.1"> the value of the subject and issuer </span><strong class="bold"><span class="koboSpan" id="kobo.3434.1">Distinguished Name</span></strong><span class="koboSpan" id="kobo.3435.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.3436.1">DN</span></strong><span class="koboSpan" id="kobo.3437.1">) of the </span><span class="No-Break"><span class="koboSpan" id="kobo.3438.1">client certificate</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3439.1">$ssl_protocol</span></strong><span class="koboSpan" id="kobo.3440.1">: Indicates the protocol at use for the </span><span class="No-Break"><span class="koboSpan" id="kobo.3441.1">current request</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3442.1">$ssl_client_cert</span></strong><span class="koboSpan" id="kobo.3443.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.3444.1">$ssl_client_raw_cert</span></strong><span class="koboSpan" id="kobo.3445.1">: Returns client certificate data, which is raw data for the </span><span class="No-Break"><span class="koboSpan" id="kobo.3446.1">second variable</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3447.1">$ssl_client_verify</span></strong><span class="koboSpan" id="kobo.3448.1">: Set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.3449.1">SUCCESS</span></strong><span class="koboSpan" id="kobo.3450.1"> if the client certificate was </span><span class="No-Break"><span class="koboSpan" id="kobo.3451.1">successfully verified</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3452.1">$ssl_session_id</span></strong><span class="koboSpan" id="kobo.3453.1">: Allows you to retrieve the ID of an </span><span class="No-Break"><span class="koboSpan" id="kobo.3454.1">SSL session</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3455.1">$ssl_client_escaped_cert</span></strong><span class="koboSpan" id="kobo.3456.1">: Returns the client certificate</span><a id="_idIndexMarker341"/><span class="koboSpan" id="kobo.3457.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.3458.1">PEM form</span><a id="_idTextAnchor538"/><span class="koboSpan" id="kobo.3459.1">a</span><a id="_idTextAnchor539"/><span class="koboSpan" id="kobo.3460.1">t</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.3461.1">Setting up an SSL certificate</span></h3>
<p><span class="koboSpan" id="kobo.3462.1">Although the SSL module</span><a id="_idIndexMarker342"/><span class="koboSpan" id="kobo.3463.1"> offers a lot of possibilities, in most cases, only a couple of directives are actually useful for setting up a secure website. </span><span class="koboSpan" id="kobo.3463.2">This guide will help you configure NGINX to use an SSL certificate for your website (in the example, your website is identified by </span><strong class="source-inline"><span class="koboSpan" id="kobo.3464.1">secure.website.com</span></strong><span class="koboSpan" id="kobo.3465.1">). </span><span class="koboSpan" id="kobo.3465.2">Before doing so, ensure that you already have the following elements at </span><span class="No-Break"><span class="koboSpan" id="kobo.3466.1">your disposal:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.3467.1">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.3468.1">.key</span></strong><span class="koboSpan" id="kobo.3469.1"> file generated with the following command: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3470.1">openssl genrsa -out secure.website.com.key 2048</span></strong><span class="koboSpan" id="kobo.3471.1"> (other encryption levels </span><span class="No-Break"><span class="koboSpan" id="kobo.3472.1">work too)</span></span></li>
<li><span class="koboSpan" id="kobo.3473.1">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.3474.1">.csr</span></strong><span class="koboSpan" id="kobo.3475.1"> file generated with the following command: </span><strong class="source-inline"><span class="koboSpan" id="kobo.3476.1">openssl req -new -key secure.website.com.key -</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3477.1">out secure.website.com.csr</span></strong></span></li>
<li><span class="koboSpan" id="kobo.3478.1">Your website certificate file, as issued by the CA; for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3479.1">secure.website.com.crt</span></strong><span class="koboSpan" id="kobo.3480.1"> (in order to obtain a certificate from the CA, you will need to provide your </span><strong class="source-inline"><span class="koboSpan" id="kobo.3481.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3482.1">csr</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3483.1"> file)</span></span></li>
<li><span class="koboSpan" id="kobo.3484.1">The CA certificate file as issued by the CA (for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3485.1">gd_bundle.crt</span></strong><span class="koboSpan" id="kobo.3486.1">, if you purchased</span><a id="_idIndexMarker343"/><span class="koboSpan" id="kobo.3487.1"> your certificate </span><span class="No-Break"><span class="koboSpan" id="kobo.3488.1">from </span></span><a href="https://godaddy.com/"><span class="No-Break"><span class="koboSpan" id="kobo.3489.1">https://godaddy.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.3490.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.3491.1">The first step is to merge your website certificate and the CA certificate together with the </span><span class="No-Break"><span class="koboSpan" id="kobo.3492.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.3493.1">
cat secure.website.com.crt gd_bundle.crt &gt; combined.crt</span></pre> <p><span class="koboSpan" id="kobo.3494.1">You are then ready to configure</span><a id="_idIndexMarker344"/><span class="koboSpan" id="kobo.3495.1"> NGINX to serve </span><span class="No-Break"><span class="koboSpan" id="kobo.3496.1">secure content:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.3497.1">
server {
    listen 443;
    server_name secure.website.com;
    ssl on;
    ssl_certificate /path/to/combined.crt;
    ssl_certificate_key /path/to/secure.website.com.key;
    [...]</span><a id="_idTextAnchor540"/><a id="_idTextAnchor541"/><span class="koboSpan" id="kobo.3498.1">
}</span></pre> <h4><span class="koboSpan" id="kobo.3499.1">SSL stapling</span></h4>
<p><span class="koboSpan" id="kobo.3500.1">SSL stapling, also called OCSP stapling, is a technique</span><a id="_idIndexMarker345"/><span class="koboSpan" id="kobo.3501.1"> that allows</span><a id="_idIndexMarker346"/><span class="koboSpan" id="kobo.3502.1"> clients to easily connect and resume sessions to an SSL/TLS server without having to contact the CA, thus reducing SSL negotiation times. </span><span class="koboSpan" id="kobo.3502.2">In normal OCSP transactions, the client contacts the CA to check the revocation status of the server’s certificate. </span><span class="koboSpan" id="kobo.3502.3">In the case of high-traffic websites, this can cause huge stress on CA servers. </span><span class="koboSpan" id="kobo.3502.4">An intermediary solution was designed: stapling. </span><span class="koboSpan" id="kobo.3502.5">The OCSP record is obtained from the CA by your server itself periodically and </span><strong class="bold"><span class="koboSpan" id="kobo.3503.1">stapled</span></strong><span class="koboSpan" id="kobo.3504.1"> to exchanges with the client. </span><span class="koboSpan" id="kobo.3504.2">The OCSP record is cached by your server for a period of up to 48 hours in order to limit communications with </span><span class="No-Break"><span class="koboSpan" id="kobo.3505.1">the CA.</span></span></p>
<p><span class="koboSpan" id="kobo.3506.1">Enabling SSL stapling should</span><a id="_idIndexMarker347"/><span class="koboSpan" id="kobo.3507.1"> thus speed up communications between your visitors and your server. </span><span class="koboSpan" id="kobo.3507.2">Achieving this in NGINX is relatively simple—all you really need is to insert three directives in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.3508.1">server</span></strong><span class="koboSpan" id="kobo.3509.1"> block and obtain a fully trusted certificate chain file (containing both the root and intermediate certificates) from </span><span class="No-Break"><span class="koboSpan" id="kobo.3510.1">your CA:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3511.1">ssl_stapling on</span></strong><span class="koboSpan" id="kobo.3512.1">: Enables SSL stapling within the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3513.1">server</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3514.1"> block</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3515.1">ssl_stapling_verify on</span></strong><span class="koboSpan" id="kobo.3516.1">: Enables verification of OCSP responses by </span><span class="No-Break"><span class="koboSpan" id="kobo.3517.1">the server</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3518.1">ssl_trusted_certificate filename</span></strong><span class="koboSpan" id="kobo.3519.1">: Here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3520.1">filename</span></strong><span class="koboSpan" id="kobo.3521.1"> is the path of your full trusted certificate file (extension should </span><span class="No-Break"><span class="koboSpan" id="kobo.3522.1">be </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3523.1">.pem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3524.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.3525.1">Two optional directives also exist, allowing you to modify the behavior of </span><span class="No-Break"><span class="koboSpan" id="kobo.3526.1">this module:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3527.1">ssl_stapling_file filename</span></strong><span class="koboSpan" id="kobo.3528.1">: Here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3529.1">filename</span></strong><span class="koboSpan" id="kobo.3530.1"> is the path of a cached OCSP record, overriding the record provided by the OCSP responder specified in the </span><span class="No-Break"><span class="koboSpan" id="kobo.3531.1">certificate file</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.3532.1">ssl_stapling_responder url</span></strong><span class="koboSpan" id="kobo.3533.1">: Here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.3534.1">url</span></strong><span class="koboSpan" id="kobo.3535.1"> is the URL of your CA’s OCSP responder, overriding the URL specified in the </span><span class="No-Break"><span class="koboSpan" id="kobo.3536.1">certificate file</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.3537.1">If you are having issues connecting to the OCSP responder, make sure your NGINX configuration contains a valid DNS resolver using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3538.1">resolver</span></strong><span class="koboSpan" id="kobo.3539.1"> directive (a local DNS responder might </span><span class="No-Break"><span class="koboSpan" id="kobo.3540.1">hel</span><a id="_idTextAnchor542"/><a id="_idTextAnchor543"/><a id="_idTextAnchor544"/><span class="koboSpan" id="kobo.3541.1">p too).</span></span></p>
<h2 id="_idParaDest-109"><a id="_idTextAnchor545"/><span class="koboSpan" id="kobo.3542.1">Other miscellaneous and optional modules</span></h2>
<p><span class="koboSpan" id="kobo.3543.1">The remaining two modules (which all need to be enabled at compile time) are optional and provide additional </span><span class="No-Break"><span class="koboSpan" id="kobo.3544.1">advanced function</span><a id="_idTextAnchor546"/><span class="koboSpan" id="kobo.3545.1">a</span><a id="_idTextAnchor547"/><span class="koboSpan" id="kobo.3546.1">lities.</span></span></p>
<h3><span class="koboSpan" id="kobo.3547.1">Stub status</span></h3>
<p><span class="koboSpan" id="kobo.3548.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.3549.1">Stub status</span></strong><span class="koboSpan" id="kobo.3550.1"> module was designed to provide information</span><a id="_idIndexMarker348"/><span class="koboSpan" id="kobo.3551.1"> about the current state of the server, such as the number of active connections, total handled requests, and more. </span><span class="koboSpan" id="kobo.3551.2">To activate it, place the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3552.1">stub_status</span></strong><span class="koboSpan" id="kobo.3553.1"> directive in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.3554.1">location</span></strong><span class="koboSpan" id="kobo.3555.1"> block. </span><span class="koboSpan" id="kobo.3555.2">All requests matching the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3556.1">location</span></strong><span class="koboSpan" id="kobo.3557.1"> block will produce a </span><span class="No-Break"><span class="koboSpan" id="kobo.3558.1">status page:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.3559.1">
location = /nginx_status {
    stub_status on;
    allow 127.0.0.1; # you may want to protect the information
    deny all;
}</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.3560.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.3561.1">This module is not included in the default NGINX build. </span><span class="koboSpan" id="kobo.3561.2">Make sure to protect this page as it should not be used </span><span class="No-Break"><span class="koboSpan" id="kobo.3562.1">in production.</span></span></p>
<p><span class="koboSpan" id="kobo.3563.1">Here’s an example result produced </span><span class="No-Break"><span class="koboSpan" id="kobo.3564.1">by NGINX:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.3565.1">
Active connections: 1
server accepts handled requests
10 10 23
Reading: 0 Writing: 1 Waiting: 0</span></pre> <p><span class="koboSpan" id="kobo.3566.1">It’s interesting to note that there are several server monitoring solutions, such as </span><em class="italic"><span class="koboSpan" id="kobo.3567.1">netdata</span></em><span class="koboSpan" id="kobo.3568.1">, that offer NGINX support through the Stub status page by calling it at regular intervals and parsing </span><span class="No-Break"><span class="koboSpan" id="kobo.3569.1">the st</span><a id="_idTextAnchor548"/><span class="koboSpan" id="kobo.3570.1">a</span><a id="_idTextAnchor549"/><span class="koboSpan" id="kobo.3571.1">tistics.</span></span></p>
<h3><span class="koboSpan" id="kobo.3572.1">Degradation</span></h3>
<p><span class="koboSpan" id="kobo.3573.1">The HTTP Degradation module configures your server</span><a id="_idIndexMarker349"/><span class="koboSpan" id="kobo.3574.1"> to return an error page when your server runs low on memory. </span><span class="koboSpan" id="kobo.3574.2">It works by defining a memory amount that is to be considered low, and then specifying locations for which you wish to enable a </span><span class="No-Break"><span class="koboSpan" id="kobo.3575.1">degradation check:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.3576.1">
degradation sbrk=500m; # to be inserted at the http block level
degrade 204; # in a location block, specify the error code (204 or 444) to return in case the server condition has</span><a id="_idTextAnchor550"/><a id="_idTextAnchor551"/><a id="_idTextAnchor552"/><a id="_idTextAnchor553"/><span class="koboSpan" id="kobo.3577.1"> degraded</span></pre> <h3><span class="koboSpan" id="kobo.3578.1">Integrating a third-party module into your NGINX build</span></h3>
<p><span class="koboSpan" id="kobo.3579.1">The NGINX community</span><a id="_idIndexMarker350"/><span class="koboSpan" id="kobo.3580.1"> has been growing larger over the past</span><a id="_idIndexMarker351"/><span class="koboSpan" id="kobo.3581.1"> few years, and many additional modules have been written by third-party developers. </span><span class="koboSpan" id="kobo.3581.2">These can be downloaded</span><a id="_idIndexMarker352"/><span class="koboSpan" id="kobo.3582.1"> from the official wiki website at </span><a href="https://www.nginx.com/resources/wiki/modules/"><span class="koboSpan" id="kobo.3583.1">https://www.nginx.com/resources/wiki/modules/</span></a><span class="koboSpan" id="kobo.3584.1">. </span><span class="koboSpan" id="kobo.3584.2">However, we advise you to be careful when integrating these third-party modules as they do not come with security support or assurances from the NGINX development team, potentially introducing </span><span class="No-Break"><span class="koboSpan" id="kobo.3585.1">security vulnerabilities.</span></span></p>
<p><span class="koboSpan" id="kobo.3586.1">The currently available modules offer a wide range of new possibilities, among which are </span><span class="No-Break"><span class="koboSpan" id="kobo.3587.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.3588.1">An </span><em class="italic"><span class="koboSpan" id="kobo.3589.1">Access Key</span></em><span class="koboSpan" id="kobo.3590.1"> module to protect your documents in a similar fashion to Secure Link, by </span><span class="No-Break"><span class="koboSpan" id="kobo.3591.1">Mykola Grechukh</span></span></li>
<li><span class="koboSpan" id="kobo.3592.1">A </span><em class="italic"><span class="koboSpan" id="kobo.3593.1">Fancy Indexes</span></em><span class="koboSpan" id="kobo.3594.1"> module that improves the automatic directory listings generated by NGINX, by Adrian Perez </span><span class="No-Break"><span class="koboSpan" id="kobo.3595.1">de Castro</span></span></li>
<li><span class="koboSpan" id="kobo.3596.1">The </span><em class="italic"><span class="koboSpan" id="kobo.3597.1">Headers More</span></em><span class="koboSpan" id="kobo.3598.1"> module that improves flexibility with HTTP headers, by Yichun </span><span class="No-Break"><span class="koboSpan" id="kobo.3599.1">Zhang (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.3600.1">agentzh</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.3601.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.3602.1">Many more features for various parts of the </span><span class="No-Break"><span class="koboSpan" id="kobo.3603.1">web server</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.3604.1">To integrate a third-party module into your NGINX build, you need to follow these three </span><span class="No-Break"><span class="koboSpan" id="kobo.3605.1">simple steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.3606.1">Download the </span><strong class="source-inline"><span class="koboSpan" id="kobo.3607.1">.tar.gz</span></strong><span class="koboSpan" id="kobo.3608.1"> archive associated with the module you wish </span><span class="No-Break"><span class="koboSpan" id="kobo.3609.1">to download.</span></span></li>
<li><span class="koboSpan" id="kobo.3610.1">Extract the archive with the </span><span class="No-Break"><span class="koboSpan" id="kobo.3611.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.3612.1">tar xzf module.tar.gz</span></strong></pre></li> <li><span class="koboSpan" id="kobo.3613.1">Configure your NGINX build with the </span><span class="No-Break"><span class="koboSpan" id="kobo.3614.1">following command:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.3615.1">./configure --add-module=/module/source/path [...]</span></strong></pre></li> </ol>
<p><span class="koboSpan" id="kobo.3616.1">Once you have finished building and installing the application, the module is available just like a regular NGINX module, with its directives </span><span class="No-Break"><span class="koboSpan" id="kobo.3617.1">and variables.</span></span></p>
<p><span class="koboSpan" id="kobo.3618.1">If you are interested in writing NGINX modules yourself, Evan Miller published an excellent walkthrough: </span><em class="italic"><span class="koboSpan" id="kobo.3619.1">Emiller’s Guide to Nginx Module Development</span></em><span class="koboSpan" id="kobo.3620.1">. </span><span class="koboSpan" id="kobo.3620.2">The complete</span><a id="_idIndexMarker353"/><span class="koboSpan" id="kobo.3621.1"> guide may be consulted</span><a id="_idIndexMarker354"/><span class="koboSpan" id="kobo.3622.1"> from his personal</span><a id="_idIndexMarker355"/><span class="koboSpan" id="kobo.3623.1"> website </span><span class="No-Break"><span class="koboSpan" id="kobo.3624.1">at </span></span><a href="https://www.evanmiller.org/"><span class="No-Break"><span class="koboSpan" id="kobo.3625.1">https://www.e</span><span id="_idTextAnchor554"/><span id="_idTextAnchor555"/><span class="koboSpan" id="kobo.3626.1">vanmiller.org/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.3627.1">.</span></span></p>
<h1 id="_idParaDest-110"><a id="_idTextAnchor556"/><span class="koboSpan" id="kobo.3628.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.3629.1">Throughout this chapter, we have been discovering modules that help you improve or fine-tune the configuration of your web server. </span><span class="koboSpan" id="kobo.3629.2">NGINX fiercely stands up to other concurrent web servers in terms of functionality, and its approach to virtual hosts and the way they are configured will probably convince many administrators to make </span><span class="No-Break"><span class="koboSpan" id="kobo.3630.1">the switch.</span></span></p>
<p><span class="koboSpan" id="kobo.3631.1">Three additional modules were left out, though. </span><span class="koboSpan" id="kobo.3631.2">Firstly, the FastCGI module will be approached in the next chapter, as it will allow us to configure a gateway to applications such as PHP or Python. </span><span class="koboSpan" id="kobo.3631.3">Secondly, the Proxy module that lets us design complex setups will be described in </span><a href="B21787_06.xhtml#_idTextAnchor621"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.3632.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.3633.1">. </span><span class="koboSpan" id="kobo.3633.2">Finally, the Upstream module is tied to both, so it will be detailed </span><span class="No-Break"><span class="koboSpan" id="kobo.3634.1">in parallel.</span></span></p>
</div>
</body></html>