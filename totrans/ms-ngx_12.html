<html><head></head><body><div class="appendix" title="Appendix&#xA0;D.&#xA0;Persisting Solaris Network Tunings"><div class="titlepage"><div><div><h1 class="title"><a id="appD"/>Appendix D. Persisting Solaris Network Tunings</h1></div></div></div><p>In <a class="link" href="ch08.html" title="Chapter 8. Troubleshooting Techniques">Chapter 8</a>, <span class="emphasis"><em>Troubleshooting Techniques</em></span>, we saw how to change different network tuning parameters for <a id="id1620" class="indexterm"/>different operating systems. This appendix details what is necessary to persist these changes under Solaris 10 and above.</p><p>The following script is what is actually run by the <span class="strong"><strong>Service Management Framework</strong></span> (<span class="strong"><strong>SMF</strong></span>)<a id="id1621" class="indexterm"/> to set the network parameters with ndd. Save it as <code class="literal">/lib/svc/method/network-tuning.sh</code> and make it executable, so that it can be run at any time on the command line to test:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># vi /lib/svc/method/network-tuning.sh</strong></span>
</pre></div><p>The following snippet is the content of the <code class="literal">/lib/svc/method/network-tuning.sh</code> file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>#!/sbin/sh</strong></span>
<span class="strong"><strong># Set the following values as desired</strong></span>
<span class="strong"><strong>ndd -set /dev/tcp tcp_max_buf 16777216</strong></span>
<span class="strong"><strong>ndd -set /dev/tcp tcp_smallest_anon_port 1024</strong></span>
<span class="strong"><strong>ndd -set /dev/tcp tcp_largest_anon_port 65535</strong></span>
<span class="strong"><strong>ndd -set /dev/tcp tcp_conn_req_max_q 1024</strong></span>
<span class="strong"><strong>ndd -set /dev/tcp tcp_conn_req_max_q0 4096</strong></span>
<span class="strong"><strong>ndd -set /dev/tcp tcp_xmit_hiwat 1048576</strong></span>
<span class="strong"><strong>ndd -set /dev/tcp tcp_recv_hiwat 1048576</strong></span>
<span class="strong"><strong># chmod 755 /lib/svc/method/network-tuning.sh</strong></span>
</pre></div><p>The following manifest serves to define the network-tuning service and will run the script at boot time. Note that we specify a duration of <span class="emphasis"><em>transient</em></span> to let SMF know that this is a run-once script and not a persistent daemon.</p><p>Place it in <code class="literal">/var/svc/manifest/site/network-tuning.xml</code> and import with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong># svccfg import /var/svc/manifest/site/network-tuning.xml</strong></span>
</pre></div><p>You should see<a id="id1622" class="indexterm"/> the following output:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1"&gt;

&lt;service_bundle type='manifest' name='SUNW:network_tuning'&gt;

&lt;service
       name='site/network_tuning'
       type='service'
       version='1'&gt;

       &lt;create_default_instance enabled='true' /&gt;

       &lt;single_instance /&gt;

       &lt;dependency
               name='usr'
               type='service'
               grouping='require_all'
               restart_on='none'&gt;
               &lt;service_fmri value='svc:/system/filesystem/minimal' /&gt;
       &lt;/dependency&gt;

&lt;!-- Run ndd commands after network/physical is plumbed. --&gt;
       &lt;dependency
               name='network-physical'
               grouping='require_all'
               restart_on='none'
               type='service'&gt;
               &lt;service_fmri value='svc:/network/physical' /&gt;
       &lt;/dependency&gt;

&lt;!-- but run the commands before network/initial --&gt;
       &lt;dependent
               name='ndd_network-initial'
               grouping='optional_all'
               restart_on='none'&gt;
               &lt;service_fmri value='svc:/network/initial' /&gt;
       &lt;/dependent&gt;

       &lt;exec_method
               type='method'
               name='start'
               exec='/lib/svc/method/network-tuning.sh'
               timeout_seconds='60' /&gt;

       &lt;exec_method
               type='method'
               name='stop'
               exec=':true'
               timeout_seconds='60' /&gt;

       &lt;property_group name='startd' type='framework'&gt;
               &lt;propval name='duration' type='astring' value='transient' /&gt;
       &lt;/property_group&gt;

       &lt;stability value='Unstable' /&gt;

       &lt;template&gt;
               &lt;common_name&gt;
                       &lt;loctext xml:lang='C'&gt;
                               Network Tunings
                       &lt;/loctext&gt;
               &lt;/common_name&gt;

       &lt;/template&gt;
&lt;/service&gt;

&lt;/service_bundle&gt;</pre></div><p>This service is<a id="id1623" class="indexterm"/> intentionally kept simple, for demonstration purposes. The interested reader can explore SMF in the Solaris man pages and online resources.</p></div></body></html>