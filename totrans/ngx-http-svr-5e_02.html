<html><head></head><body>
<div id="_idContainer019">
<h1 class="chapter-number" id="_idParaDest-46"><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-47"><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.2.1">Basic NGINX Configuration</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will begin to establish an appropriate configuration for your web server. </span><span class="koboSpan" id="kobo.3.2">For this purpose, we need to first discover the syntax that is used in the NGINX configuration files. </span><span class="koboSpan" id="kobo.3.3">Then, we need to understand the various directives that will let you prepare and optimize your web server for different traffic patterns and hardware setups. </span><span class="koboSpan" id="kobo.3.4">Finally, we will create some test pages to make sure that everything has been done correctly and that the configuration is valid. </span><span class="koboSpan" id="kobo.3.5">We will only approach basic configuration directives here. </span><span class="koboSpan" id="kobo.3.6">This chapter and the next ones will detail more advanced topics, such as HTTP module configuration and usage, creating virtual hosts, and setting </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">up SSL.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">This chapter covers the </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">The presentation of the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">configuration syntax</span></span></li>
<li><span class="koboSpan" id="kobo.9.1">Basic </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">module directives</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Testing and maintaining your </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">web server</span></span><a id="_idTextAnchor123"/></li>
</ul>
<h1 id="_idParaDest-48"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.13.1">Delving into the configuration file syntax</span></h1>
<p><span class="koboSpan" id="kobo.14.1">A configuration file</span><a id="_idIndexMarker071"/><span class="koboSpan" id="kobo.15.1"> is generally a text file that is edited by the administrator and parsed by a program. </span><span class="koboSpan" id="kobo.15.2">By specifying a set of values, you define the behavior of the program. </span><span class="koboSpan" id="kobo.15.3">In Linux-based operating systems, the majority of applications rely on vast, complex configuration files that often turn out to be a nightmare to manage. </span><span class="koboSpan" id="kobo.15.4">Apache, Postfix, and Bind – all of these names bring up bad memories in the mind of a Linux </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">system administrator.</span></span></p>
<p><span class="koboSpan" id="kobo.17.1">The fact is that all of these applications use their own configuration files with different syntaxes and styles. </span><span class="koboSpan" id="kobo.17.2">PHP works with a Windows-style </span><strong class="source-inline"><span class="koboSpan" id="kobo.18.1">.ini</span></strong><span class="koboSpan" id="kobo.19.1"> file, Sendmail uses the M4 macro-processor to compile configuration files, Zabbix pulls its configuration from a MySQL database, and so on. </span><span class="koboSpan" id="kobo.19.2">There is, unfortunately, no well-established standard, and the same applies to NGINX – you will be required to study a new syntax with its own particularities and its </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">own vocabulary:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<span class="koboSpan" id="kobo.21.1"><img alt="Figure 2.1: A famous website among tech enthusiasts that makes fun of the situation regarding standards" src="image/B21787_02_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.22.1">Figure 2.1: A famous website among tech enthusiasts that makes fun of the situation regarding standards</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.23.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.24.1">Why isn’t there a universal standard for configuration file syntax? </span><span class="koboSpan" id="kobo.24.2">A possible explanation is provided by </span><em class="italic"><span class="koboSpan" id="kobo.25.1">Randall Munroe</span></em><span class="koboSpan" id="kobo.26.1"> at </span><a href="https://xkcd.com/"><span class="koboSpan" id="kobo.27.1">https://xkcd.com/</span></a><span class="koboSpan" id="kobo.28.1"> (reproduced </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">with authorization).</span></span></p>
<p><span class="koboSpan" id="kobo.30.1">Conversely (and this is one of its advantages), configuring NGINX turns out to be rather simple, at least </span><a id="_idIndexMarker072"/><span class="koboSpan" id="kobo.31.1">in comparison to Apache or other mainstream web servers. </span><span class="koboSpan" id="kobo.31.2">There are only a few mechanisms that need to be mastered – </span><em class="italic"><span class="koboSpan" id="kobo.32.1">directives</span></em><span class="koboSpan" id="kobo.33.1">, </span><em class="italic"><span class="koboSpan" id="kobo.34.1">blocks</span></em><span class="koboSpan" id="kobo.35.1">, and the </span><em class="italic"><span class="koboSpan" id="kobo.36.1">overall logical structure</span></em><span class="koboSpan" id="kobo.37.1"> (which will be covered in </span><a href="B21787_03.xhtml#_idTextAnchor179"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.38.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.39.1">). </span><span class="koboSpan" id="kobo.39.2">Most of the actual configuration process will consist of writing values </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">for directives</span><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.41.1">.</span></span><a id="_idTextAnchor126"/></p>
<h2 id="_idParaDest-49"><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.42.1">Configuration directives</span></h2>
<p><span class="koboSpan" id="kobo.43.1">The</span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.44.1"> NGINX configuration file can be described as a list of directives organized in a logical structure. </span><span class="koboSpan" id="kobo.44.2">The entire behavior of the application is defined by the values that you give to </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">those directives.</span></span></p>
<p><span class="koboSpan" id="kobo.46.1">By default, NGINX makes use of one main configuration file. </span><span class="koboSpan" id="kobo.46.2">The path of this file was defined in the steps described in </span><a href="B21787_01.xhtml#_idTextAnchor014"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.47.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.48.1">, in the </span><em class="italic"><span class="koboSpan" id="kobo.49.1">Build configuration issues</span></em><span class="koboSpan" id="kobo.50.1"> section. </span><span class="koboSpan" id="kobo.50.2">If you did not edit the configuration file path and prefix options, they should be located </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">at </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.52.1">/usr/local/nginx/conf/nginx.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.54.1">However, if </span><a id="_idIndexMarker074"/><span class="koboSpan" id="kobo.55.1">you installed NGINX with a package manager, your configuration file will likely be located at </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">/etc/nginx/nginx.conf</span></strong><span class="koboSpan" id="kobo.57.1">, and the contents of the file may be quite different from the version that comes in the original NGINX source code package. </span><span class="koboSpan" id="kobo.57.2">Now, let’s take a quick peek at the first few lines of this </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">initial setup:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<span class="koboSpan" id="kobo.59.1"><img alt="Figure 2.2: nano is used to edit the nginx.conf file" src="image/B21787_02_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.60.1">Figure 2.2: nano is used to edit the nginx.conf file</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.61.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.62.1">A default configuration file is bundled with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">Nginx</span></strong><span class="koboSpan" id="kobo.64.1"> source </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">code package.</span></span></p>
<p><span class="koboSpan" id="kobo.66.1">Let’s take a closer look at the first </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">two lines:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.68.1">
#user nobody;
worker_processes 1;</span></pre> <p><span class="koboSpan" id="kobo.69.1">As you can probably make out from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">#</span></strong><span class="koboSpan" id="kobo.71.1"> character, the first line is a comment. </span><span class="koboSpan" id="kobo.71.2">In other words, it is a piece of text that is not interpreted and has no value whatsoever. </span><span class="koboSpan" id="kobo.71.3">Its sole purpose is to be read by whoever opens the file, or to temporarily disable parts of an existing configuration section. </span><span class="koboSpan" id="kobo.71.4">You can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">#</span></strong><span class="koboSpan" id="kobo.73.1"> character at the beginning of a line or after </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">a directive.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">The </span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.76.1">second line is an actual statement – a directive. </span><span class="koboSpan" id="kobo.76.2">The first bit (</span><strong class="source-inline"><span class="koboSpan" id="kobo.77.1">worker_processes</span></strong><span class="koboSpan" id="kobo.78.1">) represents a setting key, to which you append one or more values. </span><span class="koboSpan" id="kobo.78.2">In this case, the value is </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">1</span></strong><span class="koboSpan" id="kobo.80.1">, indicating that NGINX should function with a single worker process (more information about this particular directive is given in </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">further sections).</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.82.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.83.1">Directives always end with a </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">semicolon (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.85.1">;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.87.1">Each directive has a unique meaning and defines a particular feature of an application. </span><span class="koboSpan" id="kobo.87.2">It may also have a particular syntax. </span><span class="koboSpan" id="kobo.87.3">For example, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">worker_process</span></strong><span class="koboSpan" id="kobo.89.1"> directive only accepts one numeric value, whereas the </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">user</span></strong><span class="koboSpan" id="kobo.91.1"> directive lets you specify up to two character strings, one for the user account (that the NGINX worker processes should run as) and a second for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">user</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.93.1"> group.</span></span></p>
<p><span class="koboSpan" id="kobo.94.1">NGINX works in a modular way, and as such, each module comes with a specific set of directives. </span><span class="koboSpan" id="kobo.94.2">The most fundamental directives are part of the NGINX core module and will be detailed in this chapter. </span><span class="koboSpan" id="kobo.94.3">As for other directives brought in by other modules, they will be explored in the </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">later chapte</span><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.96.1">r</span><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.97.1">s.</span></span></p>
<h2 id="_idParaDest-50"><a id="_idTextAnchor130"/><span class="koboSpan" id="kobo.98.1">Organization and inclusions</span></h2>
<p><span class="koboSpan" id="kobo.99.1">In </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.100.1">Figure 2</span></em></span><em class="italic"><span class="koboSpan" id="kobo.101.1">.2</span></em><span class="koboSpan" id="kobo.102.1">, you may have noticed a particular directive – </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">include</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.105.1">
include mime.types;</span></pre> <p><span class="koboSpan" id="kobo.106.1">As the</span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.107.1"> name suggests, this directive will perform an inclusion of the specified file. </span><span class="koboSpan" id="kobo.107.2">In other words, the contents of the file will be inserted at this exact location. </span><span class="koboSpan" id="kobo.107.3">Here is a practical example that will help </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">you understand:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">nginx.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.111.1">
user nginx nginx;
worker_processes 4;
include other_settings.conf;</span></pre></li> <li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">other_settings.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.114.1">
error_log logs/error.log;
pid logs/nginx.pid;
The final result, as interpreted by Nginx, is as follows:
user nginx nginx;
worker_processes 4;
error_log logs/error.log;
pid logs/nginx.pid;</span></pre></li> </ul>
<p><span class="koboSpan" id="kobo.115.1">Inclusions are</span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.116.1"> processed recursively. </span><span class="koboSpan" id="kobo.116.2">In this case, you</span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.117.1"> have the possibility to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">include</span></strong><span class="koboSpan" id="kobo.119.1"> directive again in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.120.1">other_settings.conf</span></strong><span class="koboSpan" id="kobo.121.1"> file, in order to include yet </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">another file.</span></span></p>
<p><span class="koboSpan" id="kobo.123.1">In the initial configuration setup, there are two files in use – </span><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">nginx.conf</span></strong><span class="koboSpan" id="kobo.125.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">mime.types</span></strong><span class="koboSpan" id="kobo.127.1">. </span><span class="koboSpan" id="kobo.127.2">However, in the case of a more advanced configuration, there may be five or more files, as described in the </span><span class="No-Break"><span class="koboSpan" id="kobo.128.1">following table:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-2">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.129.1">Standard name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.130.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">nginx.conf</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.132.1">The base configuration of </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">the application.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">mime.types</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.135.1">A list of file extensions and their associated </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">MIME types.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">fastcgi.conf</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.138.1">A </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">FastCGI-related configuration.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">proxy.conf</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.141.1">A </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">proxy-related configuration.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">sites.conf</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.144.1">The configuration of the websites served by NGINX, also known as </span><strong class="bold"><span class="koboSpan" id="kobo.145.1">virtual hosts</span></strong><span class="koboSpan" id="kobo.146.1">. </span><span class="koboSpan" id="kobo.146.2">It’s recommended to create separate files for </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">each domain.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.148.1">Table 2.1: A table detailing the configuration files included by default</span></p>
<p><span class="koboSpan" id="kobo.149.1">These filenames were defined conventionally; nothing actually prevents you from regrouping your FastCGI and proxy settings into a common file </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">proxy_and_fastcgi_config.conf</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.153.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">include</span></strong><span class="koboSpan" id="kobo.155.1"> directive </span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.156.1">supports filename globbing – in other words, filenames referenced</span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.157.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">*</span></strong><span class="koboSpan" id="kobo.159.1"> wildcard, where </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">*</span></strong><span class="koboSpan" id="kobo.161.1"> can match zero, one, or more </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">consecutive characters:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.163.1">
include sites/*.conf;</span></pre> <p><span class="koboSpan" id="kobo.164.1">This will include all files with a name that ends with </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">.conf</span></strong><span class="koboSpan" id="kobo.166.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">sites</span></strong><span class="koboSpan" id="kobo.168.1"> folder. </span><span class="koboSpan" id="kobo.168.2">This mechanism allows you to create a separate file for each of your websites and include them all </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">at once.</span></span></p>
<p><span class="koboSpan" id="kobo.170.1">Be careful when including a file. </span><span class="koboSpan" id="kobo.170.2">If the specified file does not exist, the configuration checks will fail and NGINX will </span><span class="No-Break"><span class="koboSpan" id="kobo.171.1">not start:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.172.1">
[root@server nginx]# ./nginx -t
[emerg]: open() "/etc/nginx/dummyfile.conf" failed (2: No such file or directory) in /etc/nginx/nginx.conf:48</span></pre> <p><span class="koboSpan" id="kobo.173.1">The previous statement is not true for inclusions with wildcards. </span><span class="koboSpan" id="kobo.173.2">Moreover, if you insert </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">include dummy*.conf</span></strong><span class="koboSpan" id="kobo.175.1"> into your configuration and test it (whether there is any file matching this pattern on your system or not), here is what </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">should happen:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.177.1">
[root@server nginx]# ./nginx -t
the configuration file /etc/nginx/nginx.conf syntax is ok configuration file /etc/nginx/nginx.conf test is successf</span><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.178.1">u</span><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.179.1">l</span></pre> <h2 id="_idParaDest-51"><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.180.1">Directive blocks</span></h2>
<p><span class="koboSpan" id="kobo.181.1">Directives</span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.182.1"> are brought in by modules; if you activate </span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.183.1">a new module, a specific set of directives becomes available. </span><span class="koboSpan" id="kobo.183.2">Modules can also enable </span><strong class="bold"><span class="koboSpan" id="kobo.184.1">directive blocks</span></strong><span class="koboSpan" id="kobo.185.1">, which allow for a logical construction of </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">the configuration:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.187.1">
events {
    worker_connections 1024;
}</span></pre> <p><span class="koboSpan" id="kobo.188.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">events</span></strong><span class="koboSpan" id="kobo.190.1"> block that you can find in the default configuration file is brought in by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">events</span></strong><span class="koboSpan" id="kobo.192.1"> module. </span><span class="koboSpan" id="kobo.192.2">The directives that the module enables can only be used within that block. </span><span class="koboSpan" id="kobo.192.3">In the preceding example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">worker_connections</span></strong><span class="koboSpan" id="kobo.194.1"> will only make sense in the context of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">events</span></strong><span class="koboSpan" id="kobo.196.1"> block. </span><span class="koboSpan" id="kobo.196.2">Conversely, some directives must be placed at the root of the configuration file because they have a global effect on the server. </span><span class="koboSpan" id="kobo.196.3">The root of the configuration file is also</span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.197.1"> known as the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.198.1">main block</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.200.1">For the </span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.201.1">most part, blocks can be nested into each other, following a specific logic. </span><span class="koboSpan" id="kobo.201.2">The following sequence demonstrates the structure of a simple</span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.202.1"> website setup, making use of </span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">nested blocks:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.204.1">
http {
    server {
        listen 80;
        server_name example.com;
        access_log /var/log/nginx/example.com.log;
        location ^~ /admin/ {
            index index.php;
       }
    }
}</span></pre> <p><span class="koboSpan" id="kobo.205.1">The topmost directive block is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">http</span></strong><span class="koboSpan" id="kobo.207.1"> block, in which you may declare a variety of configuration directives, as well as one or more </span><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">server</span></strong><span class="koboSpan" id="kobo.209.1"> blocks. </span><span class="koboSpan" id="kobo.209.2">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">server</span></strong><span class="koboSpan" id="kobo.211.1"> block allows you to configure a virtual host – in other words, a website that is to be hosted on your machine. </span><span class="koboSpan" id="kobo.211.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">server</span></strong><span class="koboSpan" id="kobo.213.1"> block, in this example, contains some configuration that applies to all HTTP requests with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">Host</span></strong><span class="koboSpan" id="kobo.215.1"> header exactly </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">matching </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">example.com</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.219.1">Within this </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">server</span></strong><span class="koboSpan" id="kobo.221.1"> block, you may insert one or more </span><strong class="source-inline"><span class="koboSpan" id="kobo.222.1">location</span></strong><span class="koboSpan" id="kobo.223.1"> blocks. </span><span class="koboSpan" id="kobo.223.2">These allow you to enable settings only when the requested URI matches the specified path. </span><span class="koboSpan" id="kobo.223.3">More information is provided in the </span><em class="italic"><span class="koboSpan" id="kobo.224.1">The Location block</span></em><span class="koboSpan" id="kobo.225.1"> section of </span><a href="B21787_03.xhtml#_idTextAnchor179"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.226.1">Chapter 3</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.227.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.228.1">Last but not least, configuration is inherited within children blocks. </span><span class="koboSpan" id="kobo.228.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">access_log</span></strong><span class="koboSpan" id="kobo.230.1"> directive (defined at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">server</span></strong><span class="koboSpan" id="kobo.232.1">-block level in this example) specifies that all HTTP requests for this server should be logged into a text file. </span><span class="koboSpan" id="kobo.232.2">This is still true within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">location</span></strong><span class="koboSpan" id="kobo.234.1"> child block, although you have the possibility of disabling it by reusing the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">access_log</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.236.1"> directive:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.237.1">
[...]
    location ^~ /admin/ {
        index index.php;
        access_log off;
    }
[...]</span></pre> <p><span class="koboSpan" id="kobo.238.1">In this </span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.239.1">case, logging </span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.240.1">will be enabled everywhere on the website, except for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">/admin/</span></strong><span class="koboSpan" id="kobo.242.1"> location path. </span><span class="koboSpan" id="kobo.242.2">The value set for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">access_log</span></strong><span class="koboSpan" id="kobo.244.1"> directive at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">server</span></strong><span class="koboSpan" id="kobo.246.1">-block level is overridden by the one at the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">location</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">-blo</span><a id="_idTextAnchor134"/><span class="koboSpan" id="kobo.249.1">c</span><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.250.1">k level.</span></span></p>
<h2 id="_idParaDest-52"><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.251.1">Advanced language rules</span></h2>
<p><span class="koboSpan" id="kobo.252.1">There </span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.253.1">are a number of important</span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.254.1"> observations regarding the NGINX configuration file syntax. </span><span class="koboSpan" id="kobo.254.2">These will help you understand certain language rules that may seem confusing if you have never worked with </span><span class="No-Break"><span class="koboSpan" id="kobo.255.1">NGINX before.</span></span></p>
<h3><span class="koboSpan" id="kobo.256.1">Directives accept specific syntaxes</span></h3>
<p><span class="koboSpan" id="kobo.257.1">You may </span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.258.1">indeed stumble upon complex syntaxes that can be confusing at </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">first sight:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.260.1">
rewrite ^/(.*)\.(png|jpg|gif)$ /image.php? </span><span class="koboSpan" id="kobo.260.2">file=$1&amp;format=$2 last;</span></pre> <p><span class="koboSpan" id="kobo.261.1">Syntaxes are directive-specific. </span><span class="koboSpan" id="kobo.261.2">While the </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">root</span></strong><span class="koboSpan" id="kobo.263.1"> directive only accepts a simple character string, defining the folder containing files that should be served for a website, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">location</span></strong><span class="koboSpan" id="kobo.265.1"> block or the </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">rewrite</span></strong><span class="koboSpan" id="kobo.267.1"> directive supports complex expressions in order to match particular patterns. </span><span class="koboSpan" id="kobo.267.2">Some other directives, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">listen</span></strong><span class="koboSpan" id="kobo.269.1">, accept up to </span><em class="italic"><span class="koboSpan" id="kobo.270.1">17</span></em><span class="koboSpan" id="kobo.271.1"> different parameters. </span><span class="koboSpan" id="kobo.271.2">Syntaxes will be explained along with directives in their </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">respective chapters.</span></span></p>
<p><span class="koboSpan" id="kobo.273.1">Later on, we will detail a module (the </span><em class="italic"><span class="koboSpan" id="kobo.274.1">rewrite</span></em><span class="koboSpan" id="kobo.275.1"> module) that allows for a much more advanced logical structure through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">if</span></strong><span class="koboSpan" id="kobo.277.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">set</span></strong><span class="koboSpan" id="kobo.279.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">break</span></strong><span class="koboSpan" id="kobo.281.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">return</span></strong><span class="koboSpan" id="kobo.283.1"> blocks and directives, as well as the use of variables. </span><span class="koboSpan" id="kobo.283.2">With all of these new elements, configuration files will begin</span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.284.1"> to look like programming scripts. </span><span class="koboSpan" id="kobo.284.2">Anyhow, the more modules we discover, the richer the </span><span class="No-Break"><span class="koboSpan" id="kobo.285.1">sy</span><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.286.1">n</span><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.287.1">tax becomes.</span></span></p>
<h3><span class="koboSpan" id="kobo.288.1">Diminutives in directive values</span></h3>
<p><span class="koboSpan" id="kobo.289.1">Finally, you</span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.290.1"> cany use the following diminutives to specify a file size in the context of a </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">directive value:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.292.1">k or </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.293.1">K</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.295.1">Kilobytes</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.296.1">m or </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.297.1">M</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.299.1">Megabytes</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.300.1">g or </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.301.1">G</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.303.1">Gigabytes</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.304.1">As a result, the following three syntaxes are correct </span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">and equal:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.306.1">
client_max_body_size 2G;
client_max_body_size 2048M;
client_max_body_size 2097152k;</span></pre> <p><span class="koboSpan" id="kobo.307.1">NGINX does not allow you to insert the same directive more than once within the same block (although there are a few exceptions, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">allow</span></strong><span class="koboSpan" id="kobo.309.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">deny</span></strong><span class="koboSpan" id="kobo.311.1">); should you do so, the configuration will be considered invalid, and NGINX will refuse to start up </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">or reload.</span></span></p>
<p><span class="koboSpan" id="kobo.313.1">Additionally, when specifying a time value, you can use the </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">following shortcuts:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.315.1">ms</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.317.1">Milliseconds</span></strong></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.318.1">s</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.320.1">Seconds</span></strong></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.321.1">m</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.322.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.323.1">Minutes</span></strong></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.324.1">h</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.326.1">Hours</span></strong></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.327.1">d</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.329.1">Days</span></strong></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.330.1">w</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">: </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.332.1">Weeks</span></strong></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.333.1">M</span></strong><span class="koboSpan" id="kobo.334.1">: </span><strong class="bold"><span class="koboSpan" id="kobo.335.1">Months</span></strong><span class="koboSpan" id="kobo.336.1"> (</span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">30 days)</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.338.1">y</span></strong><span class="koboSpan" id="kobo.339.1">: </span><strong class="bold"><span class="koboSpan" id="kobo.340.1">Years</span></strong><span class="koboSpan" id="kobo.341.1"> (</span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">365 days)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.343.1">This becomes especially useful in the case of directives that accept a period of time as </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">a value:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.345.1">
client_body_timeout 3m;
client_body_timeout 180s;
client_body_timeout 180;</span></pre> <p><span class="koboSpan" id="kobo.346.1">The default</span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.347.1"> time unit is seconds; the last two preceding lines thus result in identical behavior. </span><span class="koboSpan" id="kobo.347.2">It is also possible to combine two values with </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">different units:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.349.1">
client_body_timeout 1m30s;
client_body_timeout '1m 30s 500ms';</span></pre> <p><span class="koboSpan" id="kobo.350.1">The latter variant is enclosed in quotes, since values are separ</span><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.351.1">a</span><a id="_idTextAnchor140"/><span class="koboSpan" id="kobo.352.1">ted </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">by spaces.</span></span></p>
<h3><span class="koboSpan" id="kobo.354.1">Variables</span></h3>
<p><span class="koboSpan" id="kobo.355.1">Modules </span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.356.1">also provide variables that can be used in the definition of directive values. </span><span class="koboSpan" id="kobo.356.2">For example, the NGINX HTTP core module defines the </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">$nginx_version</span></strong><span class="koboSpan" id="kobo.358.1"> variable. </span><span class="koboSpan" id="kobo.358.2">Variables in NGINX always start with </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">$</span></strong><span class="koboSpan" id="kobo.360.1"> – the dollar sign. </span><span class="koboSpan" id="kobo.360.2">When setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">log_format</span></strong><span class="koboSpan" id="kobo.362.1"> directive, you can include all kinds of variables in the </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">format string:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.364.1">
[...]
location ^~ /admin/ {
    access_log logs/main.log;
    log_format main '$pid - $nginx_version - $remote_addr';
}
[...]</span></pre> <p><span class="koboSpan" id="kobo.365.1">Some directives do not allow you to </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1">use variables:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.367.1">
error_log logs/error-$nginx_version.log;</span></pre> <p><span class="koboSpan" id="kobo.368.1">The preceding directive is valid, syntax-wise. </span><span class="koboSpan" id="kobo.368.2">However, it simply generates a file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">error-$nginx_version.log</span></strong><span class="koboSpan" id="kobo.370.1">, without parsi</span><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.371.1">n</span><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.372.1">g </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">the variable.</span></span></p>
<h3><span class="koboSpan" id="kobo.374.1">String values</span></h3>
<p><span class="koboSpan" id="kobo.375.1">Character strings </span><a id="_idIndexMarker095"/><span class="koboSpan" id="kobo.376.1">that you use as directive values can be written in three forms. </span><span class="koboSpan" id="kobo.376.2">First, you can enter a value </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">without quotes:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.378.1">
root /home/example.com/www;</span></pre> <p><span class="koboSpan" id="kobo.379.1">However, if you want to use a particular character, such as a blank space (</span><strong class="source-inline"> </strong><span class="koboSpan" id="kobo.380.1">), a semicolon (</span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">;</span></strong><span class="koboSpan" id="kobo.382.1">), or a pair of curly braces (</span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">{</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.384.1">}</span></strong><span class="koboSpan" id="kobo.385.1">), you will need to either prefix said character with a backslash (</span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">\</span></strong><span class="koboSpan" id="kobo.387.1">) or enclose the entire value in single or </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">double quotes:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.389.1">
root '/home/example.com/my web pages';</span></pre> <p><span class="koboSpan" id="kobo.390.1">NGINX makes no difference whether you use single or double quotes. </span><span class="koboSpan" id="kobo.390.2">Note that variables inserted in strings within quotes will be expanded normally unless you prefix the </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1">$</span></strong><span class="koboSpan" id="kobo.392.1"> character with </span><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.393.1">a </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">backslash (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">\</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.397.1">We now have a better understanding of how the configuration works, as we’ve learned about the syntax and the diminutives. </span><span class="koboSpan" id="kobo.397.2">We are now ready to cover the NGINX modules in depth, allowing us to fine-tune NGINX to take full advantage of the hardware and network to better </span><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.398.1">cover </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">our needs.</span></span></p>
<h1 id="_idParaDest-53"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.400.1">Looking at the base module directives</span></h1>
<p><span class="koboSpan" id="kobo.401.1">In this section, we </span><a id="_idIndexMarker096"/><span class="koboSpan" id="kobo.402.1">will take a closer look at the base modules. </span><span class="koboSpan" id="kobo.402.2">We are particularly interested in answering two questions – </span><em class="italic"><span class="koboSpan" id="kobo.403.1">what are base modules?</span></em><span class="koboSpan" id="kobo.404.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.405.1">what directives a</span><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.406.1">r</span><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.407.1">e </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.408.1">made available?</span></em></span></p>
<h2 id="_idParaDest-54"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.409.1">What are base modules?</span></h2>
<p><span class="koboSpan" id="kobo.410.1">The base modules </span><a id="_idIndexMarker097"/><span class="koboSpan" id="kobo.411.1">offer directives that allow you to define the parameters of the basic functionality of NGINX. </span><span class="koboSpan" id="kobo.411.2">They cannot be disabled at compile time, and as a result, the directives and blocks they offer are always available. </span><span class="koboSpan" id="kobo.411.3">Three base modules </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">are distinguished:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.413.1">Core module</span></strong><span class="koboSpan" id="kobo.414.1">: This </span><a id="_idIndexMarker098"/><span class="koboSpan" id="kobo.415.1">has essential features and directives, such as process management </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">and security</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.417.1">Events module</span></strong><span class="koboSpan" id="kobo.418.1">: This</span><a id="_idIndexMarker099"/><span class="koboSpan" id="kobo.419.1"> lets you configure the inner mechanisms of the </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">networking capabilities</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.421.1">Configuration module</span></strong><span class="koboSpan" id="kobo.422.1">: This </span><a id="_idIndexMarker100"/><span class="koboSpan" id="kobo.423.1">enables the </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">inclusion mechanism</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.425.1">These modules offer a large range of directives; we will detail them individually, with their syntax</span><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.426.1">e</span><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.427.1">s and </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">default values.</span></span></p>
<h2 id="_idParaDest-55"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.429.1">NGINX process architecture</span></h2>
<p><span class="koboSpan" id="kobo.430.1">Before we </span><a id="_idIndexMarker101"/><span class="koboSpan" id="kobo.431.1">start detailing the basic configuration directives, it is necessary to understand the overall process architecture – that is, how the NGINX daemon works behind the scenes. </span><span class="koboSpan" id="kobo.431.2">Although the application comes as a simple binary file (and a somewhat lightweight background process), the way it functions at runtime can be </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">relatively complex.</span></span></p>
<p><span class="koboSpan" id="kobo.433.1">At the very moment of starting NGINX, one unique process exists in memory – </span><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">master process</span></strong><span class="koboSpan" id="kobo.435.1">. </span><span class="koboSpan" id="kobo.435.2">It is launched with the current user and group permissions, usually </span><strong class="source-inline"><span class="koboSpan" id="kobo.436.1">root/root</span></strong><span class="koboSpan" id="kobo.437.1"> if the service is launched at boot time by an </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">init</span></strong><span class="koboSpan" id="kobo.439.1"> script. </span><span class="koboSpan" id="kobo.439.2">The master process itself does not process any client requests; instead, it spawns processes that do – </span><em class="italic"><span class="koboSpan" id="kobo.440.1">worker processes</span></em><span class="koboSpan" id="kobo.441.1">, which are affected by a customizable user </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">and group.</span></span></p>
<p><span class="koboSpan" id="kobo.443.1">From the configuration file, you are able to define the number of worker processes, the maximum connections per worker process, the user and group the worker processes run under, and so on. </span><span class="koboSpan" id="kobo.443.2">The following screenshot shows an example of a running instance of NGINX, with eight worker processes running under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.444.1">www-data</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.445.1">user account:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<span class="koboSpan" id="kobo.446.1"><img alt="Figure 2.3: ps faux is used to list the processes and grep is u﻿s﻿ed to show only nginx" src="image/B21787_02_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.447.1">Figure 2.3: ps faux is used to list the processes and grep is u</span><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.448.1">s</span><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.449.1">ed to show only nginx</span></p>
<h2 id="_idParaDest-56"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.450.1">Core module directives</span></h2>
<p><span class="koboSpan" id="kobo.451.1">The </span><a id="_idIndexMarker102"/><span class="koboSpan" id="kobo.452.1">following is the list of directives made available by the core module. </span><span class="koboSpan" id="kobo.452.2">Most of these directives must be placed at the root of the configuration file and can only be used once. </span><span class="koboSpan" id="kobo.452.3">However, some of them are valid in </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">multiple contexts.</span></span></p>
<p><span class="koboSpan" id="kobo.454.1">If that is the case, the following is the list of valid contexts under the </span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">directive name:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.456.1">Name </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.457.1">and context</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.458.1">Syntax </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.459.1">and description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.460.1">daemon</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.461.1">Accepted values</span></strong><span class="koboSpan" id="kobo.462.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.464.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.467.1">Syntax</span></strong><span class="koboSpan" id="kobo.468.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.469.1">daemon on;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.471.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.472.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">on</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.476.1">Enables or disables daemon mode. </span><span class="koboSpan" id="kobo.476.2">If you disable it, the program will not be started in the background; it will stay in the foreground when launched from the shell. </span><span class="koboSpan" id="kobo.476.3">This may come in handy for debugging, in situations where you need to know what causes NGINX to crash, </span><span class="No-Break"><span class="koboSpan" id="kobo.477.1">and when.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">debug_points</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.479.1">Accepted values</span></strong><span class="koboSpan" id="kobo.480.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.481.1">stop</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.482.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.483.1">abort</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.485.1">Syntax</span></strong><span class="koboSpan" id="kobo.486.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.487.1">debug_points stop;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.489.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.490.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.492.1">Activates debug points in NGINX. </span><span class="koboSpan" id="kobo.492.2">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">stop</span></strong><span class="koboSpan" id="kobo.494.1"> to interrupt the application when a debug point comes about in order to attach a debugger. </span><span class="koboSpan" id="kobo.494.2">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">abort</span></strong><span class="koboSpan" id="kobo.496.1"> to abort the debug point and create a core </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">dump file.</span></span></p>
<p><span class="koboSpan" id="kobo.498.1">To disable this feature, simply do not use </span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">the directive.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">Env</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.501.1">Syntax</span></strong><span class="koboSpan" id="kobo.502.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">env MY_VARIABLE; </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">env MY_VARIABLE=my_value;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.506.1">Allows you to define or redefine </span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">environment variables</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">error_log</span></strong></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.509.1">Context</span></strong><span class="koboSpan" id="kobo.510.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">main</span></strong><span class="koboSpan" id="kobo.512.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">http</span></strong><span class="koboSpan" id="kobo.514.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">server</span></strong><span class="koboSpan" id="kobo.516.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">and</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.518.1"> location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.519.1">Syntax</span></strong><span class="koboSpan" id="kobo.520.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">error_log /</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">file/path level;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.524.1">Default value</span></strong><span class="koboSpan" id="kobo.525.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">logs/error.log error</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.528.1">Where level is one of these values</span></strong><span class="koboSpan" id="kobo.529.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">debug</span></strong><span class="koboSpan" id="kobo.531.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">info</span></strong><span class="koboSpan" id="kobo.533.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">notice</span></strong><span class="koboSpan" id="kobo.535.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">warn</span></strong><span class="koboSpan" id="kobo.537.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">error</span></strong><span class="koboSpan" id="kobo.539.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.540.1">crit</span></strong><span class="koboSpan" id="kobo.541.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">alert</span></strong><span class="koboSpan" id="kobo.543.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">emerg</span></strong><span class="koboSpan" id="kobo.545.1"> (from most to least detailed – </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">debug</span></strong><span class="koboSpan" id="kobo.547.1"> provides frequent log entries, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">emerg</span></strong><span class="koboSpan" id="kobo.549.1"> only reports the most </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">critical errors).</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.551.1">Enables error logging at different levels</span></strong><span class="koboSpan" id="kobo.552.1">: The application, HTTP server, virtual host, and virtual </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">host directory.</span></span></p>
<p><span class="koboSpan" id="kobo.554.1">By redirecting the log output to </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">/dev/null</span></strong><span class="koboSpan" id="kobo.556.1">, you can disable error logging. </span><span class="koboSpan" id="kobo.556.2">Use the following directive at the root of the </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">configuration file:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">error_log /</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">dev/null crit;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.560.1">Instead of specifying a file path, you might also select one of the following alternatives – </span><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">stderr</span></strong><span class="koboSpan" id="kobo.562.1"> will send log entries to the standard error file, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">Syslog</span></strong><span class="koboSpan" id="kobo.564.1"> will send them to the system log. </span><span class="koboSpan" id="kobo.564.2">These alternatives are further detailed in </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">C</span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.566.1">hapter 11</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">lock_file</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.569.1">Syntax (file path)</span></strong><span class="koboSpan" id="kobo.570.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">lock_file logs/nginx.lock;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.573.1">Default value</span></strong><span class="koboSpan" id="kobo.574.1">: Defined at </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">compile time.</span></span></p>
<p><span class="koboSpan" id="kobo.576.1">Use a lock file for mutual exclusion. </span><span class="koboSpan" id="kobo.576.2">This is disabled by default, unless you enabled it at compile time. </span><span class="koboSpan" id="kobo.576.3">On most operating systems, the locks are implemented using atomic operations, so this directive is </span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">ignored anyway.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.578.1">load_module</span></strong></span></p>
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.579.1">Context</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.580.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">main</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.582.1">Syntax (file path)</span></strong><span class="koboSpan" id="kobo.583.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">load_module   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">modules/ngx_http_geoip_module.so;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.586.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.587.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.588.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.590.1">Load a dynamically compiled module </span><span class="No-Break"><span class="koboSpan" id="kobo.591.1">at runtime</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">log_not_found</span></strong></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.593.1">Context</span></strong><span class="koboSpan" id="kobo.594.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">main</span></strong><span class="koboSpan" id="kobo.596.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">http</span></strong><span class="koboSpan" id="kobo.598.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">server</span></strong><span class="koboSpan" id="kobo.600.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.601.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.603.1">Accepted values</span></strong><span class="koboSpan" id="kobo.604.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.606.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.608.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.609.1">Syntax</span></strong><span class="koboSpan" id="kobo.610.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.611.1">log_not_found on;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.613.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.614.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">on</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.618.1">Enables or disables logging of </span><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">404</span></strong><span class="koboSpan" id="kobo.620.1"> not found HTTP errors. </span><span class="koboSpan" id="kobo.620.2">If your logs get filled with </span><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">404</span></strong><span class="koboSpan" id="kobo.622.1"> errors due to missing </span><strong class="source-inline"><span class="koboSpan" id="kobo.623.1">favicon.ico</span></strong><span class="koboSpan" id="kobo.624.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.625.1">robots.txt</span></strong><span class="koboSpan" id="kobo.626.1"> files, you might want to turn </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">this off.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">master_process</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.629.1">Accepted values</span></strong><span class="koboSpan" id="kobo.630.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.632.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.633.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.635.1">Syntax</span></strong><span class="koboSpan" id="kobo.636.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.637.1">master_process on;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.638.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.639.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.640.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.641.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.642.1">on</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.644.1">If enabled, NGINX will start multiple processes – the main process (the master process) and worker processes. </span><span class="koboSpan" id="kobo.644.2">If disabled, NGINX works with a unique process. </span><span class="koboSpan" id="kobo.644.3">This directive should be used for testing purposes only, as it disables the master process; clients thus cannot connect to </span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">your server.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.646.1">pcre_jit</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.647.1">Accepted values</span></strong><span class="koboSpan" id="kobo.648.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.649.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.650.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.651.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.653.1">Syntax</span></strong><span class="koboSpan" id="kobo.654.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">pcre_jit on;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.657.1">Enables or disables </span><strong class="bold"><span class="koboSpan" id="kobo.658.1">Just-in-Time</span></strong><span class="koboSpan" id="kobo.659.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.660.1">JIT</span></strong><span class="koboSpan" id="kobo.661.1">) compilation for regular expressions (PCRE from version 8.20 and above), which may speed up their processing significantly. </span><span class="koboSpan" id="kobo.661.2">For this to work, the PCRE libraries on your system must be specifically built with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.662.1">--enable-jit</span></strong><span class="koboSpan" id="kobo.663.1"> configuration argument. </span><span class="koboSpan" id="kobo.663.2">When configuring your NGINX build, you must also add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.664.1">--</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.665.1">with-pcre-jit</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.666.1"> argument.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.667.1">Pid</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.668.1">Syntax (file path)</span></strong><span class="koboSpan" id="kobo.669.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">pid logs/nginx.pid;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.671.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.672.1">Default value</span></strong><span class="koboSpan" id="kobo.673.1">: Defined at </span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">compile time.</span></span></p>
<p><span class="koboSpan" id="kobo.675.1">The path of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.676.1">pid</span></strong><span class="koboSpan" id="kobo.677.1"> file for the NGINX daemon. </span><span class="koboSpan" id="kobo.677.2">The default value can be configured at compile time. </span><span class="koboSpan" id="kobo.677.3">Make sure to enable this directive and set its value properly, since the </span><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">pid</span></strong><span class="koboSpan" id="kobo.679.1"> file can be used by the NGINX </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">init</span></strong><span class="koboSpan" id="kobo.681.1"> script, depending on your </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">operating system.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.683.1">ssl_engine</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.684.1">Syntax (character string)</span></strong><span class="koboSpan" id="kobo.685.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.686.1">ssl_engine enginename;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.687.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.688.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.689.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.691.1">Where </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">enginename</span></strong><span class="koboSpan" id="kobo.693.1"> is the name of an available hardware SSL accelerator on your system. </span><span class="koboSpan" id="kobo.693.2">To check for available hardware SSL accelerators, run this command from </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">the shell:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.695.1">openssl </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.696.1">engine -t</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.697.1">thread_pool</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.698.1">Syntax</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.700.1">thread_pool name </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.701.1">threads=number [max_queue=number];</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.702.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.703.1">Default value</span></strong><span class="koboSpan" id="kobo.704.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">thread_pool default </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.706.1">threads=32 max_queue=65536;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.707.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.708.1">Defines a thread pool reference that can be used with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">aio</span></strong><span class="koboSpan" id="kobo.710.1"> directive, in order to serve larger files asynchronously. </span><span class="koboSpan" id="kobo.710.2">Further details are provided in </span><a href="B21787_09.xhtml#_idTextAnchor701"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.711.1">Chapter 9</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.712.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.713.1">timer_resolution</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.714.1">Syntax (numeric (time))</span></strong><span class="koboSpan" id="kobo.715.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">timer_resolution 100ms;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.717.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.718.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.719.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.721.1">Controls the interval between system calls to </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">gettimeofday()</span></strong><span class="koboSpan" id="kobo.723.1"> to synchronize the internal clock. </span><span class="koboSpan" id="kobo.723.2">If this value is not specified, the clock is refreshed after each kernel </span><span class="No-Break"><span class="koboSpan" id="kobo.724.1">event notification.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">user</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.726.1">Syntax</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.727.1">:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.728.1">user </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">username groupname;</span></strong></span></p>
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.730.1">user username;.</span></strong></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.731.1">Default value</span></strong><span class="koboSpan" id="kobo.732.1">: Defined at compile time. </span><span class="koboSpan" id="kobo.732.2">If still undefined, the user and group of the NGINX master process </span><span class="No-Break"><span class="koboSpan" id="kobo.733.1">are used.</span></span></p>
<p><span class="koboSpan" id="kobo.734.1">Allows you to define the user account and, optionally, the user group used to start the NGINX worker processes. </span><span class="koboSpan" id="kobo.734.2">For security reasons, you should make sure to specify a user and group with limited privileges. </span><span class="koboSpan" id="kobo.734.3">For example, create a new user and group dedicated to NGINX, and remember to apply proper permissions on the files that will </span><span class="No-Break"><span class="koboSpan" id="kobo.735.1">be served.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">worker_cpu_affinity</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.737.1">Syntax</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.739.1">worker_cpu_affinity 1000 0100 0010 0001; worker_cpu_affinity 10 10 </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.740.1">01 01;</span></strong></span></p>
<p> <span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">worker_cpu_affinity auto;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.743.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.744.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.745.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.746.1">This directive works in conjunction with </span><strong class="source-inline"><span class="koboSpan" id="kobo.747.1">worker_processes</span></strong><span class="koboSpan" id="kobo.748.1">. </span><span class="koboSpan" id="kobo.748.2">It lets you affect worker processes to </span><span class="No-Break"><span class="koboSpan" id="kobo.749.1">CPU cores.</span></span></p>
<p><span class="koboSpan" id="kobo.750.1">There are as many series of digit blocks as worker processes; there are as many digits in a block as your CPU </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1">has cores.</span></span></p>
<p><span class="koboSpan" id="kobo.752.1">If you configure NGINX to use three worker processes, there are three blocks of digits. </span><span class="koboSpan" id="kobo.752.2">For a dual-core CPU, each block has </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">two digits:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">worker_cpu_affinity 01 </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.755.1">01 10;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.756.1">The first block (</span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">01</span></strong><span class="koboSpan" id="kobo.758.1">) indicates that the first worker process should be effected to the </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">second core.</span></span></p>
<p><span class="koboSpan" id="kobo.760.1">The second block (</span><strong class="source-inline"><span class="koboSpan" id="kobo.761.1">01</span></strong><span class="koboSpan" id="kobo.762.1">) indicates that the second worker process should be affected to the </span><span class="No-Break"><span class="koboSpan" id="kobo.763.1">second core.</span></span></p>
<p><span class="koboSpan" id="kobo.764.1">The third block (</span><strong class="source-inline"><span class="koboSpan" id="kobo.765.1">10</span></strong><span class="koboSpan" id="kobo.766.1">) indicates that the third worker process should be affected to the </span><span class="No-Break"><span class="koboSpan" id="kobo.767.1">first core.</span></span></p>
<p><span class="koboSpan" id="kobo.768.1">The auto value allows NGINX to automatically manage the process binding. </span><span class="koboSpan" id="kobo.768.2">This differs from the default of not being specified, which means the OS will </span><span class="No-Break"><span class="koboSpan" id="kobo.769.1">manage it.</span></span></p>
<p><span class="koboSpan" id="kobo.770.1">Note that affinity is only recommended for multi-core CPUs, not for processors with hyperthreading or </span><span class="No-Break"><span class="koboSpan" id="kobo.771.1">similar technologies.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.772.1">worker_priority</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.773.1">Syntax (numeric)</span></strong><span class="koboSpan" id="kobo.774.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.775.1">worker_priority 0;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.776.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.777.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.778.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.779.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.780.1">0</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.781.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.782.1">Defines the priority of the worker processes, from </span><strong class="source-inline"><span class="koboSpan" id="kobo.783.1">-20</span></strong><span class="koboSpan" id="kobo.784.1"> (highest) to </span><strong class="source-inline"><span class="koboSpan" id="kobo.785.1">19</span></strong><span class="koboSpan" id="kobo.786.1"> (lowest). </span><span class="koboSpan" id="kobo.786.2">The default value is </span><strong class="source-inline"><span class="koboSpan" id="kobo.787.1">0</span></strong><span class="koboSpan" id="kobo.788.1">. </span><span class="koboSpan" id="kobo.788.2">Note that kernel processes run at priority level </span><strong class="source-inline"><span class="koboSpan" id="kobo.789.1">-5</span></strong><span class="koboSpan" id="kobo.790.1">, so it’s not recommended that you set the priority to </span><strong class="source-inline"><span class="koboSpan" id="kobo.791.1">-5</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.792.1">or less.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.793.1">worker_processes</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.794.1">Syntax (numeric or auto)</span></strong><span class="koboSpan" id="kobo.795.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.796.1">worker_processes 4;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.797.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.798.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.799.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.800.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.801.1">1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.802.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.803.1">Defines the number of worker processes. </span><span class="koboSpan" id="kobo.803.2">NGINX offers to separate the treatment of requests into multiple processes. </span><span class="koboSpan" id="kobo.803.3">The default value is </span><strong class="source-inline"><span class="koboSpan" id="kobo.804.1">1</span></strong><span class="koboSpan" id="kobo.805.1">, but it’s recommended to increase this value if your CPU has more than one core. </span><span class="koboSpan" id="kobo.805.2">Besides, if a process gets blocked due to slow I/O operations, incoming requests can be delegated to the other </span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">worker processes.</span></span></p>
<p><span class="koboSpan" id="kobo.807.1">Alternatively, you may use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">auto</span></strong><span class="koboSpan" id="kobo.809.1"> value, which will let NGINX select an appropriate value for this directive. </span><span class="koboSpan" id="kobo.809.2">By default, it is the amount of CPU cores detected on </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">the system.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.811.1">worker_rlimit_core</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.812.1">Syntax (numeric (size))</span></strong><span class="koboSpan" id="kobo.813.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.814.1">worker_rlimit_core 100m;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.815.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.816.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.817.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.818.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.819.1">Defines the size of core files per </span><span class="No-Break"><span class="koboSpan" id="kobo.820.1">worker process</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.821.1">worker_rlimit_nofile</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.822.1">Syntax (numeric)</span></strong><span class="koboSpan" id="kobo.823.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.824.1">worker_rlimit_nofile 10000;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.825.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.826.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.827.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.828.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.829.1">Defines the number of files a worker process can </span><span class="No-Break"><span class="koboSpan" id="kobo.830.1">use simultaneously.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">working_directory</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.832.1">Syntax (directory path)</span></strong><span class="koboSpan" id="kobo.833.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">working_directory /usr/local/nginx/;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.835.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.836.1">Default value</span></strong><span class="koboSpan" id="kobo.837.1">: The prefix switch defined at </span><span class="No-Break"><span class="koboSpan" id="kobo.838.1">compile time.</span></span></p>
<p><span class="koboSpan" id="kobo.839.1">Working directory used for worker processes; it is only used to define the location of core files. </span><span class="koboSpan" id="kobo.839.2">The worker process user account (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">user</span></strong><span class="koboSpan" id="kobo.841.1"> directive) must have write permissions on this folder in order to be able to write </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1">core files.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.843.1">worker_aio_requests</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.844.1">Syntax (numeric)</span></strong><span class="koboSpan" id="kobo.845.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">worker_aio_requests 10000;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.847.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.848.1">If you are using </span><strong class="source-inline"><span class="koboSpan" id="kobo.849.1">aio</span></strong><span class="koboSpan" id="kobo.850.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.851.1">epoll</span></strong><span class="koboSpan" id="kobo.852.1"> connection processing method, this directive sets the maximum number of outstanding asynchronous I/O operations for a single </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">worker process.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.854.1">worker_shutdown_timeout</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.855.1">Syntax (time)</span></strong><span class="koboSpan" id="kobo.856.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.857.1">worker_shutdown_timeout 5s;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.858.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.859.1">Configures the time limit for the graceful shutdown of worker processes. </span><span class="koboSpan" id="kobo.859.2">If exceeded, NGINX will try to forcefully close workers to complete </span><span class="No-Break"><span class="koboSpan" id="kobo.860.1">the shutdown.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.861.1">Table 2.2: A table detailing the core module directives</span></p>
<h2 id="_idParaDest-57"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.862.1">The events module</span></h2>
<p><span class="koboSpan" id="kobo.863.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.864.1">events</span></strong><span class="koboSpan" id="kobo.865.1"> module</span><a id="_idIndexMarker103"/><span class="koboSpan" id="kobo.866.1"> comes with directives that allow you to configure network mechanisms. </span><span class="koboSpan" id="kobo.866.2">Some of the parameters have an important impact on an </span><span class="No-Break"><span class="koboSpan" id="kobo.867.1">application’s performance.</span></span></p>
<p><span class="koboSpan" id="kobo.868.1">All of the directives listed in the following table must be placed in the events block, which is located at the root of the </span><span class="No-Break"><span class="koboSpan" id="kobo.869.1">configuration file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.870.1">
user nginx nginx;
master_process on;
worker_processes 4;
events {
  worker_connections 1024;
  use epoll;
}
[...]</span></pre> <p><span class="koboSpan" id="kobo.871.1">These directives cannot be placed elsewhere (if you do so, the configuration test </span><span class="No-Break"><span class="koboSpan" id="kobo.872.1">will fail):</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table003">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.873.1">Directive name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.874.1">Syntax </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.875.1">and description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.876.1">accept_mutex</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.877.1">Accepted values</span></strong><span class="koboSpan" id="kobo.878.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.879.1">on</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.880.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.881.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.882.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.883.1">Syntax</span></strong><span class="koboSpan" id="kobo.884.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.885.1">accept_mutex </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">on;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.887.1"> .</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.888.1">Default value</span></strong><span class="koboSpan" id="kobo.889.1">: As of version 1.11.3, </span><strong class="source-inline"><span class="koboSpan" id="kobo.890.1">off</span></strong><span class="koboSpan" id="kobo.891.1">; prior to version </span><span class="No-Break"><span class="koboSpan" id="kobo.892.1">1.11.3, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.893.1">on</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.894.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.895.1">Enables or disables the use of an accept mutex (mutual exclusion) to open </span><span class="No-Break"><span class="koboSpan" id="kobo.896.1">listening sockets.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.897.1">accept_mutex_delay</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.898.1">Syntax (numeric (time))</span></strong><span class="koboSpan" id="kobo.899.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.900.1">accept_mutex_delay 500ms;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.901.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.902.1">Default value</span></strong><span class="koboSpan" id="kobo.903.1">: </span><span class="No-Break"><span class="koboSpan" id="kobo.904.1">500 milliseconds.</span></span></p>
<p><span class="koboSpan" id="kobo.905.1">Defines the amount of time a worker process should wait before trying to acquire the resource again. </span><span class="koboSpan" id="kobo.905.2">This value is not used if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.906.1">accept_mutex</span></strong><span class="koboSpan" id="kobo.907.1"> directive is set </span><span class="No-Break"><span class="koboSpan" id="kobo.908.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.909.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.910.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.911.1">debug_connection</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.912.1">Syntax (IP address or </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.913.1">CIDR block)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.914.1">:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.915.1">debug_connection   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.916.1">172.63.155.21;</span></strong></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.917.1">debug_connection   </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.918.1">172.63.155.0/24;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.919.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.920.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.921.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.922.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.923.1">Writes detailed logs for clients matching this IP address or address block. </span><span class="koboSpan" id="kobo.923.2">The debug information is stored in the file specified with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.924.1">error_log</span></strong><span class="koboSpan" id="kobo.925.1"> directive, enabled with the </span><span class="No-Break"><span class="koboSpan" id="kobo.926.1">debug level.</span></span></p>
<p><span class="koboSpan" id="kobo.927.1">NGINX must be compiled with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.928.1">--debug</span></strong><span class="koboSpan" id="kobo.929.1"> switch in order to enable </span><span class="No-Break"><span class="koboSpan" id="kobo.930.1">this feature.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.931.1">multi_accept</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.932.1">Syntax (on or off)</span></strong><span class="koboSpan" id="kobo.933.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1">multi_accept </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">off;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.936.1"> .</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.937.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.938.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.939.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.940.1">off</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.941.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.942.1">Defines whether or not NGINX should accept all incoming connections at once from the </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">listening queue.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.944.1">use</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.945.1">Accepted values</span></strong><span class="koboSpan" id="kobo.946.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.947.1">/dev/poll</span></strong><span class="koboSpan" id="kobo.948.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.949.1">epoll</span></strong><span class="koboSpan" id="kobo.950.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.951.1">eventport</span></strong><span class="koboSpan" id="kobo.952.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.953.1">kqueue</span></strong><span class="koboSpan" id="kobo.954.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.955.1">rtsig</span></strong><span class="koboSpan" id="kobo.956.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.957.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.958.1">select</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.960.1">Syntax</span></strong><span class="koboSpan" id="kobo.961.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.962.1">use kqueue;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.963.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.964.1">Default value</span></strong><span class="koboSpan" id="kobo.965.1">: Defined at </span><span class="No-Break"><span class="koboSpan" id="kobo.966.1">compile time.</span></span></p>
<p><span class="koboSpan" id="kobo.967.1">Selects the </span><strong class="source-inline"><span class="koboSpan" id="kobo.968.1">event</span></strong><span class="koboSpan" id="kobo.969.1"> model among the available ones (the ones that you enabled at compile time). </span><span class="koboSpan" id="kobo.969.2">NGINX automatically selects the most appropriate one, so you should not have to modify </span><span class="No-Break"><span class="koboSpan" id="kobo.970.1">this value.</span></span></p>
<p><span class="koboSpan" id="kobo.971.1">The supported models are </span><span class="No-Break"><span class="koboSpan" id="kobo.972.1">as follows:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.973.1">select</span></strong><span class="koboSpan" id="kobo.974.1">: The default and standard module, which is used if the OS does not support a more efficient one (it’s the only available method under Windows). </span><span class="koboSpan" id="kobo.974.2">This method is not recommended for servers that expect to be under </span><span class="No-Break"><span class="koboSpan" id="kobo.975.1">high load.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">poll</span></strong><span class="koboSpan" id="kobo.977.1">: This is automatically preferred over </span><strong class="source-inline"><span class="koboSpan" id="kobo.978.1">select</span></strong><span class="koboSpan" id="kobo.979.1"> but is not available on </span><span class="No-Break"><span class="koboSpan" id="kobo.980.1">all systems.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.981.1">kqueue</span></strong><span class="koboSpan" id="kobo.982.1">: An efficient method for FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0, and </span><span class="No-Break"><span class="koboSpan" id="kobo.983.1">macOS OSes.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.984.1">epoll</span></strong><span class="koboSpan" id="kobo.985.1">: An efficient method for Linux 2.6+ </span><span class="No-Break"><span class="koboSpan" id="kobo.986.1">based OSes.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.987.1">rtsig</span></strong><span class="koboSpan" id="kobo.988.1">: Real-time signals, available as of Linux 2.2.19 but unsuitable for high-traffic profiles, as default system settings only allow 1,024 </span><span class="No-Break"><span class="koboSpan" id="kobo.989.1">queued signals.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">/dev/poll</span></strong><span class="koboSpan" id="kobo.991.1">: An efficient method for Solaris 7 11/99+, HP/UX 11.22+, IRIX 6.5.15+, and Tru64 UNIX </span><span class="No-Break"><span class="koboSpan" id="kobo.992.1">5.1A+ OSes.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.993.1">eventport</span></strong><span class="koboSpan" id="kobo.994.1">: An efficient method for Solaris 10, although a security patch </span><span class="No-Break"><span class="koboSpan" id="kobo.995.1">is required.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">worker_connections</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.997.1">Syntax (numeric)</span></strong><span class="koboSpan" id="kobo.998.1">: </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.999.1">worker_connections 1024;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1000.1">.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.1001.1">Default </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1002.1">value</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1003.1">: None.</span></span></p>
<p><span class="koboSpan" id="kobo.1004.1">Defines the number of connections that a worker process may </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">treat simultaneously.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.1006.1">Table 2.3: A table detailing the events module directives</span></p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.1007.1">Configuration module</span></h2>
<p><span class="koboSpan" id="kobo.1008.1">The </span><a id="_idIndexMarker104"/><span class="koboSpan" id="kobo.1009.1">NGINX </span><strong class="source-inline"><span class="koboSpan" id="kobo.1010.1">configuration</span></strong><span class="koboSpan" id="kobo.1011.1"> module is a simple module that enables file inclusions with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1012.1">include</span></strong><span class="koboSpan" id="kobo.1013.1"> directive, as previously described in the </span><em class="italic"><span class="koboSpan" id="kobo.1014.1">Organization and inclusions</span></em><span class="koboSpan" id="kobo.1015.1"> section. </span><span class="koboSpan" id="kobo.1015.2">The directive can be inserted anywhere in the configuration file and accepts a single parameter – a </span><span class="No-Break"><span class="koboSpan" id="kobo.1016.1">file path:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1017.1">
include /file/path.conf;
include sites/*.conf;</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.1018.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1019.1">If you do not specify an absolute path, the file path is relative to the configuration directory. </span><span class="koboSpan" id="kobo.1019.2">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1020.1">include sites/example.conf</span></strong><span class="koboSpan" id="kobo.1021.1"> will </span><span class="No-Break"><span class="koboSpan" id="kobo.1022.1">include the</span></span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.1023.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">usr/local/nginx/conf/sites/example.con</span><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.1025.1">f</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1026.1"> file.</span></span><a id="_idTextAnchor160"/></p>
<h2 id="_idParaDest-59"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.1027.1">Necessary adjustments</span></h2>
<p><span class="koboSpan" id="kobo.1028.1">Several</span><a id="_idIndexMarker105"/><span class="koboSpan" id="kobo.1029.1"> core directives deserve to be adjusted carefully upon preparing the initial setup of NGINX on your server. </span><span class="koboSpan" id="kobo.1029.2">We will review several of these directives and the possible values you </span><span class="No-Break"><span class="koboSpan" id="kobo.1030.1">can set:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1">user root;</span></strong><span class="koboSpan" id="kobo.1032.1">: This directive specifies that the worker processes will be started as </span><strong class="source-inline"><span class="koboSpan" id="kobo.1033.1">root</span></strong><span class="koboSpan" id="kobo.1034.1">. </span><span class="koboSpan" id="kobo.1034.2">It is dangerous for security, as it grants NGINX full permissions over your filesystem. </span><span class="koboSpan" id="kobo.1034.3">You need to create a new user account on your system and make use of it here. </span><span class="koboSpan" id="kobo.1034.4">The recommended value (granted that a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1035.1">www-data</span></strong><span class="koboSpan" id="kobo.1036.1"> user account and group exist on the system) is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1">user </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1038.1">www-data www-data;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1039.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1040.1">worker_processes 1;</span></strong><span class="koboSpan" id="kobo.1041.1">: With this setting, only one worker process will be started, which implies that all requests will be processed by a unique execution flow. </span><span class="koboSpan" id="kobo.1041.2">This also implies that the execution is delegated to only one core of your CPU. </span><span class="koboSpan" id="kobo.1041.3">It is highly recommended to increase this value; you should have at least one process per CPU core. </span><span class="koboSpan" id="kobo.1041.4">Alternatively, just set this to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1042.1">auto</span></strong><span class="koboSpan" id="kobo.1043.1"> to leave it up to NGINX to determine the optimal value. </span><span class="koboSpan" id="kobo.1043.2">The recommended value is </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1044.1">worker_processes auto;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1045.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1046.1">worker_priority 0;</span></strong><span class="koboSpan" id="kobo.1047.1">: By default, the worker processes are started with a regular priority. </span><span class="koboSpan" id="kobo.1047.2">If your system performs other tasks simultaneously, you might want to grant a higher priority to the NGINX worker processes. </span><span class="koboSpan" id="kobo.1047.3">In this case, you should decrease the value; </span><em class="italic"><span class="koboSpan" id="kobo.1048.1">the smaller the value, the higher the priority</span></em><span class="koboSpan" id="kobo.1049.1">. </span><span class="koboSpan" id="kobo.1049.2">Values range from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1050.1">-20</span></strong><span class="koboSpan" id="kobo.1051.1"> (the highest priority) to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1052.1">19</span></strong><span class="koboSpan" id="kobo.1053.1"> (the lowest priority). </span><span class="koboSpan" id="kobo.1053.2">There is no recommended value here, as it completely depends on your situation. </span><span class="koboSpan" id="kobo.1053.3">However, you should not set it to under </span><strong class="source-inline"><span class="koboSpan" id="kobo.1054.1">-5</span></strong><span class="koboSpan" id="kobo.1055.1">, as it is the default priority for </span><span class="No-Break"><span class="koboSpan" id="kobo.1056.1">kernel processes.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1057.1">log_not_found on;</span></strong><span class="koboSpan" id="kobo.1058.1">: This directive specifies whether NGINX should log </span><strong class="source-inline"><span class="koboSpan" id="kobo.1059.1">404 errors</span></strong><span class="koboSpan" id="kobo.1060.1"> or not. </span><span class="koboSpan" id="kobo.1060.2">While these errors may, of course, provide useful information about missing resources, a lot of them may be generated by web browsers trying to reach the </span><em class="italic"><span class="koboSpan" id="kobo.1061.1">favicon</span></em><span class="koboSpan" id="kobo.1062.1"> (the conventional </span><strong class="source-inline"><span class="koboSpan" id="kobo.1063.1">/favicon.ico</span></strong><span class="koboSpan" id="kobo.1064.1"> of a website) or </span><a id="_idIndexMarker106"/><span class="koboSpan" id="kobo.1065.1">robots trying to access the indexing instructions (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">robots.txt</span></strong><span class="koboSpan" id="kobo.1067.1">). </span><span class="koboSpan" id="kobo.1067.2">Set this to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1068.1">off</span></strong><span class="koboSpan" id="kobo.1069.1"> if you want to ensure your log files don›t get cluttered by </span><strong class="bold"><span class="koboSpan" id="kobo.1070.1">Error 404</span></strong><span class="koboSpan" id="kobo.1071.1"> entries, but keep in mind that this could deprive you of potentially important information about other pages that visitors failed to reach. </span><span class="koboSpan" id="kobo.1071.2">Note that this directive is part of the HTTP core module. </span><span class="koboSpan" id="kobo.1071.3">Refer to the next chapter for </span><span class="No-Break"><span class="koboSpan" id="kobo.1072.1">more information.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">worker_connections 1024;</span></strong><span class="koboSpan" id="kobo.1074.1">: This setting, combined with the number of worker processes, allows you to define the total number of connections accepted by the server simultaneously. </span><span class="koboSpan" id="kobo.1074.2">If you enable four worker processes, each accepting 1,024 connections, your server will treat a total of 4,096 simultaneous connections. </span><span class="koboSpan" id="kobo.1074.3">You need to adjust this setting to match your hardware – the more RAM and CPU power your server relies on, the more connections you can accept concurrently. </span><span class="koboSpan" id="kobo.1074.4">If your server is a huge monster meant to host high-traffic sites, you will want to increase </span><span class="No-Break"><span class="koboSpan" id="kobo.1075.1">this valu</span><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.1076.1">e.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1077.1">We’ve taken a look at the configuration. </span><span class="koboSpan" id="kobo.1077.2">Next, we are going to put this into practice by trying our configuration and launching a test server to see how </span><span class="No-Break"><span class="koboSpan" id="kobo.1078.1">NGINX behave</span><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.1079.1">s.</span></span></p>
<h1 id="_idParaDest-60"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.1080.1">Testing your server</span></h1>
<p><span class="koboSpan" id="kobo.1081.1">At this point, you </span><a id="_idIndexMarker107"/><span class="koboSpan" id="kobo.1082.1">have configured several basic directives that affect the core functioning of NGINX. </span><span class="koboSpan" id="kobo.1082.2">We will perform a simple test to ensure that all is working as expected and that you are ready to further configure and deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.1083.1">your websi</span><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.1084.1">t</span><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.1085.1">es.</span></span></p>
<h2 id="_idParaDest-61"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.1086.1">Creating a test server</span></h2>
<p><span class="koboSpan" id="kobo.1087.1">In order to</span><a id="_idIndexMarker108"/><span class="koboSpan" id="kobo.1088.1"> perform simple tests, such as connecting to a server with a web browser, we need to set up a website for NGINX to serve. </span><span class="koboSpan" id="kobo.1088.2">A test page comes with the default package in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1">html</span></strong><span class="koboSpan" id="kobo.1090.1"> folder (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1091.1">/usr/local/nginx/html/index.html</span></strong><span class="koboSpan" id="kobo.1092.1">), and the original </span><strong class="source-inline"><span class="koboSpan" id="kobo.1093.1">nginx.conf</span></strong><span class="koboSpan" id="kobo.1094.1"> is configured to serve this page. </span><span class="koboSpan" id="kobo.1094.2">Here is the section that we are interested in </span><span class="No-Break"><span class="koboSpan" id="kobo.1095.1">for now:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1096.1">
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    server {
        listen       80;
        server_name  localhost;
        location / {
            root   html;
            index  index.html index.htm;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
}</span></pre> <p><span class="koboSpan" id="kobo.1097.1">As you can perhaps already tell, this segment configures NGINX to serve </span><span class="No-Break"><span class="koboSpan" id="kobo.1098.1">a website:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1099.1">It opens a listening socket on </span><span class="No-Break"><span class="koboSpan" id="kobo.1100.1">port </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1101.1">80</span></strong></span></li>
<li><span class="koboSpan" id="kobo.1102.1">Accessible at the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1103.1">http://localhost/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1104.1"> address</span></span></li>
<li><span class="koboSpan" id="kobo.1105.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1106.1">index.html</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1107.1">index page</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1108.1">For more </span><a id="_idIndexMarker109"/><span class="koboSpan" id="kobo.1109.1">details about these directives, refer to the </span><em class="italic"><span class="koboSpan" id="kobo.1110.1">HTTP module configuration</span></em><span class="koboSpan" id="kobo.1111.1"> section in </span><a href="B21787_03.xhtml#_idTextAnchor179"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1112.1">Chapter 3</span></em></span></a><span class="koboSpan" id="kobo.1113.1">. </span><span class="koboSpan" id="kobo.1113.2">Anyhow, fire up your favorite web browser and </span><span class="No-Break"><span class="koboSpan" id="kobo.1114.1">visit </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1115.1">http://localhost/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1116.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.1117.1"><img alt="Figure 2.4: The default page for the NGINX server" src="image/B21787_02_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1118.1">Figure 2.4: The default page for the NGINX server</span></p>
<p><span class="koboSpan" id="kobo.1119.1">You should be greeted with a welcome message; if you aren’t, then check the configuration again and make sure you reloaded NGINX in order to apply </span><span class="No-Break"><span class="koboSpan" id="kobo.1120.1">the cha</span><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.1121.1">n</span><a id="_idTextAnchor169"/><a id="_idTextAnchor170"/><a id="_idTextAnchor171"/><a id="_idTextAnchor172"/><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.1122.1">ges.</span></span></p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.1123.1">Upgrading NGINX gracefully</span></h2>
<p><span class="koboSpan" id="kobo.1124.1">There are </span><a id="_idIndexMarker110"/><span class="koboSpan" id="kobo.1125.1">many situations where you will need to replace the NGINX binary – for example, when you compile a new version and wish to put it in production, or simply after having enabled new modules and rebuilt the application. </span><span class="koboSpan" id="kobo.1125.2">What most administrators would do in this situation is stop the server, copy the new binary over the old one, and restart NGINX. </span><span class="koboSpan" id="kobo.1125.3">While this is not considered to be a problem for most websites, there may be some cases where uptime is critical and connection losses should be avoided at </span><span class="No-Break"><span class="koboSpan" id="kobo.1126.1">all costs.</span></span></p>
<p><span class="koboSpan" id="kobo.1127.1">Fortunately, NGINX embeds a mechanism that allows you to switch binaries with uninterrupted uptime; zero percent request loss is guaranteed if you follow these </span><span class="No-Break"><span class="koboSpan" id="kobo.1128.1">steps carefully:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1129.1">Replace the old NGINX binary (by default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1130.1">/usr/local/nginx/sbin/nginx</span></strong><span class="koboSpan" id="kobo.1131.1">) with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1132.1">new one.</span></span></li>
<li><span class="koboSpan" id="kobo.1133.1">Find </span><strong class="source-inline"><span class="koboSpan" id="kobo.1134.1">pid</span></strong><span class="koboSpan" id="kobo.1135.1"> of the NGINX master process – for example, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1136.1">ps x</span></strong><span class="koboSpan" id="kobo.1137.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1138.1">grep nginx</span></strong><span class="koboSpan" id="kobo.1139.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1140.1">grep master</span></strong><span class="koboSpan" id="kobo.1141.1"> or by looking at the value found in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1142.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1143.1">pid</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1144.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.1145.1">Send a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1146.1">USR2</span></strong><span class="koboSpan" id="kobo.1147.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1148.1">12</span></strong><span class="koboSpan" id="kobo.1149.1">) signal to the master process, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1150.1">kill -USR2 1234</span></strong><span class="koboSpan" id="kobo.1151.1">, replacing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1152.1">1234</span></strong><span class="koboSpan" id="kobo.1153.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1154.1">pid</span></strong><span class="koboSpan" id="kobo.1155.1"> found in </span><em class="italic"><span class="koboSpan" id="kobo.1156.1">step 2</span></em><span class="koboSpan" id="kobo.1157.1">. </span><span class="koboSpan" id="kobo.1157.2">This will initiate the upgrade by renaming the old </span><strong class="source-inline"><span class="koboSpan" id="kobo.1158.1">.pid</span></strong><span class="koboSpan" id="kobo.1159.1"> file and running the </span><span class="No-Break"><span class="koboSpan" id="kobo.1160.1">new binary.</span></span></li>
<li><span class="koboSpan" id="kobo.1161.1">Send a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1162.1">WINCH</span></strong><span class="koboSpan" id="kobo.1163.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">28</span></strong><span class="koboSpan" id="kobo.1165.1">) signal to the old master process, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1166.1">kill -WINCH 1234</span></strong><span class="koboSpan" id="kobo.1167.1">, replacing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1168.1">1234</span></strong><span class="koboSpan" id="kobo.1169.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1170.1">pid</span></strong><span class="koboSpan" id="kobo.1171.1"> found in </span><em class="italic"><span class="koboSpan" id="kobo.1172.1">step 2</span></em><span class="koboSpan" id="kobo.1173.1">. </span><span class="koboSpan" id="kobo.1173.2">This will engage a graceful shutdown of the old </span><span class="No-Break"><span class="koboSpan" id="kobo.1174.1">worker processes.</span></span></li>
<li><span class="koboSpan" id="kobo.1175.1">Make sure </span><a id="_idIndexMarker111"/><span class="koboSpan" id="kobo.1176.1">that all of the old worker processes are terminated, and then send a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1">QUIT</span></strong><span class="koboSpan" id="kobo.1178.1"> signal to the old master process, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1179.1">kill -QUIT 1234</span></strong><span class="koboSpan" id="kobo.1180.1">, replacing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1181.1">1234</span></strong><span class="koboSpan" id="kobo.1182.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1183.1">pid</span></strong><span class="koboSpan" id="kobo.1184.1"> found in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1185.1">step 2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1186.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.1187.1">Congratulations! </span><span class="koboSpan" id="kobo.1187.2">You have successfully upgraded NGINX and have not lost a </span><span class="No-Break"><span class="koboSpan" id="kobo.1188.1">single conn</span><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.1189.1">e</span><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.1190.1">ction.</span></span></p>
<h1 id="_idParaDest-63"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.1191.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1192.1">This chapter provided a first approach to the configuration architecture by studying the syntax and the core module directives that have an impact on the overall server performance. </span><span class="koboSpan" id="kobo.1192.2">We then went through a series of adjustments in order to fit your own profile, followed by a procedure to upgrade your running NGINX server without </span><span class="No-Break"><span class="koboSpan" id="kobo.1193.1">losing connections.</span></span></p>
<p><span class="koboSpan" id="kobo.1194.1">However, this is just the beginning. </span><span class="koboSpan" id="kobo.1194.2">Practically everything that we will do from now on is to prepare configuration sections. </span><span class="koboSpan" id="kobo.1194.3">The next chapter will detail more advanced directives by further exploring the module system and the exciting possibilities that are offered to you </span><span class="No-Break"><span class="koboSpan" id="kobo.1195.1">by it.</span></span></p>
</div>


<div class="Content" id="_idContainer020">
<h1 id="_idParaDest-64" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.1.1">Part 2: Dive into NGINX</span></h1>
</div>
<div id="_idContainer021">
<p><span class="koboSpan" id="kobo.2.1">In this part, you’ll deepen your knowledge of NGINX by exploring its various modules and advanced configuration options. </span><span class="koboSpan" id="kobo.2.2">In this part, you’ll delve into the intricacies of basic modules such as the HTTP module and the rewriting module, as well as integration with PHP and Python. </span><span class="koboSpan" id="kobo.2.3">You’ll also learn how to adapt NGINX to your </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">specific needs.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This part includes the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B21787_03.xhtml#_idTextAnchor179"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 3</span></em></a><em class="italic"><span class="koboSpan" id="kobo.7.1">,  </span></em><em class="italic"><span class="koboSpan" id="kobo.8.1">Exploring the HTTP Configuration</span></em></li>
<li><a href="B21787_04.xhtml#_idTextAnchor412"><em class="italic"><span class="koboSpan" id="kobo.9.1">Chapter 4</span></em></a><em class="italic"><span class="koboSpan" id="kobo.10.1">, Exploring Module Configuration in NGINX</span></em></li>
<li><a href="B21787_05.xhtml#_idTextAnchor557"><em class="italic"><span class="koboSpan" id="kobo.11.1">Chapter 5</span></em></a><em class="italic"><span class="koboSpan" id="kobo.12.1">, PHP and Python with NGINX</span></em></li>
<li><a href="B21787_06.xhtml#_idTextAnchor621"><em class="italic"><span class="koboSpan" id="kobo.13.1">Chapter 6</span></em></a><em class="italic"><span class="koboSpan" id="kobo.14.1">, NGINX as a Reverse Proxy</span></em></li>
</ul>
</div>
<div>
<div id="_idContainer022">
</div>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer023">
</div>
</div>
</body></html>