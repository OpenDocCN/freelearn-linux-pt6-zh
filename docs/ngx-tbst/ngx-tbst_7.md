# 第七章：前进：与 Nginx 一起发展

在现代这个互联互通、不断变化的世界里，一本书的最后一页并不意味着一切的结束，包括本书也是如此。当您读到这本书时，书中提到的一些新特性可能已经变得非常流行，而有些特性则可能开始走向过时。作为开源软件，Nginx 拥有一支高度忠诚的开发团队、活跃的社区以及一个快速增长的安装基础，已经经历了数百次的更改和测试。您或许会想，是否有某种可靠的方式能够跟上它的变化？这一切真的有必要吗？虽然当前的趋势是向移动优先、云连接、智能物联网的方向发展，但底层的协议和原理依然存在。HTTP 已经远远超出了其发明者的想象，它正在经历一次新的进化周期，在经过 SPDY 长时间且颇具争议的测试阶段后，HTTP/2 得到了快速的采用。Nginx 曾经并且仍然站在了这个前沿。毫无疑问，无论是哪种形式，HTTP 都将长期存在，而围绕它构建职业生涯是一个稳妥的选择，尤其是在如此强大的工具已轻松可得的情况下。

尽管互联网服务行业仍然年轻，但主要的职业发展模式已经确立。如果你热爱 Nginx 并且成功读完了本书，那么基本上你有两个主要的选择来继续前进。

# 系统管理

**系统管理**是将硬件和软件结合起来的艺术，使得整体的价值远大于各部分的总和。如果您更喜欢务实的定义，系统管理是负责业务流程中技术组件的操作专家，甚至更具体一点，是负责托管网站、Web 应用程序，越来越多地是后台 API 接口的 Web 服务器的专家。随着行业的发展，软件工程和系统管理之间的区别变得越来越重要，大多数现代企业都有单独的角色来担任这两种工作。顺便提一下，还有一个相反的趋势，即所谓的 DevOps 运动。DevOps 工程师将管理（或 -ops）技能与软件开发结合在一起。

本书主要面向与独立开发团队一起工作的 Nginx 管理员，想要在这份工作中变得更好、更有价值是非常自然的。为了更好地管理 Web 服务器，您需要了解多个广阔的知识领域。

## Linux/Unix 操作系统整体

Linux 长期以来已经成为事实上的 Web 服务器标准，但仅仅熟悉它是不够的。深入理解所有内部工作机制可能会成为你职业生涯中的伟大目标。从文件系统开始，到磁盘级别上的实际字节，再到虚拟内存子系统、进程、信号，以及所有进程间通信的方式，这是通向完美的漫长道路，面对棘手的 bug 或恶意攻击时，这一切将带来巨大的回报。我们还建议你了解其他类 Unix 的自由操作系统，主要是 FreeBSD 和 OpenBSD，它们无疑是值得竞争的对手，并且其核心原则有所不同。它们可能会成为你个人的最爱和秘密武器。你应该非常熟悉 Nginx 中包含的所有进程，它们如何被控制以及它们之间如何进行通信。

## 现代互联网协议

这里包含了实际的协议和相关操作系统的网络子系统，涉及到你的 Web 服务器和网络设备，如交换机和路由器。能够通过 telnet 连接到 Web 服务器是必不可少的，但这仅仅是第一步。我们需要理解整个技术栈的构建块，操作模型和操作系统如何从低层帧开始，经过几层数据包，再组织出既具容错能力又能适应底层媒介不同特性的连接。TCP/IP 技术栈并非一成不变。例如，未来几年你必须深入学习 IPv6 才能保持相关性。应用层的 HTTP 看起来可能很简单，但你也需要了解有关 TLS 的一切。调试特定操作系统中的网络是一个完全独立的学科。虽然对 *tcpdump* 过滤语言的良好掌握是一个非常好的起点，但通常还不够。像 Nginx 指令 `tcp_nopush` 和 `tcp_nodelay` 这样的简单示例非常有用。能够解释它们对连接的影响，并预测用户体验的变化，这正是你所需要的。

## 你公司使用的特定后台软件

除非你只托管大量静态文件，否则 Nginx 永远不会是唯一支持你网站的软件。上游软件往往是你网站出现问题的根源。掌握 Ruby-on-Rails 或 Django 应用的工作原理并不困难，但如果能够成功部署、监控并调试一个庞大的基于 Java 的后台，可能就会变成一个全职工作。

## 现代云平台

“云”这一流行词真正有意义的少数几个领域之一就是云托管平台领域，这一领域由亚马逊通过其**Amazon Web Services**（**AWS**）开创并作为大众产品推出，现在有许多参与者。除非你有非常具体的需求，否则使用这些平台之一是托管网站的推荐方式。而且掌握平台的使用至关重要。像广受欢迎的 Digital Ocean 液态服务器这样的简化解决方案非常容易，并且与管理真实硬件服务器没有太大区别。相反，AWS 是一个巨大的生态系统，包含了多个互联的复杂产品，如数据库、队列/消息服务以及其他开发者会喜欢使用的专用 API。掌握不同平台的知识和实践经验将是你的一项重要资产。顺便提一下，[`www.nginx.com`](https://www.nginx.com) 提供了预构建的 Nginx Plus AMI，这是 Nginx 的商业版本，适用于 Amazon EC2，详情请见 [`www.nginx.com/resources/admin-guide/setting-nginx-plus-environment-amazon-ec2/`](https://www.nginx.com/resources/admin-guide/setting-nginx-plus-environment-amazon-ec2/)。

## 自动化

扩展人工劳动有两种方式：委派给他人和自动化。尽管第一种方式无疑很重要，但从成本角度来看，第二种方式更为优先。掌握你的*shell-fu*技巧再次至关重要，但至少要在工具包中有一门通用的脚本语言。当前的流行语言是 Python 或 Ruby，而基于 Node.js 的 JavaScript 正成为另一个有趣的选择。Perl 依然非常强大，拥有庞大的开源库，尽管大部分包都不太好，但有时也能找到非常优秀的包，名为 CPAN。最近的 Nginx 版本具备将脚本语言解释器封装到 Web 服务器中的能力。在 2015 年的 `nginx.conf` 大会上，宣布了官方的 NginxScript JavaScript 解释器，还有一个非常流行的模块可以嵌入 Lua。参考 [`openresty.org/`](https://openresty.org/)。

掌握合适的自动化技能将为你打开新的视野，尤其是在现代平台上，这些平台拥有用于传统人工任务（如启动新服务器）的 API。自动化是将服务器数量从几台扩展到几十台、上百台甚至更多的关键。这正是 DevOps 工程的真正亮点。能够通过脚本创建并将服务器群集投入生产，感觉就像进入了一个全新的维度。当谈到实际编程时，还有第二条你可以选择的路径。

# 软件开发

Nginx 由一家商业公司开发，拥有非常高素质的全职付费软件工程师。同时，Nginx 的开源版本覆盖了 99% 的需求，并始终提供版本化的 tarball 文件和一个包含提交历史的 Mercurial 仓库，采用非常宽松的 BSD 许可证，允许修改和再分发。这是一个从一份非常有效和专业的 C 代码库中学习的独特机会。Nginx 支持模块，并且有大量第三方 Nginx 模块可用（见官方 wiki 页面 [`www.nginx.com/resources/wiki/modules/`](https://www.nginx.com/resources/wiki/modules/)）。Nginx 模块开发是定制软件以满足特定需求的主要方式，也是一个非常有价值的技能，你可以在此基础上构建你的职业生涯。

Nginx 是用 C 语言编写的，几乎没有外部依赖。它包含了自己非常高效的原始数据结构和算法库，如哈希表、基数树以及非常高效的自平衡红黑树。阅读一些简洁高效的代码是一种特别的乐趣，而 Nginx 在这方面完全满足了这一点。

有很多成功案例表明定制的 Nginx 被用作 web 应用平台，其中一个很好的例子就是前面提到的 OpenResty。虽然我们目前还不能向企业推荐这种做法，但如果你所在的公司选择 Nginx 作为平台，作为开发者可能是成为一个稀缺专家的绝佳途径，而这种专家总是非常吃香。

从 Nginx 的开放性质结合软件工程技能中获得的最重要的好处是最终的故障排除方法：在 Nginx 内部进行源代码级的调试。Nginx 拥有强大的日志功能，但没有什么能比得上在调试器中逐步分析关键代码段或修改源代码以触发罕见条件的能力。这也将我们带回到本书的主要话题。无论 Nginx 经过多年的发展变得多么稳定和健壮，它仍然是由人编写的一个软件，运行在错误、不可预测且极其复杂的环境中。我们希望本书为你提供了一些新的工具，帮助你在追求运行最快、最有价值网站的崇高目标中更进一步。

# 总结

在这一简短的最后一章中，我们详细阐述了读者在希望将 Nginx 故障排除作为技能之一进一步发展的过程中可能选择的不同方式。这个行业发展迅速，想要原地不动，你就必须不停地奔跑，这意味着每天都要不断学习和尝试。我们希望我们的读者能利用 Nginx 提供的所有功能，尤其是未来版本中将提供的功能，让现代 web 变得更加美好、稳定和安全。

这种（有些人会说是“无望的”）对更快、更可靠的网站和在线服务的渴望，是本书作者的主要动机。写作过程有过顺利也有过艰难，但最终，这个梦想始终是他前进的动力。而且，这本书得到了出色的内容经理们的祝福。
